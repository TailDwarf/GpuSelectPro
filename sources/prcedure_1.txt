CREATE  TABLE ZNMAT004 (MANDT VARCHAR(3),KEYVALUE VARCHAR(60),PERIO VARCHAR(7),RULEID VARCHAR(50),COKEY VARCHAR(50),SEQNR VARCHAR(50),VRGAR VARCHAR(2),VERSION VARCHAR(3),SEQNR_SPR VARCHAR(50),SEQNR_ROT VARCHAR(50),RULEID_SPR VARCHAR(50),RULEID_SND VARCHAR(50) ,DATYPE NVARCHAR(2),IFDONE VARCHAR(1),KEY_ORGANCOD VARCHAR(50),KEY_LINECOD VARCHAR(120)  ,KEY_CUSTMCACOD VARCHAR(50)  ,KEY_PRDNO VARCHAR(50)  ,FTYNAM_RL VARCHAR(24)  ,FTYNAM_ST VARCHAR(24)  ,FACTORYWET VARCHAR(3),FACTORYID VARCHAR(14)  ,KM VARCHAR(10)  ,CRNSCOD VARCHAR(5)  ,OPEXTYP VARCHAR(50)  ,ZFLOGO VARCHAR(50)  ,BJGTLINES VARCHAR(50)  ,SECTOR VARCHAR(50)  ,CBFTCODE VARCHAR(50)  ,GENERALACNT VARCHAR(50)  ,ACNTAGE VARCHAR(50)  ,OPTNAGE VARCHAR(50)  ,ORGANTYP VARCHAR(50)  ,ORGANCOD VARCHAR(50)  ,BUZNSNTURE VARCHAR(50)  ,SPECIALCODE VARCHAR(50)  ,CHANNEL VARCHAR(50)  ,LINETYP VARCHAR(50)  ,LINECOD VARCHAR(120)  ,ABJGTLINES VARCHAR(120)  ,COBASEDPRO VARCHAR(50)  ,MAKTPRO VARCHAR(50)  ,CUSTMNO VARCHAR(50)  ,CUSTMCATYP VARCHAR(50)  ,CUSTMCACOD VARCHAR(50)  ,STAFFNO VARCHAR(50)  ,PRDTYP VARCHAR(50)  ,PRDNO VARCHAR(50)  ,REVONUM VARCHAR(50)  ,ACNTNUMONLY VARCHAR(50)  ,BEASID VARCHAR(50)  ,SELIID VARCHAR(50)  ,OPEXPENSES DOUBLE ,CUSBNDNUM DOUBLE,SECTORNUM DOUBLE,CVSNUM DOUBLE,SSBANK DOUBLE,DEVICES DOUBLE,INVEBAPR DOUBLE,REVECST DOUBLE,COST_OP DOUBLE,TOTALINCM DOUBLE,INTERESTIN DOUBLE,CSTCAPITAL DOUBLE,VALCAPITAL DOUBLE,INTERESTEX DOUBLE,FEECOMIN DOUBLE,FEECOMEX DOUBLE,REINVES DOUBLE,VALUEGAINS DOUBLE,EXCHANGE DOUBLE,REBZNSO DOUBLE,PFABLITY DOUBLE,MOVEAC DOUBLE,ACNTNUM DOUBLE,TAMBOAIAO DOUBLE,MOENDBA DOUBLE,MOBGNBA DOUBLE,IOATCRBTTA DOUBLE,BEASSETS DOUBLE,RISKWEASS DOUBLE ,TICKETDELS DOUBLE,TICKETRATIO DOUBLE,WKLODEQ DOUBLE ,CREDIT DOUBLE ,ACNTTIME DOUBLE ,LCOT DOUBLE  ,VOLB DOUBLE ,TRANSNUM DOUBLE,APPROVAL DOUBLE,RMBSNUM DOUBLE ,RETAILSCO DOUBLE ,ELECSCO DOUBLE,CUSTNO DOUBLE ,DIFFICULTY DOUBLE,TOTILTIME DOUBLE ,INRATECO DOUBLE ,LENDERS DOUBLE,BASHET DOUBLE,CAP_SUM DOUBLE ,PRDNUM DOUBLE ,LOAN_BAL DOUBLE,BAD_LOAN_BAL DOUBLE ,PRJ_XM VARCHAR(18)  ,PRJ_SYS VARCHAR(18)  ,PRJ_YJ VARCHAR(18)  ,CJXH VARCHAR(2)  ,BMD_CODE VARCHAR(20)  ,ZIZHU_CODE VARCHAR(20)  ,ACNTAGE_CODE VARCHAR(50)  ,GRPID_LOB VARCHAR(35)  ,GRPID_CUSCAT VARCHAR(35)  ,GRPID_PRDSA VARCHAR(35)  ,LOBID_MAPRD VARCHAR(18)  ,LOBID_MACUS VARCHAR(18)  ,CUSCAT_MAIN VARCHAR(18)  ,JZZB_VAL DOUBLE,INC_TAX DOUBLE,OPTAX DOUBLE ,BSGAP DOUBLE,OTHER_COST DOUBLE,INCOME_OPO DOUBLE,EXPENSE_OPO DOUBLE ,BAL_AVG_M DOUBLE,BAL_BW DOUBLE ,VOL_AVG_D DOUBLE ,EXPENSE_ZCJZSS DOUBLE ,VAL_JZSS DOUBLE ,CAPITAL_JG DOUBLE ,CAPITAL_CRED DOUBLE,RWA_CR DOUBLE ,AVG_D_JZSS DOUBLE,BAL_JRZC DOUBLE ,AVG_D_JRZC DOUBLE,BAL_BBW DOUBLE ,AVG_D_BBW DOUBLE ,TRANS_COUNT_SCF_S DOUBLE  ,TRANS_COUNT_MJ_S DOUBLE,CATE_CODE VARCHAR(20)  ,CUST_CAT VARCHAR(18)  ,SYACNTAGE VARCHAR(50)  ,SYOPTNAGE VARCHAR(20)  ,SYSECTOR VARCHAR(50)  ,SYABJGTLINES VARCHAR(20)  ,SYPRDNO VARCHAR(20)  ,SYCOBASEDPRO VARCHAR(20)  ,SYCUST_CAT_ID VARCHAR(20)  ,SYCUST_CAT_DESC VARCHAR(20)  ,ZYDL VARCHAR(4)  ,ZYLX VARCHAR(10)  ,XMQS VARCHAR(3)  ,ASSET_TOL DOUBLE ,LIAB_SUM DOUBLE ,PACKCOUNT DOUBLE ,ZYZXBM VARCHAR(18)  ,BAL_SXZC_LY DOUBLE,RMB_TOTAL_AMT DOUBLE ,FOR_TOTAL_AMT DOUBLE  ,IS_NEW  INT,ZGUEST_GROUP VARCHAR(20),ZGUEST_GROUP_SY VARCHAR(50)) ;
CREATE  TABLE ZNMAT004KEYMAP (MANDT VARCHAR(3),PERIO VARCHAR(7) ,COKEY_OLD VARCHAR(60),COKEY_NEW VARCHAR(60) );
CREATE  TABLE ZNMAT004NOPKLIST (MANDT VARCHAR(3) ,CUSTMNO VARCHAR(50),PERIO VARCHAR(7) ,GRPID_CUSCAT VARCHAR(35) ) ;
CREATE  TABLE ZNMAT004TEMP (PERIO NVARCHAR(7)  ,KEYVALUE VARCHAR(60)  ,GENERALACNT VARCHAR(50)  ,ACNTAGE VARCHAR(50)  ,OPTNAGE VARCHAR(50)  ,BMD_CODE VARCHAR(20)  ,COBASEDPRO VARCHAR(50)  ,GRPID_LOB VARCHAR(35)  ,GRPID_CUSCAT VARCHAR(35)  ,GRPID_PRDSA VARCHAR(35)  ,LOBID_MAPRD VARCHAR(18)  ,LOBID_MACUS VARCHAR(18)  ,CUSCAT_MAIN VARCHAR(18)  ,CUSTMNO VARCHAR(50)  ,STAFFNO VARCHAR(50)  ,BEASID VARCHAR(50)  ,SELIID VARCHAR(50)  ,INTERESTIN DOUBLE,CSTCAPITAL DOUBLE,VALCAPITAL DOUBLE,INTERESTEX DOUBLE,FEECOMIN DOUBLE,FEECOMEX DOUBLE,REINVES DOUBLE,VALUEGAINS DOUBLE,EXCHANGE DOUBLE,REBZNSO DOUBLE,PFABLITY DOUBLE,JZZB_VAL DOUBLE,INC_TAX DOUBLE,OPTAX DOUBLE,BSGAP DOUBLE,OTHER_COST DOUBLE,INCOME_OPO DOUBLE,EXPENSE_OPO DOUBLE,BAL_AVG_M DOUBLE,MOBGNBA DOUBLE,MOENDBA DOUBLE,IOATCRBTTA DOUBLE,RISKWEASS DOUBLE,CAP_SUM DOUBLE,BAL_BW DOUBLE,VOL_AVG_D DOUBLE,EXPENSE_ZCJZSS DOUBLE,VAL_JZSS DOUBLE,CAPITAL_JG DOUBLE,CAPITAL_CRED DOUBLE,RWA_CR DOUBLE,AVG_D_JZSS DOUBLE,BAL_JRZC DOUBLE,AVG_D_JRZC DOUBLE,BAL_BBW DOUBLE,AVG_D_BBW DOUBLE,TICKETDELS DOUBLE,TICKETRATIO DOUBLE,WKLODEQ DOUBLE,CREDIT DOUBLE,ACNTNUM DOUBLE,CUSTNO DOUBLE,MOVEAC DOUBLE,ACNTTIME DOUBLE,LENDERS DOUBLE,VOLB DOUBLE,TRANSNUM DOUBLE,APPROVAL DOUBLE,TRANS_COUNT_SCF_S DOUBLE,DIFFICULTY DOUBLE,TRANS_COUNT_MJ_S DOUBLE,INVEBAPR DOUBLE,BAL_SXZC_LY DOUBLE,RMB_TOTAL_AMT DOUBLE,FOR_TOTAL_AMT DOUBLE,IS_NEW INT ,ZGUEST_GROUP VARCHAR(20) ) ;
CREATE  TABLE ZNMAT011 (MANDT VARCHAR(3),PERIO VARCHAR(7),SEQNR VARCHAR(50)  ,RULEID_FQ VARCHAR(50)  ,RULEID VARCHAR(50)  ,COKEY VARCHAR(50)  ,VRGAR VARCHAR(2)  ,VERSION VARCHAR(3)  ,SEQNR_SPR VARCHAR(50)  ,SEQNR_ROT VARCHAR(50)  ,RULEID_SPR VARCHAR(50)  ,RULEID_SND VARCHAR(50)  ,DATYPE VARCHAR(2)  ,IFDONE VARCHAR(1)  ,KEY_ORGANCOD VARCHAR(50)  ,KEY_LINECOD VARCHAR(120)  ,KEY_CUSTMCACOD VARCHAR(50)  ,KEY_PRDNO VARCHAR(50)  ,FTYNAM_RL VARCHAR(24)  ,FTYNAM_ST VARCHAR(24)  ,FACTORYWET VARCHAR(3)  ,FACTORYID VARCHAR(14)  ,KM VARCHAR(10)  ,CRNSCOD VARCHAR(5)  ,OPEXTYP VARCHAR(50)  ,ZFLOGO VARCHAR(50)  ,BJGTLINES VARCHAR(50)  ,SECTOR VARCHAR(50)  ,CBFTCODE VARCHAR(50)  ,GENERALACNT VARCHAR(50)  ,ACNTAGE VARCHAR(50)  ,OPTNAGE VARCHAR(50)  ,ORGANTYP VARCHAR(50)  ,ORGANCOD VARCHAR(50)  ,BUZNSNTURE VARCHAR(50)  ,SPECIALCODE VARCHAR(50)  ,CHANNEL VARCHAR(50)  ,LINETYP VARCHAR(50)  ,LINECOD VARCHAR(120)  ,ABJGTLINES VARCHAR(120)  ,COBASEDPRO VARCHAR(50)  ,MAKTPRO VARCHAR(50)  ,CUSTMNO VARCHAR(50)  ,CUSTMCATYP VARCHAR(50)  ,CUSTMCACOD VARCHAR(50)  ,STAFFNO VARCHAR(50)  ,PRDTYP VARCHAR(50)  ,PRDNO VARCHAR(50)  ,REVONUM VARCHAR(50)  ,ACNTNUMONLY VARCHAR(50)  ,BEASID VARCHAR(50)  ,SELIID VARCHAR(50)  ,OPEXPENSES DOUBLE,CUSBNDNUM DOUBLE,SECTORNUM DOUBLE,CVSNUM DOUBLE,SSBANK DOUBLE,DEVICES DOUBLE,INVEBAPR DOUBLE,REVECST DOUBLE,COST_OP DOUBLE,TOTALINCM DOUBLE,INTERESTIN DOUBLE,CSTCAPITAL DOUBLE,VALCAPITAL DOUBLE,INTERESTEX DOUBLE,FEECOMIN DOUBLE,FEECOMEX DOUBLE,REINVES DOUBLE,VALUEGAINS DOUBLE,EXCHANGE DOUBLE,REBZNSO DOUBLE,PFABLITY DOUBLE,MOVEAC DOUBLE,ACNTNUM DOUBLE,TAMBOAIAO DOUBLE,MOENDBA DOUBLE,MOBGNBA DOUBLE,IOATCRBTTA DOUBLE,BEASSETS DOUBLE,RISKWEASS DOUBLE,TICKETDELS DOUBLE,TICKETRATIO DOUBLE,WKLODEQ DOUBLE,CREDIT DOUBLE,ACNTTIME DOUBLE,LCOT DOUBLE,VOLB DOUBLE,TRANSNUM DOUBLE,APPROVAL DOUBLE,RMBSNUM DOUBLE,RETAILSCO DOUBLE,ELECSCO DOUBLE,CUSTNO DOUBLE,DIFFICULTY DOUBLE,TOTILTIME DOUBLE,INRATECO DOUBLE,LENDERS DOUBLE,BASHET DOUBLE,CAP_SUM DOUBLE,PRDNUM DOUBLE,LOAN_BAL DOUBLE,BAD_LOAN_BAL DOUBLE,PRJ_XM VARCHAR(18)  ,PRJ_SYS VARCHAR(18)  ,PRJ_YJ VARCHAR(18)  ,CJXH VARCHAR(2)  ,BMD_CODE VARCHAR(20)  ,ZIZHU_CODE VARCHAR(20)  ,ACNTAGE_CODE VARCHAR(50)  ,GRPID_LOB VARCHAR(35)  ,GRPID_CUSCAT VARCHAR(35)  ,GRPID_PRDSA VARCHAR(35)  ,LOBID_MAPRD VARCHAR(18)  ,LOBID_MACUS VARCHAR(18)  ,CUSCAT_MAIN VARCHAR(18)  ,JZZB_VAL DOUBLE,INC_TAX DOUBLE,OPTAX DOUBLE,BSGAP DOUBLE,OTHER_COST DOUBLE,INCOME_OPO DOUBLE,EXPENSE_OPO DOUBLE,BAL_AVG_M DOUBLE,BAL_BW DOUBLE,VOL_AVG_D DOUBLE,EXPENSE_ZCJZSS DOUBLE,VAL_JZSS DOUBLE,CAPITAL_JG DOUBLE,CAPITAL_CRED DOUBLE,RWA_CR DOUBLE,AVG_D_JZSS DOUBLE,BAL_JRZC DOUBLE,AVG_D_JRZC DOUBLE,BAL_BBW DOUBLE,AVG_D_BBW DOUBLE,TRANS_COUNT_SCF_S DOUBLE,TRANS_COUNT_MJ_S DOUBLE,CATE_CODE VARCHAR(20)  ,CUST_CAT VARCHAR(18)  ,SYACNTAGE VARCHAR(50)  ,SYOPTNAGE VARCHAR(20)  ,SYSECTOR VARCHAR(50)  ,SYABJGTLINES VARCHAR(20)  ,SYPRDNO VARCHAR(20)  ,SYCOBASEDPRO VARCHAR(20)  ,SYCUST_CAT_ID VARCHAR(20)  ,SYCUST_CAT_DESC VARCHAR(20)  ,ZYDL VARCHAR(4)  ,ZYLX VARCHAR(10)  ,XMQS VARCHAR(3)  ,ASSET_TOL DOUBLE,LIAB_SUM DOUBLE,PACKCOUNT DOUBLE,ZYZXBM VARCHAR(18) ,CL_FICATION VARCHAR(1)  ,SJORTJ VARCHAR(1)  ,HR_SPLIT_FLG VARCHAR(1)  ) ;
CREATE  TABLE ZNMAT019 (MANDT VARCHAR(3),CUS_PERIO VARCHAR(7)  ,CUS_WD_ID VARCHAR(50)  ,CUS_COKEY VARCHAR(40) ,CUS_WD_VAL VARCHAR(18) ) ;
CREATE  TABLE ZNMAT020 (MANDT VARCHAR(3) ,PRD_PERIO VARCHAR(7),PRD_WD_ID VARCHAR(18),PRD_COKEY VARCHAR(50) ,PRD_WD_VAL VARCHAR(18) ) ;
CREATE  TABLE ZNMAT021 (MANDT VARCHAR(3),LOB_PERIO VARCHAR(7),LOB_WD_ID VARCHAR(18),LOB_COKEY VARCHAR(50),LOB_WD_VAL VARCHAR(120));
CREATE  TABLE ZNMAT023 (MANDT VARCHAR(3),PERIO VARCHAR(7) ,PRDTYP VARCHAR(50) ,PRDNO VARCHAR(50) ,PRDLEAF VARCHAR(50)  ) ;
CREATE  TABLE ZNMAT046 (MANDT VARCHAR(3),PERIO VARCHAR(7)  ,ORGANTYP VARCHAR(50)  ,ORGANCOD VARCHAR(50)  ,ORGANLEAF VARCHAR(50),ORG_WZ_LEVEL VARCHAR(18) ,ORG_SORT VARCHAR(18) );
CREATE  TABLE ZNMAT065 (MANDT VARCHAR(3) ,PERIO VARCHAR(7) ,RULEID VARCHAR(50) ,VERSION VARCHAR(3) ,SETKIND VARCHAR(1) ,FIELD VARCHAR(30) ,FIELDGRP VARCHAR(18) ,FIELDCOD VARCHAR(50)  ,FIELDTYP VARCHAR(50) ) ;
CREATE  TABLE ZNMAT134(MANDT VARCHAR(3)  ,PERIO VARCHAR(7)  ,STAFFNO VARCHAR(50) ,BUZNSNTURE VARCHAR(50),CATE_CODE VARCHAR(20)) ;
CREATE  TABLE ZNMAT088 (MANDT VARCHAR(3) ,DATYPE VARCHAR(2) ) ;
CREATE  TABLE ZNMAT088A (MANDT VARCHAR(3) ,BS VARCHAR(1),DATYPE VARCHAR(2));
CREATE  TABLE ZNMAT105 (MANDT VARCHAR(3)  ,PERIO VARCHAR(7) ,SEQNR VARCHAR(50)  ,RULEID_FQ VARCHAR(50)  ,RULEID VARCHAR(50)  ,COKEY VARCHAR(50)  ,VRGAR VARCHAR(2)  ,VERSION VARCHAR(3)  ,SEQNR_SPR VARCHAR(50)  ,SEQNR_ROT VARCHAR(50)  ,RULEID_SPR VARCHAR(50)  ,RULEID_SND VARCHAR(50)  ,DATYPE VARCHAR(2)  ,IFDONE VARCHAR(1)  ,KEY_ORGANCOD VARCHAR(50)  ,KEY_LINECOD VARCHAR(120)  ,KEY_CUSTMCACOD VARCHAR(50)  ,KEY_PRDNO VARCHAR(50)  ,FTYNAM_RL VARCHAR(24)  ,FTYNAM_ST VARCHAR(24)  ,FACTORYWET VARCHAR(3) ,FACTORYID VARCHAR(14)  ,KM VARCHAR(10)  ,CRNSCOD VARCHAR(5)  ,OPEXTYP VARCHAR(50)  ,ZFLOGO VARCHAR(50)  ,BJGTLINES VARCHAR(50)  ,SECTOR VARCHAR(50)  ,CBFTCODE VARCHAR(50)  ,GENERALACNT VARCHAR(50)  ,ACNTAGE VARCHAR(50)  ,OPTNAGE VARCHAR(50)  ,ORGANTYP VARCHAR(50)  ,ORGANCOD VARCHAR(50)  ,BUZNSNTURE VARCHAR(50)  ,SPECIALCODE VARCHAR(50)  ,CHANNEL VARCHAR(50)  ,LINETYP VARCHAR(50)  ,LINECOD VARCHAR(120)  ,ABJGTLINES VARCHAR(120)  ,COBASEDPRO VARCHAR(50)  ,MAKTPRO VARCHAR(50)  ,CUSTMNO VARCHAR(50)  ,CUSTMCATYP VARCHAR(50)  ,CUSTMCACOD VARCHAR(50)  ,STAFFNO VARCHAR(50)  ,PRDTYP VARCHAR(50)  ,PRDNO VARCHAR(50)  ,REVONUM VARCHAR(50)  ,ACNTNUMONLY VARCHAR(50)  ,BEASID VARCHAR(50)  ,SELIID VARCHAR(50)  ,OPEXPENSES DOUBLE,CUSBNDNUM DOUBLE,SECTORNUM DOUBLE,CVSNUM DOUBLE,SSBANK DOUBLE,DEVICES DOUBLE,INVEBAPR DOUBLE,REVECST DOUBLE,COST_OP DOUBLE,TOTALINCM DOUBLE,INTERESTIN DOUBLE,CSTCAPITAL DOUBLE,VALCAPITAL DOUBLE,INTERESTEX DOUBLE,FEECOMIN DOUBLE,FEECOMEX DOUBLE,REINVES DOUBLE,VALUEGAINS DOUBLE,EXCHANGE DOUBLE,REBZNSO DOUBLE,PFABLITY DOUBLE,MOVEAC DOUBLE,ACNTNUM DOUBLE,TAMBOAIAO DOUBLE,MOENDBA DOUBLE,MOBGNBA DOUBLE,IOATCRBTTA DOUBLE,BEASSETS DOUBLE,RISKWEASS DOUBLE,TICKETDELS DOUBLE,TICKETRATIO DOUBLE,WKLODEQ DOUBLE,CREDIT DOUBLE,ACNTTIME DOUBLE,LCOT DOUBLE,VOLB DOUBLE,TRANSNUM DOUBLE,APPROVAL DOUBLE,RMBSNUM DOUBLE,RETAILSCO DOUBLE,ELECSCO DOUBLE,CUSTNO DOUBLE,DIFFICULTY DOUBLE,TOTILTIME DOUBLE,INRATECO DOUBLE,LENDERS DOUBLE,BASHET DOUBLE,CAP_SUM DOUBLE,PRDNUM DOUBLE,LOAN_BAL DOUBLE,BAD_LOAN_BAL DOUBLE,PRJ_XM VARCHAR(18)  ,PRJ_SYS VARCHAR(18)  ,PRJ_YJ VARCHAR(18)  ,CJXH VARCHAR(2)  ,BMD_CODE VARCHAR(20)  ,ZIZHU_CODE VARCHAR(20)  ,ACNTAGE_CODE VARCHAR(50)  ,LOBID_MAPRD VARCHAR(18)  ,LOBID_MACUS VARCHAR(18)  ,CATE_CODE VARCHAR(20)  ,HR_SPLIT_FLG VARCHAR(1)  ,SYACNTAGE VARCHAR(50)  ,SYOPTNAGE VARCHAR(20)  ,ZGUEST_GROUP VARCHAR(20)  ) ;
CREATE  TABLE ZNMAT133 (MANDT VARCHAR(3)  ,PERIO VARCHAR(7) ,GROUP_TYPE VARCHAR(3),GROUP_ID VARCHAR(35)  ,GROUP_VAL VARCHAR(18) );
CREATE  TABLE ZNMAT142 (MANDT VARCHAR(3)  ,PERIO NVARCHAR(7) ,CUST_NO VARCHAR(50) ,NAME VARCHAR(18)  ,GRPID_CUSCAT VARCHAR(35) ,IS_UNPACKED VARCHAR(1) ) ;
insert into ZNMAT004NOPKLIST select '801',cust_no,'2018001','' FROM ZNMAT142 WHERE PERIO = '2018001'  AND IS_UNPACKED = 'W' AND GRPID_CUSCAT <> '' proc;
create table C(STAFFNO VARCHAR(50));
insert into C(STAFFNO) select DISTINCT STAFFNO from ZNMAT134 WHERE PERIO = '2018001' proc;
create table E(PRDLEAF VARCHAR(50));
insert into E(PRDLEAF)select DISTINCT PRDLEAF FROM  ZNMAT023 WHERE PRDNO LIKE 'I%' AND PERIO = '2018001' proc;
create table tempA(PREFIX VARCHAR(10),ACNTAGE VARCHAR(50),OPTNAGE VARCHAR(50),BMD_CODE VARCHAR(20),COBASEDPRO VARCHAR(50),GRPID_LOB VARCHAR(35),GRPID_CUSCAT VARCHAR(35),GRPID_PRDSA VARCHAR(35),LOBID_MAPRD VARCHAR(18),LOBID_MACUS VARCHAR(18),CUSCAT_MAIN VARCHAR(18),CUSTMNO VARCHAR(50),STAFFNO VARCHAR(50),BEASID VARCHAR(50),SELIID VARCHAR(50),INTERESTIN DOUBLE,CSTCAPITAL DOUBLE,VALCAPITAL DOUBLE,INTERESTEX DOUBLE,FEECOMIN DOUBLE,FEECOMEX DOUBLE,REINVES DOUBLE,VALUEGAINS DOUBLE,EXCHANGE DOUBLE,REBZNSO DOUBLE,PFABLITY DOUBLE,JZZB_VAL DOUBLE,INC_TAX DOUBLE,OPTAX DOUBLE,BSGAP DOUBLE,OTHER_COST DOUBLE,INCOME_OPO DOUBLE,EXPENSE_OPO DOUBLE,BAL_AVG_M DOUBLE,MOBGNBA DOUBLE,MOENDBA DOUBLE,IOATCRBTTA DOUBLE,RISKWEASS DOUBLE,CAP_SUM DOUBLE,BAL_BW DOUBLE,VOL_AVG_D DOUBLE,EXPENSE_ZCJZSS DOUBLE,VAL_JZSS DOUBLE,CAPITAL_JG DOUBLE,CAPITAL_CRED DOUBLE,RWA_CR DOUBLE,AVG_D_JZSS DOUBLE,BAL_JRZC DOUBLE,AVG_D_JRZC DOUBLE,BAL_BBW DOUBLE,AVG_D_BBW DOUBLE,TICKETDELS DOUBLE,TICKETRATIO DOUBLE,WKLODEQ DOUBLE,CREDIT DOUBLE,ACNTNUM DOUBLE,CUSTNO DOUBLE,MOVEAC DOUBLE,ACNTTIME DOUBLE,LENDERS DOUBLE,VOLB DOUBLE,TRANSNUM DOUBLE,APPROVAL DOUBLE,TRANS_COUNT_SCF_S DOUBLE,DIFFICULTY DOUBLE,TRANS_COUNT_MJ_S DOUBLE,INVEBAPR DOUBLE,BAL_SXZC_LY DOUBLE,RMB_TOTAL_AMT DOUBLE,FOR_TOTAL_AMT DOUBLE,IS_NEW INT,ZGUEST_GROUP VARCHAR(20),KEYVALUE VARCHAR(60));
insert into tempA SELECT 'PC',A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.GRPID_CUSCAT AS CUSTMNO,IFNULL(C.STAFFNO,'99999') AS STAFFNO,A.BEASID,A.SELIID,A.INTERESTIN,A.CSTCAPITAL,A.VALCAPITAL,A.INTERESTEX,A.FEECOMIN,A.FEECOMEX,A.REINVES,A.VALUEGAINS,A.EXCHANGE,A.REBZNSO,A.PFABLITY,A.JZZB_VAL,A.INC_TAX,A.OPTAX,A.BSGAP,A.OTHER_COST,A.INCOME_OPO,A.EXPENSE_OPO,A.BAL_AVG_M,A.MOBGNBA,A.MOENDBA,A.IOATCRBTTA,A.RISKWEASS,A.CAP_SUM,A.BAL_BW,A.VOL_AVG_D,A.EXPENSE_ZCJZSS,A.VAL_JZSS,A.CAPITAL_JG,A.CAPITAL_CRED,A.RWA_CR,A.AVG_D_JZSS,A.BAL_JRZC,A.AVG_D_JRZC,A.BAL_BBW,A.AVG_D_BBW,A.TICKETDELS,A.TICKETRATIO,A.WKLODEQ,A.CREDIT,A.ACNTNUM,A.CUSTNO,A.MOVEAC,A.ACNTTIME,A.LENDERS,A.VOLB,A.TRANSNUM,A.APPROVAL,A.TRANS_COUNT_SCF_S,A.DIFFICULTY,A.TRANS_COUNT_MJ_S,A.INVEBAPR,A.BAL_SXZC_LY,A.RMB_TOTAL_AMT,A.FOR_TOTAL_AMT,A.IS_NEW,A.ZGUEST_GROUP,A.KEYVALUE FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST B ON A.CUSTMNO = B.CUSTMNO left JOIN  C ON  A.STAFFNO = C.STAFFNO left JOIN  E ON A.COBASEDPRO = E.PRDLEAF  WHERE B.CUSTMNO IS NULL AND A.PERIO = '2018001' AND E.PRDLEAF IS NULL and B.PERIO <= '2018001' proc;
create table F(PRDLEAF VARCHAR(50));
insert into F(PRDLEAF) select DISTINCT PRDLEAF FROM  ZNMAT023 WHERE (PRDNO LIKE 'I%' OR PRDNO LIKE 'J%') AND PERIO = '2018001' proc;
insert into tempA SELECT 'PC',A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.GRPID_CUSCAT AS CUSTMNO,case A.STAFFNO when '' then '99999' else A.STAFFNO end AS STAFFNO,A.BEASID,A.SELIID,A.INTERESTIN,A.CSTCAPITAL,A.VALCAPITAL,A.INTERESTEX,A.FEECOMIN,A.FEECOMEX,A.REINVES,A.VALUEGAINS,A.EXCHANGE,A.REBZNSO,A.PFABLITY,A.JZZB_VAL,A.INC_TAX,A.OPTAX,A.BSGAP,A.OTHER_COST,A.INCOME_OPO,A.EXPENSE_OPO,A.BAL_AVG_M,A.MOBGNBA,A.MOENDBA,A.IOATCRBTTA,A.RISKWEASS,A.CAP_SUM,A.BAL_BW,A.VOL_AVG_D,A.EXPENSE_ZCJZSS,A.VAL_JZSS,A.CAPITAL_JG,A.CAPITAL_CRED,A.RWA_CR,A.AVG_D_JZSS,A.BAL_JRZC,A.AVG_D_JRZC,A.BAL_BBW,A.AVG_D_BBW,A.TICKETDELS,A.TICKETRATIO,A.WKLODEQ,A.CREDIT,A.ACNTNUM,A.CUSTNO,A.MOVEAC,A.ACNTTIME,A.LENDERS,A.VOLB,A.TRANSNUM,A.APPROVAL,A.TRANS_COUNT_SCF_S,A.DIFFICULTY,A.TRANS_COUNT_MJ_S,A.INVEBAPR,A.BAL_SXZC_LY,A.RMB_TOTAL_AMT,A.FOR_TOTAL_AMT,A.IS_NEW,A.ZGUEST_GROUP,A.KEYVALUE  FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST B ON A.CUSTMNO = B.CUSTMNO left JOIN  F ON A.COBASEDPRO = F.PRDLEAF  WHERE B.CUSTMNO IS NULL AND A.PERIO= '2018001' AND F.PRDLEAF IS NULL  and B.PERIO <= '2018001' proc;
create sequence temp_seq start with 0 increment by 1 maxvalue 9999999999 nocycle nocache ;
insert into ZNMAT004(MANDT, DATYPE, PERIO, KEYVALUE, GENERALACNT, ACNTAGE, OPTNAGE, BMD_CODE, COBASEDPRO, GRPID_LOB, GRPID_CUSCAT, GRPID_PRDSA, LOBID_MAPRD, LOBID_MACUS, CUSCAT_MAIN, CUSTMNO, STAFFNO, BEASID, SELIID, INTERESTIN, CSTCAPITAL, VALCAPITAL, INTERESTEX, FEECOMIN, FEECOMEX, REINVES, VALUEGAINS, EXCHANGE, REBZNSO, PFABLITY,	 JZZB_VAL, INC_TAX, OPTAX, BSGAP, OTHER_COST, INCOME_OPO, EXPENSE_OPO, TAMBOAIAO, MOBGNBA, MOENDBA, IOATCRBTTA, RISKWEASS, CAP_SUM, BAL_BW, VOL_AVG_D, EXPENSE_ZCJZSS, VAL_JZSS, CAPITAL_JG, CAPITAL_CRED, RWA_CR, AVG_D_JZSS, BAL_JRZC, AVG_D_JRZC, BAL_BBW, AVG_D_BBW, TICKETDELS, TICKETRATIO, WKLODEQ, CREDIT, ACNTNUM, CUSTNO, MOVEAC, ACNTTIME, LENDERS, VOLB, TRANSNUM, APPROVAL, TRANS_COUNT_SCF_S, DIFFICULTY, TRANS_COUNT_MJ_S, INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT)SELECT '801', 'B0', '2018001', concat(PREFIX,cast(NEXTVAL(temp_seq) as varchar(10))),concat(PREFIX,cast(NEXTVAL(temp_seq) as varchar(10))), ACNTAGE, OPTNAGE, BMD_CODE, COBASEDPRO, GRPID_LOB, GRPID_CUSCAT, GRPID_PRDSA, LOBID_MAPRD, LOBID_MACUS, CUSCAT_MAIN, CUSTMNO, STAFFNO, BEASID, SELIID, abs(SUM(INTERESTIN)), abs(SUM(CSTCAPITAL)), abs(SUM(VALCAPITAL)), abs(SUM(INTERESTEX)), abs(SUM(FEECOMIN)), abs(SUM(FEECOMEX)), abs(SUM(REINVES)), abs(SUM(VALUEGAINS)), abs(SUM(EXCHANGE)), abs(SUM(REBZNSO)), abs(SUM(PFABLITY)), abs(SUM(JZZB_VAL)), abs(SUM(INC_TAX)), abs(SUM(OPTAX)), abs(SUM(BSGAP)), abs(SUM(OTHER_COST)), abs(SUM(INCOME_OPO)), abs(SUM(EXPENSE_OPO)), abs(SUM(BAL_AVG_M)), abs(SUM(MOBGNBA)), abs(SUM(MOENDBA)),abs(SUM(IOATCRBTTA)), abs(SUM(RISKWEASS)), abs(SUM(CAP_SUM)), abs(SUM(BAL_BW)), abs(SUM(VOL_AVG_D)), abs(SUM(EXPENSE_ZCJZSS)), abs(SUM(VAL_JZSS)), abs(SUM(CAPITAL_JG)), abs(SUM(CAPITAL_CRED)), abs(SUM(RWA_CR)), abs(SUM(AVG_D_JZSS)), abs(SUM(BAL_JRZC)), abs(SUM(AVG_D_JRZC)), abs(SUM(BAL_BBW)), abs(SUM(AVG_D_BBW)), abs(SUM(TICKETDELS)), abs(SUM(TICKETRATIO)), abs(SUM(WKLODEQ)), abs(SUM(CREDIT)), 1, abs(SUM(CUSTNO)), abs(SUM(MOVEAC)), abs(SUM(ACNTTIME)), abs(SUM(LENDERS)), abs(SUM(VOLB)), abs(SUM(TRANSNUM)), abs(SUM(APPROVAL)), abs(SUM(TRANS_COUNT_SCF_S)), abs(SUM(DIFFICULTY)), abs(SUM(TRANS_COUNT_MJ_S)), abs(SUM(INVEBAPR)),abs(SUM(BAL_SXZC_LY)),abs(SUM(RMB_TOTAL_AMT)),abs(SUM(FOR_TOTAL_AMT)),abs(SUM(IS_NEW)),ZGUEST_GROUP, COUNT(INTERESTIN) FROM tempA GROUP BY PREFIX,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,ZGUEST_GROUP proc;
create table T1(PERIO VARCHAR(7),KEYVALUE VARCHAR(60),ACNTAGE VARCHAR(50),OPTNAGE VARCHAR(50),BMD_CODE VARCHAR(20),COBASEDPRO VARCHAR(50),GRPID_LOB VARCHAR(35),GRPID_CUSCAT VARCHAR(35),GRPID_PRDSA VARCHAR(35),LOBID_MAPRD VARCHAR(18),LOBID_MACUS VARCHAR(18),CUSCAT_MAIN VARCHAR(18),CUSTMNO VARCHAR(50), STAFFNO VARCHAR(50),BEASID VARCHAR(50),SELIID VARCHAR(50),ZGUEST_GROUP VARCHAR(20) );
insert into T1(PERIO,KEYVALUE,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,ZGUEST_GROUP) SELECT A.PERIO,A.KEYVALUE,A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.GRPID_CUSCAT,IFNULL(C.STAFFNO,'9999999999'),A.BEASID,A.SELIID,A.ZGUEST_GROUP  FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST  B ON A.CUSTMNO = B.CUSTMNO  left JOIN C ON A.STAFFNO = C.STAFFNO left JOIN E ON A.COBASEDPRO = E.PRDLEAF  WHERE B.CUSTMNO IS NULL AND A.PERIO= '2018001' AND E.PRDLEAF IS NULL  and B.PERIO <= '2018001' proc;
insert into ZNMAT004KEYMAP (mandt,perio,COKEY_OLD,COKEY_NEW)  SELECT '123','2018001',T1.KEYVALUE,T2.KEYVALUE  FROM ZNMAT004 T2 join T1 on T2.STAFFNO =	T1.STAFFNO and T2.ACNTAGE = T1.ACNTAGE  WHERE T2.PERIO = '2018001' ORDER BY T2.KEYVALUE ASC,T1.KEYVALUE ASC proc;
create table T3(PERIO VARCHAR(7),KEYVALUE VARCHAR(60),ACNTAGE VARCHAR(50),OPTNAGE VARCHAR(50),BMD_CODE VARCHAR(20),COBASEDPRO VARCHAR(50),GRPID_LOB VARCHAR(35),GRPID_CUSCAT VARCHAR(35),GRPID_PRDSA VARCHAR(35),LOBID_MAPRD VARCHAR(18),LOBID_MACUS VARCHAR(18),CUSCAT_MAIN VARCHAR(18),CUSTMNO VARCHAR(50), STAFFNO VARCHAR(50),BEASID VARCHAR(50),SELIID VARCHAR(50),ZGUEST_GROUP VARCHAR(20) );
insert into T3(PERIO,KEYVALUE,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,ZGUEST_GROUP) SELECT A.PERIO,A.KEYVALUE,A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.CUSTMNO,case A.STAFFNO when '' then '9999999999' else A.STAFFNO end AS STAFFNO,A.BEASID,A.SELIID,A.ZGUEST_GROUP  FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST B ON A.CUSTMNO = B.CUSTMNO left JOIN E ON A.COBASEDPRO = E.PRDLEAF	WHERE B.CUSTMNO IS not NULL  and B.PERIO <= '2018001' AND E.PRDLEAF IS NULL	AND  A.PERIO = '2018001' proc;
insert into ZNMAT004KEYMAP(mandt,perio,COKEY_OLD,COKEY_NEW) SELECT '123','2018001',T3.KEYVALUE,T2.KEYVALUE  FROM ZNMAT004 T2 join T3 on T2.ACNTAGE = T3.ACNTAGE   AND T2.STAFFNO =	T3.STAFFNO  WHERE T2.PERIO = '2018001' AND T2.DATYPE ='Y2' AND  T2.KEYVALUE like '1%' ORDER BY T2.KEYVALUE ASC,T3.KEYVALUE ASC proc;
create table tempC(MANDT VARCHAR(3),DATYPE VARCHAR(2),PERIO VARCHAR(7),KEYVALUE VARCHAR(60),GENERALACNT VARCHAR(50),ACNTAGE VARCHAR(50),OPTNAGE VARCHAR(50),BMD_CODE VARCHAR(20),COBASEDPRO VARCHAR(50),GRPID_LOB VARCHAR(35),GRPID_CUSCAT VARCHAR(35),GRPID_PRDSA VARCHAR(35),LOBID_MAPRD VARCHAR(18),LOBID_MACUS VARCHAR(18),CUSCAT_MAIN VARCHAR(18),CUSTMNO VARCHAR(50),STAFFNO VARCHAR(50),BEASID VARCHAR(50),SELIID VARCHAR(50),INTERESTIN DOUBLE,CSTCAPITAL DOUBLE,VALCAPITAL DOUBLE,INTERESTEX DOUBLE,FEECOMIN DOUBLE,FEECOMEX DOUBLE,REINVES DOUBLE,VALUEGAINS DOUBLE,EXCHANGE DOUBLE,REBZNSO DOUBLE,PFABLITY DOUBLE,JZZB_VAL DOUBLE,INC_TAX DOUBLE,OPTAX DOUBLE,BSGAP DOUBLE,OTHER_COST DOUBLE,INCOME_OPO DOUBLE,EXPENSE_OPO DOUBLE,BAL_AVG_M DOUBLE,MOBGNBA DOUBLE,MOENDBA DOUBLE,IOATCRBTTA DOUBLE,RISKWEASS DOUBLE,CAP_SUM DOUBLE,BAL_BW DOUBLE,VOL_AVG_D DOUBLE,EXPENSE_ZCJZSS DOUBLE,VAL_JZSS DOUBLE,CAPITAL_JG DOUBLE,CAPITAL_CRED DOUBLE,RWA_CR DOUBLE,AVG_D_JZSS DOUBLE,BAL_JRZC DOUBLE,AVG_D_JRZC DOUBLE,BAL_BBW DOUBLE,AVG_D_BBW DOUBLE,TICKETDELS DOUBLE,TICKETRATIO DOUBLE,WKLODEQ DOUBLE,CREDIT DOUBLE,ACNTNUM DOUBLE,CUSTNO DOUBLE,MOVEAC DOUBLE,ACNTTIME DOUBLE,LENDERS DOUBLE,VOLB DOUBLE,TRANSNUM DOUBLE,APPROVAL DOUBLE,TRANS_COUNT_SCF_S DOUBLE,DIFFICULTY DOUBLE,TRANS_COUNT_MJ_S DOUBLE,INVEBAPR DOUBLE,BAL_SXZC_LY DOUBLE,RMB_TOTAL_AMT DOUBLE,FOR_TOTAL_AMT DOUBLE,IS_NEW INT,ZGUEST_GROUP VARCHAR(20),PACKCOUNT int);
INSERT INTO tempC(MANDT,DATYPE,perio,KEYVALUE,GENERALACNT,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,INTERESTIN,CSTCAPITAL,VALCAPITAL,INTERESTEX,FEECOMIN,FEECOMEX,REINVES,VALUEGAINS,EXCHANGE,REBZNSO,PFABLITY,JZZB_VAL,INC_TAX,OPTAX,BSGAP,OTHER_COST,INCOME_OPO,EXPENSE_OPO,BAL_AVG_M,MOBGNBA,MOENDBA,IOATCRBTTA,RISKWEASS,CAP_SUM,BAL_BW,VOL_AVG_D,EXPENSE_ZCJZSS,VAL_JZSS,CAPITAL_JG,CAPITAL_CRED,RWA_CR,AVG_D_JZSS,BAL_JRZC,AVG_D_JRZC,BAL_BBW,AVG_D_BBW,TICKETDELS,TICKETRATIO,WKLODEQ,CREDIT,ACNTNUM,CUSTNO,MOVEAC,ACNTTIME,LENDERS,VOLB,TRANSNUM,APPROVAL,TRANS_COUNT_SCF_S,DIFFICULTY,TRANS_COUNT_MJ_S,INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT) SELECT  '123', 'B0','2018001',A.KEYVALUE,A.GENERALACNT,A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.CUSTMNO,case A.STAFFNO when '' then '9999999999' else A.STAFFNO end AS STAFFNO,A.BEASID,A.SELIID,ABS(A.INTERESTIN),ABS(A.CSTCAPITAL),ABS(A.VALCAPITAL),ABS(A.INTERESTEX),ABS(A.FEECOMIN),ABS(A.FEECOMEX),ABS(A.REINVES),ABS(A.VALUEGAINS),ABS(A.EXCHANGE),ABS(A.REBZNSO),ABS(A.PFABLITY),ABS(A.JZZB_VAL),ABS(A.INC_TAX),ABS(A.OPTAX),ABS(A.BSGAP),ABS(A.OTHER_COST),ABS(A.INCOME_OPO),ABS(A.EXPENSE_OPO),ABS(A.BAL_AVG_M),ABS(A.MOBGNBA),ABS(A.MOENDBA),ABS(A.IOATCRBTTA),ABS(A.RISKWEASS),ABS(A.CAP_SUM),ABS(A.BAL_BW),ABS(A.VOL_AVG_D),ABS(A.EXPENSE_ZCJZSS),ABS(A.VAL_JZSS),ABS(A.CAPITAL_JG),ABS(A.CAPITAL_CRED),ABS(A.RWA_CR),ABS(A.AVG_D_JZSS),ABS(A.BAL_JRZC),ABS(A.AVG_D_JRZC),ABS(A.BAL_BBW),ABS(A.AVG_D_BBW),ABS(A.TICKETDELS),ABS(A.TICKETRATIO),ABS(A.WKLODEQ),ABS(A.CREDIT),ABS(A.ACNTNUM),ABS(A.CUSTNO),ABS(A.MOVEAC),ABS(A.ACNTTIME),ABS(A.LENDERS),ABS(A.VOLB),ABS(A.TRANSNUM),ABS(A.APPROVAL),ABS(A.TRANS_COUNT_SCF_S),ABS(A.DIFFICULTY),ABS(A.TRANS_COUNT_MJ_S),ABS(A.INVEBAPR),ABS(A.BAL_SXZC_LY),ABS(A.RMB_TOTAL_AMT),ABS(A.FOR_TOTAL_AMT),ABS(A.IS_NEW),A.ZGUEST_GROUP,0 FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST B ON A.CUSTMNO = B.CUSTMNO left JOIN E ON A.COBASEDPRO = E.PRDLEAF  WHERE B.CUSTMNO IS NOT NULL	AND A.PERIO= '2018001'  and B.PERIO <= '2018001' AND E.PRDLEAF IS NOT NULL proc;
INSERT INTO tempC(MANDT,DATYPE,perio,KEYVALUE,GENERALACNT,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,INTERESTIN,CSTCAPITAL,VALCAPITAL,INTERESTEX,FEECOMIN,FEECOMEX,REINVES,VALUEGAINS,EXCHANGE,REBZNSO,PFABLITY,JZZB_VAL,INC_TAX,OPTAX,BSGAP,OTHER_COST,INCOME_OPO,EXPENSE_OPO,BAL_AVG_M,MOBGNBA,MOENDBA,IOATCRBTTA,RISKWEASS,CAP_SUM,BAL_BW,VOL_AVG_D,EXPENSE_ZCJZSS,VAL_JZSS,CAPITAL_JG,CAPITAL_CRED,RWA_CR,AVG_D_JZSS,BAL_JRZC,AVG_D_JRZC,BAL_BBW,AVG_D_BBW,TICKETDELS,TICKETRATIO,WKLODEQ,CREDIT,ACNTNUM,CUSTNO,MOVEAC,ACNTTIME,LENDERS,VOLB,TRANSNUM,APPROVAL,TRANS_COUNT_SCF_S,DIFFICULTY,TRANS_COUNT_MJ_S,INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT) SELECT  '123', 'B0','2018001',A.KEYVALUE,A.GENERALACNT,A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.CUSTMNO,case A.STAFFNO when '' then '9999999999' else A.STAFFNO end AS STAFFNO,A.BEASID,A.SELIID,ABS(A.INTERESTIN),ABS(A.CSTCAPITAL),ABS(A.VALCAPITAL),ABS(A.INTERESTEX),ABS(A.FEECOMIN),ABS(A.FEECOMEX),ABS(A.REINVES),ABS(A.VALUEGAINS),ABS(A.EXCHANGE),ABS(A.REBZNSO),ABS(A.PFABLITY),ABS(A.JZZB_VAL),ABS(A.INC_TAX),ABS(A.OPTAX),ABS(A.BSGAP),ABS(A.OTHER_COST),ABS(A.INCOME_OPO),ABS(A.EXPENSE_OPO),ABS(A.BAL_AVG_M),ABS(A.MOBGNBA),ABS(A.MOENDBA),ABS(A.IOATCRBTTA),ABS(A.RISKWEASS),ABS(A.CAP_SUM),ABS(A.BAL_BW),ABS(A.VOL_AVG_D),ABS(A.EXPENSE_ZCJZSS),ABS(A.VAL_JZSS),ABS(A.CAPITAL_JG),ABS(A.CAPITAL_CRED),ABS(A.RWA_CR),ABS(A.AVG_D_JZSS),ABS(A.BAL_JRZC),ABS(A.AVG_D_JRZC),ABS(A.BAL_BBW),ABS(A.AVG_D_BBW),ABS(A.TICKETDELS),ABS(A.TICKETRATIO),ABS(A.WKLODEQ),ABS(A.CREDIT),ABS(A.ACNTNUM),ABS(A.CUSTNO),ABS(A.MOVEAC),ABS(A.ACNTTIME),ABS(A.LENDERS),ABS(A.VOLB),ABS(A.TRANSNUM),ABS(A.APPROVAL),ABS(A.TRANS_COUNT_SCF_S),ABS(A.DIFFICULTY),ABS(A.TRANS_COUNT_MJ_S),ABS(A.INVEBAPR),ABS(A.BAL_SXZC_LY),ABS(A.RMB_TOTAL_AMT),ABS(A.FOR_TOTAL_AMT),ABS(A.IS_NEW),A.ZGUEST_GROUP,0FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST B ON A.CUSTMNO = B.CUSTMNO left JOIN F ON A.COBASEDPRO = F.PRDLEAF WHERE  B.CUSTMNO IS NOT NULL	AND A.PERIO= '2018001'  and B.PERIO <= '2018001' AND F.PRDLEAF IS NOT NULL proc;
INSERT INTO ZNMAT004(MANDT,DATYPE,PERIO,KEYVALUE,GENERALACNT,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,INTERESTIN,CSTCAPITAL,VALCAPITAL,INTERESTEX,FEECOMIN,FEECOMEX,REINVES,VALUEGAINS,EXCHANGE,REBZNSO,PFABLITY,JZZB_VAL,INC_TAX,OPTAX,	BSGAP,OTHER_COST,INCOME_OPO,EXPENSE_OPO,BAL_AVG_M,MOBGNBA,MOENDBA,IOATCRBTTA,RISKWEASS,CAP_SUM,BAL_BW,VOL_AVG_D,EXPENSE_ZCJZSS,VAL_JZSS,CAPITAL_JG,CAPITAL_CRED,RWA_CR,AVG_D_JZSS,BAL_JRZC,AVG_D_JRZC,BAL_BBW,AVG_D_BBW,TICKETDELS,TICKETRATIO,WKLODEQ,CREDIT,ACNTNUM,CUSTNO,MOVEAC,ACNTTIME,LENDERS,VOLB,TRANSNUM,APPROVAL,TRANS_COUNT_SCF_S,DIFFICULTY,TRANS_COUNT_MJ_S,INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT) select DISTINCT MANDT,DATYPE,PERIO,KEYVALUE,GENERALACNT,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,INTERESTIN,CSTCAPITAL,VALCAPITAL,INTERESTEX,FEECOMIN,FEECOMEX,REINVES,VALUEGAINS,EXCHANGE,REBZNSO,PFABLITY,JZZB_VAL,INC_TAX,OPTAX,	BSGAP,OTHER_COST,INCOME_OPO,EXPENSE_OPO,BAL_AVG_M,MOBGNBA,MOENDBA,IOATCRBTTA,RISKWEASS,CAP_SUM,BAL_BW,VOL_AVG_D,EXPENSE_ZCJZSS,VAL_JZSS,CAPITAL_JG,CAPITAL_CRED,RWA_CR,AVG_D_JZSS,BAL_JRZC,AVG_D_JRZC,BAL_BBW,AVG_D_BBW,TICKETDELS,TICKETRATIO,WKLODEQ,CREDIT,ACNTNUM,CUSTNO,MOVEAC,ACNTTIME,LENDERS,VOLB,TRANSNUM,APPROVAL,TRANS_COUNT_SCF_S,DIFFICULTY,TRANS_COUNT_MJ_S,INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT from tempC group by MANDT,DATYPE,PERIO,KEYVALUE,GENERALACNT,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,INTERESTIN,CSTCAPITAL,VALCAPITAL,INTERESTEX,FEECOMIN,FEECOMEX,REINVES,VALUEGAINS,EXCHANGE,REBZNSO,PFABLITY,JZZB_VAL,INC_TAX,OPTAX,BSGAP,OTHER_COST,INCOME_OPO,EXPENSE_OPO,BAL_AVG_M,MOBGNBA,MOENDBA,IOATCRBTTA,RISKWEASS,CAP_SUM,BAL_BW,VOL_AVG_D,EXPENSE_ZCJZSS,VAL_JZSS,CAPITAL_JG,CAPITAL_CRED,RWA_CR,AVG_D_JZSS,BAL_JRZC,AVG_D_JRZC,BAL_BBW,AVG_D_BBW,TICKETDELS,TICKETRATIO,WKLODEQ,CREDIT,ACNTNUM,CUSTNO,MOVEAC,ACNTTIME,LENDERS,VOLB,TRANSNUM,APPROVAL,TRANS_COUNT_SCF_S,DIFFICULTY,TRANS_COUNT_MJ_S,INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT proc;
create table T4(GENERALACNT VARCHAR(50),GRPID_LOB VARCHAR(35),PERIO VARCHAR(7));
insert into T4 SELECT GENERALACNT,GRPID_LOB,PERIO FROM ZNMAT004 WHERE PERIO = '2018001' GROUP BY GENERALACNT,GRPID_LOB,PERIO proc;
insert into ZNMAT021 (MANDT,LOB_PERIO,LOB_WD_ID,LOB_COKEY,LOB_WD_VAL) SELECT '123', '2018001', '101',T4.GENERALACNT, T2.GROUP_VAL FROM T4 join ZNMAT133 T2 on T4.GRPID_LOB = T2.GROUP_ID where T2.GROUP_TYPE like '1%' AND T4.PERIO = '2018001' GROUP BY T4.PERIO,T4.GENERALACNT, T2.GROUP_VAL proc;
insert into ZNMAT021(MANDT,LOB_PERIO,LOB_WD_ID,LOB_COKEY,LOB_WD_VAL) SELECT '123','2018001', '102',GENERALACNT,LOBID_MAPRD FROM ZNMAT004 WHERE PERIO = '2018001' AND LOBID_MAPRD <> '' GROUP BY GENERALACNT,LOBID_MAPRD proc;
insert into ZNMAT021 SELECT '123', '2018001', '103',GENERALACNT,LOBID_MACUS FROM ZNMAT004 WHERE LOBID_MACUS <>'' AND	PERIO = '2018001' GROUP BY PERIO,GENERALACNT,LOBID_MACUS proc;
create table tempD(PERIO VARCHAR(7),CUSTMNO VARCHAR(50),GRPID_CUSCAT VARCHAR(35));
INSERT INTO tempD SELECT PERIO,CUSTMNO,GRPID_CUSCAT FROM ZNMAT004 where PERIO = '2018001' proc;
insert into ZNMAT019(CUS_PERIO,CUS_WD_ID,CUS_WD_VAL,CUS_COKEY) SELECT tempD.PERIO,tempD.CUSTMNO ,B.GROUP_VAL,substr(B.GROUP_VAL,1,3) FROM tempD join ZNMAT133 B on tempD.GRPID_CUSCAT = B.GROUP_ID where tempD.PERIO = '2018001' GROUP BY tempD.PERIO,tempD.CUSTMNO,ZNMAT133.GROUP_VAL proc;
insert into ZNMAT020 (mandt, PRD_PERIO, PRD_COKEY, PRD_WD_VAL, PRD_WD_ID) SELECT '123', '2018001','501', GENERALACNT, COBASEDPRO FROM ZNMAT004 WHERE PERIO = '2018001' GROUP BY GENERALACNT,COBASEDPRO proc;
drop table c;
drop table e;
drop table tempa;
drop table tempc;
drop table t1;
drop table t3;
drop table t4;
drop table tempd;