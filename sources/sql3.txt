insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.card_id, 'n_card_medium1_money_total' as index_name, nvl(A.index_value,-1) as index_value, A.report_create_time  from (select t.row_id , t.global_id as card_id, sum(case when t1.cue_sx_amount >= 5000 and t1.cue_sx_amount < 10000 then 1 else null end ) as index_value, max(t.query_time) as report_create_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.card_id, 'n_card_medium2_money_total' as index_name, nvl(A.index_value,-1) as index_value, A.report_create_time  from (select t.row_id , t.global_id as card_id, sum(case when t1.cue_sx_amount >= 10000 and t1.cue_sx_amount < 20000 then 1 else null end ) as index_value, max(t.query_time) as report_create_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.card_id , 'n_card_medium3_money_total' as index_name, nvl(A.index_value,-1) as index_value, A.report_create_time  from (select t.row_id , t.global_id as card_id, sum(case when t1.cue_sx_amount >= 20000 and t1.cue_sx_amount < 50000 then 1 else null end ) as index_value, max(t.query_time) as report_create_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.card_id, 'n_card_high_money_total' as index_name, nvl(A.index_value,-1) as index_value, A.report_create_time  from (select t.row_id , t.global_id as card_id, sum(case when t1.cue_sx_amount >= 50000 then 1 else null end ) as index_value, max(t.query_time) as report_create_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_credit_limit_level_used' as index_name, nvl(t2.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , case when max(t1.cue_sx_amount) < 5000 then 1 when max(t1.cue_sx_amount) >=5000 and max(t1.cue_sx_amount) < 10000 then 2 when max(t1.cue_sx_amount) >=10000 and max(t1.cue_sx_amount) < 20000 then 3 when max(t1.cue_sx_amount) >=20000 and max(t1.cue_sx_amount) < 50000 then 4 when max(t1.cue_sx_amount) >=50000 then 5 else 0 end as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_low_money_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_sx_amount < 5000 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_medium1_money_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_sx_amount >= 5000 and t1.cue_sx_amount < 10000 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_medium2_money_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_sx_amount >= 10000 and t1.cue_sx_amount < 20000 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_medium3_money_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_sx_amount >= 20000 and t1.cue_sx_amount < 50000 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_high_money_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_sx_amount >= 50000 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_mortgage_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_db_way='抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_other_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_db_way in ('其他担保','组合（不含保证）担保','质押（含保证金）担保') group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date ) select t.row_id , t.global_id, 'n_card_guaranteetype_free_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_db_way in ('信用/免担保') group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_assurance_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_db_way in ('保证') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_n_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_n_nonactive' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('未激活','/N') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_n_closed' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(distinct t1.cue) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('冻结','销户','止付') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_n_total' as index_name, nvl(t2.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'credit_card_n_Freeze' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('冻结') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_first_creditlimit' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id , t1.global_id , t1.cue_sx_amount as index_value from (select row_id ,global_id ,cue_sx_amount , row_number() over(partition by row_id ,global_id order by cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloancardinfo_all where global_id is not null and row_id is not null ) t1 where t1.rn = 1 )t2 on t.row_id=t2.row_id and t.global_id = t2.global_id where t.row_id is not null ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_business_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人经营性贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_car_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_commercial_house_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人商用房（包括商住两用）贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_consumer_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人消费贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_student_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人助学贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_housing_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_farmer_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='农户贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'sum_house_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl like '%房%' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_other_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl not like '%房%' and t1.cue_amt_zl='个人汽车贷款' and t1.cue_amt_zl is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'other_loan_guranteetype_used' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.state is not null and t1.state<>'结清' and t1.cue_db_way in ('混合担保','抵押担保','非抵押担保') then '1' else '0' end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'sum_car_house_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(*) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where (t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%汽车%') and t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_assurance_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum( case when t1.cue_db_way<>'保证' then 0 else 1 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') and t1.cue_db_way is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_mortgage_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_db_way<>'抵押担保' then 0 else 1 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') and t1.cue_db_way is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_famer_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_db_way<>'农户联保' then 0 else 1 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') and t1.cue_db_way is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_other_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_db_way in ('其他担保','质押（含保证金）担保','组合（含保证）担保','组合（不含保证）担保') then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') and t1.cue_db_way is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_free_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_db_way in ('信用/免担保') then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') and t1.cue_db_way is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_month_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_gh_way like '%按月归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_quarter_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_gh_way like '%按季归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_year_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum( case when t1.cue_gh_way like '%按年归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_one_time_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_gh_way like '%一次性归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_irregular_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_gh_way like '%不定期归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_other_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum( case when t1.cue_gh_way like '%按日归还%' or t1.cue_gh_way like '%按周归还%' or t1.cue_gh_way like '%按半年归还%' or t1.cue_gh_way like '%按其他方式归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_mini_repay_card' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.actualpaymentamount <>0 and t1.scheduledpaymentamount/t1.actualpaymentamount >= 0.8 and t1.scheduledpaymentamount/t1.actualpaymentamount <= 1.2 then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_credit_card_used' as index_name, nvl(t1.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select A.REPORT_ID ,A.cert_no , max(replace(A.loan_card_count,'/N',0)) as index_value from TBL_PER_INFO_SUMARRY A left join (select row_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all where state in ('正常','呆账') ) B on A.REPORT_ID = B.row_id group by A.REPORT_ID ,A.cert_no ) t1 on t.row_id = t1.REPORT_ID and t.global_id = t1.cert_no ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_q_credit_card_used' as index_name, nvl(t1.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select A.REPORT_ID ,A.cert_no , max(replace(A.standard_loan_card_count,'/N',0)) as index_value from TBL_PER_INFO_SUMARRY A left join (select row_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all where state in ('正常','呆账') ) B on A.REPORT_ID = B.row_id group by A.REPORT_ID ,A.cert_no ) t1 on t.row_id=t1.REPORT_ID and t.global_id = t1.cert_no ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_credit_card_total' as index_name, nvl(t1.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select REPORT_ID ,cert_no , max(replace(loan_card_count,'/N',0)) as index_value from TBL_PER_INFO_SUMARRY group by REPORT_ID ,cert_no ) t1 on t.row_id=t1.REPORT_ID and t.global_id = t1.cert_no ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_q_credit_card_total' as index_name, nvl(t1.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select REPORT_ID ,cert_no, max(replace(standard_loan_card_count,'/N',0)) as index_value from TBL_PER_INFO_SUMARRY group by REPORT_ID ,cert_no ) t1 on t.row_id=t1.REPORT_ID and t.global_id = t1.cert_no ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_mortgage_n_used' as index_name, nvl(cast(sum(t3.index_value) as integer),-1) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when (t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%车%' or t1.cue_db_way='抵押担保') and t1.state in ('正常','逾期','呆账') then 1 when (t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%车%' or t1.cue_db_way='抵押担保') and t1.state='结清' then 0 else null end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id union all select t2.row_id , t2.global_id , sum(case when t2.cue_db_way='抵押担保' and t2.cue_sx_amount>=150000 and t2.state in ('正常','呆账') then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t2 where t2.row_id is not null and t2.state <>'/N' group by t2.row_id ,t2.global_id ) t3 on t.row_id=t3.row_id and t.global_id = t3.global_id group by t.row_id , t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_mortgage_n_closed' as index_name, nvl(cast(sum(t2.index_value) as integer),-1) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when (t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%车%' or t1.cue_db_way='抵押担保') and t1.state='结清' then 1 when (t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%车%' or t1.cue_db_way='抵押担保') and t1.state<>'结清' then 0 else null end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_mortgage_n_total' as index_name, nvl(cast(sum(t3.index_value) as integer),-1) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%车%' or t1.cue_db_way='抵押担保' then 1 when (t1.cue_amt_zl not like '%房%' or t1.cue_amt_zl not like '%车%' or t1.cue_db_way<>'抵押担保') and t1.state <> '/N' then 0 else null end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id union all select t2.row_id ,t2.global_id , sum(case when t2.cue_db_way='抵押担保' and t2.cue_sx_amount>=150000 then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t2 where t2.row_id is not null and t2.state <>'/N' group by t2.row_id ,t2.global_id ) t3 on t.row_id=t3.row_id and t.global_id = t3.global_id group by t.row_id , t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'nonmortgage_n_used' as index_name ,nvl(max(t2.index_value),-1) as index_value ,max(t1.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id ,t.global_id ,cast(sum(t.a) as integer) as index_value from (select row_id , global_id ,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where (cue_amt_zl not like '%房%' or cue_amt_zl not like '%车%') and cue_db_way <> '抵押担保' and state in ('正常','呆账') group by row_id , global_id ) t group by t.row_id ,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'nonmortgage_n_closed' as index_name, nvl(max(t2.index_value),-1) as index_value, max(t1.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id ,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where (cue_amt_zl not like '%房%' or cue_amt_zl not like '%车%') and cue_db_way <> '抵押担保' and state='结清' group by row_id,global_id ) t group by t.row_id ,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'nonmortgage_n_total' as index_name, nvl(max(t2.index_value),-1) as index_value, max(t1.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where (cue_amt_zl not like '%房%' or cue_amt_zl not like '%车%') and cue_db_way <> '抵押担保' group by row_id,global_id ) t group by t.row_id ,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_n_used' as index_name, nvl(max(t2.index_value),-1) as index_value, max(t1.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where state in ('正常','呆账') group by row_id,global_id) t group by t.row_id,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_n_closed' as index_name, nvl(max(t2.index_value),-1) as index_value, max(t1.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where state='结清' group by row_id,global_id ) t group by t.row_id,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_n_total' as index_name, nvl(max(t2.index_value),0) as index_value, max(t1.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where state <>'/N' group by row_id,global_id ) t group by t.row_id,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_first_type' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id , W.cue_amt_zl as index_value from (select t.row_id ,t.global_id , t.cue_amt_zl , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloaninfo_all t where t.cue_out_time is not null and t.global_id is not null ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_first_guaranteetype' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id , W.cue_db_way as index_value from (select t.row_id ,t.global_id , t.cue_db_way , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloaninfo_all t where t.cue_out_time is not null and t.global_id is not null ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_first_over' as index_name, nvl(t3.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t2.row_id, t2.global_id , case when t2.state='结清' then '1' else '0' end as index_value from (select W.row_id ,W.global_id , W.state from (select t.row_id , t.global_id , t.state , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloaninfo_all t where t.cue_out_time is not null and t.global_id is not null ) W where W.rn =1 ) t2 ) t3 on t1.row_id=t3.row_id and t1.global_id = t3.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_first_amount' as index_name, nvl(t2.index_value,-1) as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id , W.cue_amt as index_value from (select t.row_id ,t.global_id , t.cue_amt , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloaninfo_all t where t.cue_out_time is not null and t.global_id is not null ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_closed' as index_name, nvl(t2.index_value,-1) as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(*) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where state = '结清' group by row_id,global_id union all select row_id,global_id,count(*) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all where state = '销户' group by row_id,global_id) t group by t.row_id ,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_total' as index_name, nvl(t2.index_value,'0') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(*) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where state <>'/N' group by row_id,global_id union all select row_id,global_id,count(*) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all where state <>'/N' group by row_id,global_id) t group by t.row_id,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_first_type' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id , W.cue_cust_type as index_value from (select t.row_id ,t.global_id , t.cue_cust_type , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloancardinfo_all t where t.cue_out_time is not null and t.global_id is not null ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_first_guaranteetype' as index_name, nvl(t2.index_value,'无信贷账户') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id, W.cue_db_way as index_value from (select t.row_id ,t.global_id, t.cue_db_way , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloancardinfo_all t where t.cue_out_time is not null and t.global_id is not null and state <> '/N' ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_first_over' as index_name, nvl(t3.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t2.row_id ,t2.global_id , case when t2.state='销户' then '1' else '0' end as index_value from (select W.row_id ,W.global_id , W.state from (select t.row_id ,t.global_id, t.state , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloancardinfo_all t where t.cue_out_time is not null and t.global_id is not null and state <> '/N' ) W where W.rn =1 ) t2 ) t3 on t1.row_id=t3.row_id and t1.global_id = t3.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_first_amount' as index_name, nvl(t2.index_value,-1) as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id , W.cue_sx_amount as index_value from (select t.row_id ,t.global_id , t.cue_sx_amount , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloancardinfo_all t where t.cue_out_time is not null and t.global_id is not null and state <> '/N' ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'card_max_creditlimit_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,max(cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_out_time is not null and row_id is not null and state in ('正常','呆账') group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'card_sum_creditlimit_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,sum(cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_out_time is not null and row_id is not null and state in ('正常','呆账') group by row_id ,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'card_max_creditlimit_total' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,max(cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_out_time is not null and row_id is not null and state <> '/N' group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_max_creditlimitamount_used' as index_name, nvl(t.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t2.row_id,t2.global_id,max(t2.cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t2 left join (select row_id from hdm_wbd_zx_qry_tblpbocloaninfo_all where state not in ('结清','/N') ) t3 on t2.row_id = t3.row_id where t2.cue_out_time is not null group by t2.row_id,t2.global_id ) t on t1.row_id=t.row_id and t1.global_id = t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_max_creditlimitamount_total' as index_name, nvl(t.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t2.row_id,t2.global_id,max(t2.cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t2 left join (select row_id from hdm_wbd_zx_qry_tblpbocloaninfo_all where state not in ('/N')) t3 on t2.row_id = t3.row_id where t2.cue_out_time is not null group by t2.row_id,t2.global_id ) t on t1.row_id=t.row_id and t1.global_id = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'card_min_creditlimit_total' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,nvl(min(cue_sx_amount),0) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_out_time is not null and row_id is not null and state <> '/N' group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'card_min_creditlimit_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,nvl(min(cue_sx_amount),0) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_out_time is not null and row_id is not null and state in ('正常','呆账') group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_min_creditlimitamount_total' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,min(cue_amt) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all where state<>'/N' group by row_id ,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_min_creditlimitamount_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,min(cue_amt) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all where state not in ('结清','/N') group by row_id ,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'n_card_last3_high_money_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,min(cue_amt) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all where state not in ('结清','/N') group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'n_card_5hundred_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,count(*) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_sx_amount < 500 and state in ('正常','呆账') group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_org_type' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all where row_id is not null group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_mortgage_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '/N' and t1.cue_db_way='抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_other_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '/N' and t1.cue_db_way in ('其他担保','组合（不含保证）担保','质押（含保证金）担保') group by t1.global_id,t1.row_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_free_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '/N' and t1.cue_db_way in ('信用/免担保') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_assurance_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '/N' and t1.cue_db_way in ('保证') group by t1.row_id,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_business_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '/N' and t1.cue_amt_zl='个人经营性贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_car_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '/N' and t1.cue_amt_zl='个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_commercial_house_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '/N' and t1.cue_amt_zl='个人商用房（包括商住两用）贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_consumer_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '/N' and t1.cue_amt_zl='个人消费贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_student_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '/N' and t1.cue_amt_zl='个人助学贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_housing_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '/N' and t1.cue_amt_zl='个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_housing_fund_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '/N' and t1.cue_amt_zl='个人住房公积金贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_farmer_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '/N' and t1.cue_amt_zl='农户贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'sum_house_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '/N' and t1.cue_amt_zl like '%房%' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_other_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '/N' and t1.cue_amt_zl not like '%房%' and t1.cue_amt_zl not like '%车%' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'other_loan_guaranteetype_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.cue_db_way in ('混合担保','抵押担保','非抵押担保') then '1' else '0' end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' and t1.cue_amt_zl = '其他贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'car_loan_guaranteetype_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.cue_db_way in ('混合担保','抵押担保','非抵押担保') then '1' else '0' end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' and t1.cue_amt_zl like '%车%' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'sum_car_house_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_amt_zl like '%车%' or t1.cue_amt_zl like '%房%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_assurance_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_db_way='保证' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_mortgage_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_db_way='抵押担保' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_famer_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_db_way='农户联保' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_other_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_db_way in ('其他担保','质押（含保证金）担保','组合（不含保证）担保','组合（含保证）担保') then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_free_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_db_way='信用/免担保' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_month_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_gh_way like '%按月归还%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_quarter_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_gh_way like '%按季归还%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_year_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_gh_way like '%按年归还%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_one_time_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_gh_way like '%一次性归还%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_irregular_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_gh_way like '%不定期归还%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_other_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_gh_way like '%按日归还%' or t1.cue_gh_way like '%按周归还%' or t1.cue_gh_way like '%按半年归还%' or t1.cue_gh_way like '%按其他方式归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'/N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m1_3m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m1_6m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m1_12m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m1_24m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m2_3m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m2_6m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m2_12m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m2_24m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'credit_card_ov_3m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'credit_card_ov_6m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'credit_card_ov_12m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_now_n' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverduecyc) else null end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_now_money' as index_name, sum(nvl(t2.index_value, '0')) as index_value, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverdueamount) else null end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_first_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'card_max_month_ol_24m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME, t2.index_value as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME, t2.index_value as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '准贷记卡' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_third_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_mortgage_first_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_mortgage_max_month_ol_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (t1.cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or t1.cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_mortgage_third_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (t1.cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or t1.cue_db_way = '抵押担保') and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'house_ol_3m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'house_ol_6m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'house_ol_12m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'house_ol_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'car_ol_3m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'car_ol_6m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'car_ol_12m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'car_ol_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_ol_3m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_ol_6m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_ol_12m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_ol_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'loan_mortgage_ol_3m' as index_name, sum(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from ( select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.state = '正常' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'loan_mortgage_ol_6m' as index_name, sum(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'loan_mortgage_ol_12m' as index_name, sum(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'loan_mortgage_ol_24m' as index_name, sum(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_ol_3m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_ol_6m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_ol_12m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_ol_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_first_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_max_month_ol_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_third_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m1_3m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m1_6m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m1_12m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m1_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m2_3m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m2_6m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m2_12m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m2_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_now_n' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverduecyc) else null end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_now_money' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverdueamount) else null end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_first_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_max_month_ol_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_third_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m1_3m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m1_6m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m1_12m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m1_24m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m2_3m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m2_6m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m2_12m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m2_24m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_now_n' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverduecyc) else null end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverduecyc) else null end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_now_money' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverdueamount) else null end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverdueamount) else null end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_max_month_ol_24m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '准贷记卡' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'all_credit_card_max_month_ol' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'all_q_credit_card_max_month_ol' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '准贷记卡' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'all_loan_max_month_ol' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_sixth_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id  as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_mortgage_sixth_ol' as index_name, nvl(t2.index_value, 0) as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_sixth_ol' as index_name, nvl(t2.index_value, 0) as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_six_ol' as index_name, nvl(t2.index_value, 0) as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_3m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_6m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_12m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_24m' as index_name, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_3m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_6m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_12m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_3m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, sum(t2.index_value) as index_value, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id union all select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_6m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, sum(t2.index_value) as index_value, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id union all select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_12m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, sum(t2.index_value) as index_value, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id ,t.global_id union all select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_24m' as index_name, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, sum(t2.index_value) as index_value, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id union all select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'ice_card' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' and t1.state = '冻结' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'stop_pay' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' and t1.state = '止付' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'hk_y_24m' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.latest24state like '%N%' then 1 when t1.latest24state is null then -1 else 0 end ) AS index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_dz_count' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '呆账' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_dz_count' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' and t1.state = '呆账' group by t1.row_id,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'class5_loan_count_N' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.class5state <> '正常' group by t1.row_id,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'class5_loan_count_G' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.class5state = '关注' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_long_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '未激活' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_long_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_short_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.state <> '未激活' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_short_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.state <> '未激活' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_long_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_long_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_short_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_short_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_long_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_long_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_short_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_short_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_long_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_long_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_short_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_short_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_long_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_long_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_short_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_short_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_long_time_total' as index_name, max(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_long_time_sct_total' as index_name, max(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款','个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_short_time_total' as index_name, min(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_short_time_sct_total' as index_name, min(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_long_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_long_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_short_time_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_short_time_sct_total' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_long_time_total' as index_name, max(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '未激活' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_custfirst_age' as index_name, case when cast(t3.index_value as integer) < -1 or t3.index_value is null or cast(t3.index_value as integer) > 150 then '-1' else t3.index_value end as index_value, t3.REPORT_CREATE_TIME as REPORT_CREATE_TIME from (select t.row_id, t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select W.row_id ,W.global_id ,W.cue_out_time from (select t1.row_id , t1.global_id , t1.cue_out_time , row_number() over(partition by t1.global_id order by t1.cue_out_time ) AS rn from (select row_id ,global_id ,cue_out_time from hdm_wbd_zx_qry_tblpbocloancardinfo_all where global_id is not null and state <> '未激活' union all select row_id ,global_id ,cue_out_time from hdm_wbd_zx_qry_tblpbocloaninfo_all where global_id is not null ) t1 ) W where W.rn = 1 ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id left join (select distinct report_id ,cert_no ,birthday from TBL_PER_PERSIONAL_INFO ) t4 on t4.REPORT_ID = t.row_id and t4.cert_no = t.global_id ) t3 ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_long_time_sct_total' as index_name, max(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '未激活' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_short_time_total' as index_name, min(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '未激活' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_short_time_sct_total' as index_name, min(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '未激活' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_long_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_long_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_short_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_short_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_long_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_long_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_short_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_short_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_long_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_long_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_short_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_short_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_long_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_long_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_short_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_short_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_long_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_long_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_short_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_short_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_long_time_used' as index_name, max(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_long_time_sct_used' as index_name, max(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_short_time_used' as index_name, min(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_short_time_sct_used' as index_name, max(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) A group by A.row_id , A.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_long_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_long_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_short_time_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_short_time_sct_used' as index_name, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_long_time_used' as index_name, max(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_long_time_sct_used' as index_name, max(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_short_time_used' as index_name, min(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_short_time_sct_used' as index_name, min(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME from (select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id union all select t.row_id , t.global_id , t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ) t3 group by t3.row_id , t3.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_limit_card_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(case when t3.state in ('正常','呆账') then t3.cue_sx_amount else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%信用卡%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_limit_average_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(case when t3.state in ('正常','呆账') then t3.cue_sx_amount else null end)/count(case when t3.state in ('正常','呆账') then t3.cue_sx_amount else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%信用卡%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_card_use_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(case when t3.state in ('正常','呆账') then t3.cue_sx_amount else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_card_use_sct' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(t3.usedcreditlimitamount) < 50000 then '1' when sum(t3.usedcreditlimitamount) >= 50000 and sum(t3.usedcreditlimitamount) < 100000 then '2' when sum(t3.usedcreditlimitamount) >= 100000 and sum(t3.usedcreditlimitamount) < 150000 then '3' when sum(t3.usedcreditlimitamount) >= 150000 and sum(t3.usedcreditlimitamount) < 200000 then '4' when sum(t3.usedcreditlimitamount) >= 200000 then '5' else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'used_money_six_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(case when t3.state in ('正常','呆账') then t3.latest6monthusedavgamount else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'used_money_six_sct' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(t3.latest6monthusedavgamount) < 50000 then '1' when sum(t3.latest6monthusedavgamount) >= 50000 and sum(t3.latest6monthusedavgamount) < 100000 then '2' when sum(t3.latest6monthusedavgamount) >= 100000 and sum(t3.latest6monthusedavgamount) < 150000 then '3' when sum(t3.latest6monthusedavgamount) >= 150000 and sum(t3.latest6monthusedavgamount) < 200000 then '4' when sum(t3.latest6monthusedavgamount) >= 200000 then '5' else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_six_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_card' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ) W ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_low_money' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t3.cue_sx_amount < 50000 group by t1.global_id ,t1.row_id ) A ) W ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_medium1_money' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t3.cue_sx_amount >= 50000 and t3.cue_sx_amount < 100000 group by t1.global_id ,t1.row_id ) A ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_medium2_money' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t3.cue_sx_amount >= 100000 and t3.cue_sx_amount < 200000 group by t1.global_id ,t1.row_id ) A ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_medium3_money' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t3.cue_sx_amount >= 200000 and t3.cue_sx_amount < 500000 group by t1.global_id ,t1.row_id ) A ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_high_money' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t3.cue_sx_amount >= 500000 group by t1.global_id ,t1.row_id ) A ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_no_new_3m' as index_name, nvl(max(W.index_value),-20) as index_value, max(W.query_time) as report_create_time  from (select A.row_id, A.global_id , case when B.index_value <0.1 then '1' when B.index_value >=0.1 and B.index_value <0.2 then '2' when B.index_value >=0.2 and B.index_value <0.3 then '3' when B.index_value >=0.3 and B.index_value <0.4 then '4' when B.index_value >=0.4 and B.index_value <0.5 then '5' when B.index_value >=0.5 and B.index_value <0.6 then '6' when B.index_value >=0.6 and B.index_value <0.7 then '7' when B.index_value >=0.7 and B.index_value <0.8 then '8' when B.index_value >=0.8 and B.index_value <0.9 then '9' when B.index_value >=0.9 and B.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id =t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id ) A left join (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t1.cue_sx_amount,0)) <> 0 then sum(t1.usedcreditlimitamount)/sum(t1.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) B on A.row_id = B.row_id and A.global_id = B.global_id ) W group by W.row_id, W.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_new_3m' as index_name, nvl(max(W.index_value),-20) as index_value, max(W.query_time) as report_create_time  from (select A.row_id, A.global_id , case when B.index_value <0.1 then '1' when B.index_value >=0.1 and B.index_value <0.2 then '2' when B.index_value >=0.2 and B.index_value <0.3 then '3' when B.index_value >=0.3 and B.index_value <0.4 then '4' when B.index_value >=0.4 and B.index_value <0.5 then '5' when B.index_value >=0.5 and B.index_value <0.6 then '6' when B.index_value >=0.6 and B.index_value <0.7 then '7' when B.index_value >=0.7 and B.index_value <0.8 then '8' when B.index_value >=0.8 and B.index_value <0.9 then '9' when B.index_value >=0.9 and B.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id =t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.cue_cust_type='人民币账户' ) A left join (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t1.cue_sx_amount,0)) <> 0 then sum(t1.usedcreditlimitamount)/sum(t1.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) B on A.row_id = B.row_id and A.global_id = A.global_id ) W group by W.row_id, W.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_no_new_6m' as index_name, nvl(max(W.index_value),-20) as index_value, max(W.query_time) as report_create_time  from (select A.row_id, A.global_id , case when B.index_value <0.1 then '1' when B.index_value >=0.1 and B.index_value <0.2 then '2' when B.index_value >=0.2 and B.index_value <0.3 then '3' when B.index_value >=0.3 and B.index_value <0.4 then '4' when B.index_value >=0.4 and B.index_value <0.5 then '5' when B.index_value >=0.5 and B.index_value <0.6 then '6' when B.index_value >=0.6 and B.index_value <0.7 then '7' when B.index_value >=0.7 and B.index_value <0.8 then '8' when B.index_value >=0.8 and B.index_value <0.9 then '9' when B.index_value >=0.9 and B.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id =t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id ) A left join (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t1.cue_sx_amount,0)) <> 0 then sum(t1.usedcreditlimitamount)/sum(t1.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) B on A.row_id = B.row_id and A.global_id = B.global_id ) W group by W.row_id, W.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_new_6m' as index_name, nvl(max(W.index_value),-20) as index_value, max(W.query_time) as report_create_time  from (select A.row_id, A.global_id , case when B.index_value <0.1 then '1' when B.index_value >=0.1 and B.index_value <0.2 then '2' when B.index_value >=0.2 and B.index_value <0.3 then '3' when B.index_value >=0.3 and B.index_value <0.4 then '4' when B.index_value >=0.4 and B.index_value <0.5 then '5' when B.index_value >=0.5 and B.index_value <0.6 then '6' when B.index_value >=0.6 and B.index_value <0.7 then '7' when B.index_value >=0.7 and B.index_value <0.8 then '8' when B.index_value >=0.8 and B.index_value <0.9 then '9' when B.index_value >=0.9 and B.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.cue_cust_type='人民币账户' ) A left join (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t1.cue_sx_amount,0)) <> 0 then sum(t1.usedcreditlimitamount)/sum(t1.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) B on A.row_id = B.row_id and A.global_id = B.global_id ) W group by W.row_id, W.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_usenow_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_usenow_sct' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ) W ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_max_usenow_six_card' as index_name, max(nvl(A.index_value,-1)) as index_value  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id union all select tt1.row_id ,tt1.global_id ,max(tt1.query_time) as query_time ,case when sum(nvl(tt3.cue_sx_amount,0)) <> 0 then sum(tt3.usedcreditlimitamount)/sum(tt3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new tt1 left join TBL_PER_RECORDDETAIL tt2 on tt2.report_id = tt1.row_id and tt2.cert_no = tt1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue tt3 on tt1.row_id = tt3.row_id and tt1.global_id = tt3.global_id where tt2.queryreason like '%信用卡%' group by tt1.global_id ,tt1.row_id ) A group by A.global_id ,A.row_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_max_usenow_six_sct' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time  from (select A.row_id, A.global_id , case when max(A.index_value) <0.1 then '1' when max(A.index_value) >=0.1 and max(A.index_value) <0.2 then '2' when max(A.index_value) >=0.2 and max(A.index_value) <0.3 then '3' when max(A.index_value) >=0.3 and max(A.index_value) <0.4 then '4' when max(A.index_value) >=0.4 and max(A.index_value) <0.5 then '5' when max(A.index_value) >=0.5 and max(A.index_value) <0.6 then '6' when max(A.index_value) >=0.6 and max(A.index_value) <0.7 then '7' when max(A.index_value) >=0.7 and max(A.index_value) <0.8 then '8' when max(A.index_value) >=0.8 and max(A.index_value) <0.9 then '9' when max(A.index_value) >=0.9 and max(A.index_value) <1.0 then '10' end as index_value, max(A.query_time) as query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id union all select tt1.row_id ,tt1.global_id ,max(tt1.query_time) as query_time ,case when sum(nvl(tt3.cue_sx_amount,0)) <> 0 then sum(tt3.usedcreditlimitamount)/sum(tt3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new tt1 left join TBL_PER_RECORDDETAIL tt2 on tt2.report_id = tt1.row_id and tt2.cert_no = tt1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue tt3 on tt1.row_id = tt3.row_id and tt1.global_id = tt3.global_id where tt2.queryreason like '%信用卡%' group by tt1.global_id ,tt1.row_id ) A group by A.global_id ,A.row_id ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'mini_payment_last' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.scheduledpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'minipay_payamount_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_minipay_payamount_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when min(t3.scheduledpaymentamount) <> 0 then sum(t3.actualpaymentamount)/min(t3.scheduledpaymentamount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_minipay_payamount_sct' as index_name, nvl(W.index_value,-1) as index_value, W.query_time as report_create_time  from (select A.row_id, A.global_id , case when max(A.index_value) <0.1 then '1' when max(A.index_value) >=0.1 and max(A.index_value) <0.2 then '2' when max(A.index_value) >=0.2 and max(A.index_value) <0.3 then '3' when max(A.index_value) >=0.3 and max(A.index_value) <0.4 then '4' when max(A.index_value) >=0.4 and max(A.index_value) <0.5 then '5' when max(A.index_value) >=0.5 and max(A.index_value) <0.6 then '6' when max(A.index_value) >=0.6 and max(A.index_value) <0.7 then '7' when max(A.index_value) >=0.7 and max(A.index_value) <0.8 then '8' when max(A.index_value) >=0.8 and max(A.index_value) <0.9 then '9' when max(A.index_value) >=0.9 and max(A.index_value) <1.0 then '10' else null end as index_value, max(A.query_time) as query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when min(t3.scheduledpaymentamount) <> 0 then sum(t3.actualpaymentamount)/min(t3.scheduledpaymentamount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A group by A.row_id, A.global_id ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'mortgage_balance_loan' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.balance) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way ='抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'mortgage_balance_sct_loan' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,case when sum(t3.balance) < 50000 then '1' when sum(t3.balance) >= 50000 and sum(t3.balance) < 100000 then '2' when sum(t3.balance) >= 100000 and sum(t3.balance) < 150000 then '3' when sum(t3.balance) >= 150000 and sum(t3.balance) < 200000 then '4' when sum(t3.balance) >= 200000 then '5' else null end as index_value ,max(t1.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way ='抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_mortgage_loan_low_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.cue_db_way ='抵押担保' then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt < 50000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_mortgage_loan_medium1_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.cue_db_way ='抵押担保' then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 50000 and t3.cue_amt < 200000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_mortgage_loan_medium2_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.cue_db_way ='抵押担保' then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 200000 and t3.cue_amt < 600000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_mortgage_loan_medium3_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.cue_db_way ='抵押担保' then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 600000 and t3.cue_amt < 1000000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_mortgage_loan_high_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.cue_db_way ='抵押担保' then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 1000000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'mortgage_pay_amount_last' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way ='抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'nonmortgage_balance_loan' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.balance) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'nonmortgage_balance_sct_loan' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(t3.balance) < 50000 then '1' when sum(t3.balance) >= 50000 and sum(t3.balance) < 100000 then '2' when sum(t3.balance) >= 100000 and sum(t3.balance) < 150000 then '3' when sum(t3.balance) >= 150000 and sum(t3.balance) < 200000 then '4' when sum(t3.balance) >= 200000 then '5' else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_nonmortgage_low_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt < 50000 and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_nonmortgage_medium1_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 50000 and t3.cue_amt < 200000 and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_nonmortgage_medium2_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 200000 and t3.cue_amt < 600000 and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_nonmortgage_medium3_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 600000 and t3.cue_amt < 100000 and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_nonmortgage_high_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 100000 and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'nonmortgage_pay_amount_last' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'loan_balance' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.balance) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'loan_balance_sct' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(t3.balance) < 50000 then '1' when sum(t3.balance) >= 50000 and sum(t3.balance) < 100000 then '2' when sum(t3.balance) >= 100000 and sum(t3.balance) < 150000 then '3' when sum(t3.balance) >= 150000 and sum(t3.balance) < 200000 then '4' when sum(t3.balance) >= 200000 then '5' else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_loan_low_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt < 50000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_loan_medium1_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 50000 and t3.cue_amt < 200000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_loan_medium2_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 200000 and t3.cue_amt < 600000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_loan_medium3_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 600000 and t3.cue_amt < 1000000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_loan_high_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 1000000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'pay_amount_last_loan' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_limit_card_total' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%信用卡%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_limit_average_total' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when count(1) <> 0 then sum(t3.cue_sx_amount)/count(1) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%信用卡%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'house_repay_amount_1m' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt_zl ='个人住房贷款' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'car_repay_amount_1m' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt_zl ='个人汽车贷款' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_six_card_house_amount' as index_name, case when sum(t3.actualpaymentamount) <> 0 then nvl(sum(A.usedcreditlimitamount) /sum(t3.actualpaymentamount) ,0) else -1 end as index_value   from (select t.row_id, t.global_id, max(t.query_time) as query_time , max(replace(replace(substr(t2.querydate,1,10),'.',''),'/N','')) as querydate , sum(t1.usedcreditlimitamount) as usedcreditlimitamount from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.cue_cust_type='人民币账户' and t2.queryreason like '%信用卡%' group by t.row_id ,t.global_id ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_use_card_house_amount' as index_name, case when sum(t3.actualpaymentamount) <> 0 then nvl(sum(A.usedcreditlimitamount) /sum(t3.actualpaymentamount) ,0) else -1 end as index_value   from (select t.row_id, t.global_id, max(t.query_time) as query_time , max(replace(replace(substr(t2.querydate,1,10),'.',''),'/N','')) as querydate , sum(t1.usedcreditlimitamount) as usedcreditlimitamount from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.cue_cust_type='人民币账户' and t2.queryreason like '%信用卡%' group by t.row_id ,t.global_id ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_usenow_credit_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when nvl(sum(t3.cue_sx_amount),0) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t3.cue_card_type like '%贷记卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_usenow_q_credit_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when nvl(sum(t3.cue_sx_amount),0) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t3.cue_card_type like '%准贷记卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_six_credit_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when nvl(sum(t3.cue_sx_amount),0) <> 0 then sum(t3.latest6monthusedavgamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t3.cue_card_type like '%贷记卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_six_q_credit_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(t3.cue_sx_amount) <> 0 then sum(t3.latest6monthusedavgamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t3.cue_card_type like '%准贷记卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'loan_amount_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'loan_amount_total' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.cue_amt) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_card_use_new_3m' as index_name, nvl(sum(t3.usedcreditlimitamount),0) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.cue_cust_type='人民币账户' ) A left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'used_money_six_new_3m' as index_name, nvl(sum(t3.latest6monthusedavgamount),0) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.cue_cust_type='人民币账户' ) A left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_pay_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when nvl(sum(t3.cue_sx_amount),0) <> 0 then sum(t3.scheduledpaymentamount)/sum(t3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.state in ('正常','呆账') group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id, t.global_id, 'issu_account_n' as index_name, nvl(t2.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state not in ('正常','/N') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'issu_card_n' as index_name, nvl(count(case when A.index_value > 0.9 then A.index_value else null end),0) as index_value  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when nvl(sum(t3.cue_sx_amount),0) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A group by A.row_id, A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'last_1m_courtaction_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_CIVILJUDGEMENT t3 on t1.row_id = t3.report_id and t1.global_id = t3.cert_no group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'last_3m_courtaction_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_CIVILJUDGEMENT t3 on t1.row_id = t3.report_id and t1.global_id = t3.cert_no group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'last_6m_courtaction_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_CIVILJUDGEMENT t3 on t1.row_id = t3.report_id and t1.global_id = t3.cert_no group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_admin_punment_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_ADMINPUNISHMENT t3 on t1.row_id = t3.report_id and t3.cert_no = t1.global_id group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_taxarrears_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_PROFESSIONAL t3 on t1.row_id = t3.report_id and t1.global_id = t3.cert_no group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_related_complaints_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_CIVILJUDGEMENT t3 on t1.row_id = t3.report_id and t1.global_id = t3.cert_no group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'loan_card_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt_zl ='个人汽车贷款' and t3.cue_amt > 0 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'personal_house_loan_amount' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.cue_amt) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt_zl ='个人商用房（包括商住两用）贷款' and t3.cue_amt > 0 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'prod_m_sup_amount' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t2.PRI_MONTH_PAY_DEPOSIT) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_CRE_PB_RF_INFO t2 on t2.PRI_NUM = t1.row_id and t2.cert_no = t1.global_id group by t1.row_id ,t1.global_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'prod_deposit_proporption' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,max(t2.PRI_PAY_DEPOSIT_PER ) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_CRE_PB_RF_INFO t2 on t2.PRI_NUM = t1.row_id and t2.cert_no = t1.global_id group by t1.row_id ,t1.global_id ) A ; 