CREATE TABLE HDM_WBD_ZX_QRY_TBLPBOCLOANCARDINFO_ALL (   ROW_ID                     VARCHAR(200),         GLOBAL_TYPE                VARCHAR(100),         GLOBAL_ID                  VARCHAR(200),         CUSTOMER_NAME              VARCHAR(100),         SHARECREDITLIMITAMOUNT     VARCHAR(100),         USEDCREDITLIMITAMOUNT      VARCHAR(100),         LATEST6MONTHUSEDAVGAMOUNT  VARCHAR(100),         USEDHIGHESTAMOUNT       VARCHAR(100),         SCHEDULEDPAYMENTAMOUNT  VARCHAR(100),         SCHEDULEDPAYMENTDATE    VARCHAR(100),         ACTUALPAYMENTAMOUNT     VARCHAR(100),         RECENTPAYDATE           VARCHAR(100),         CURROVERDUECYC          VARCHAR(100),         CURROVERDUEAMOUNT       VARCHAR(100),         LAST_24STATE            VARCHAR(100),         CUE                     VARCHAR(2000),         CUE_OUT_TIME            VARCHAR(100),         CUE_ORG                 VARCHAR(500),         CUE_CARD_TYPE           VARCHAR(200),        CUE_CUST_TYPE           VARCHAR(200),         CUE_NO                  VARCHAR(100),         CUE_DB_WAY              VARCHAR(500),         CUE_SX_AMOUNT           VARCHAR(100),     CUE_SX_SHARE_AMOUNT     VARCHAR(100),     CUE_END_TIME            VARCHAR(100),     QUERY_TIME              VARCHAR(100),     QUERYDATE               VARCHAR(100),     QUERYREASON             VARCHAR(200),     QUERIER                 VARCHAR(500),     STATE                   VARCHAR(100),          LOAN_CARD_ID            VARCHAR(100),         ETL_DT                  VARCHAR(100),         DATA_DT                 VARCHAR(100)       );
CREATE TABLE HDM_WBD_ZX_QRY_TBLPBOCLOANCARDINFO_CUE   (  ROW_ID                  VARCHAR(20),         GLOBAL_TYPE             VARCHAR(10),         GLOBAL_ID               VARCHAR(20),         CUSTOMER_NAME           VARCHAR(10),         SHARECREDITLIMITAMOUNT  VARCHAR(10),         USEDCREDITLIMITAMOUNT   VARCHAR(10),         LATEST6MONTHUSEDAVGAMOUNT  VARCHAR(10),         USEDHIGHESTAMOUNT          VARCHAR(10),         SCHEDULEDPAYMENTAMOUNT  VARCHAR(10),         SCHEDULEDPAYMENTDATE    VARCHAR(10),         ACTUALPAYMENTAMOUNT     VARCHAR(10),         RECENTPAYDATE           VARCHAR(10),         CURROVERDUECYC          VARCHAR(10),         CURROVERDUEAMOUNT       VARCHAR(10),         LAST_24STATE            VARCHAR(10),         CUE                     VARCHAR(2000),         CUE_OUT_TIME            VARCHAR(10),         CUE_ORG                 VARCHAR(50),         CUE_CUST_TYPE           VARCHAR(20),         CUE_NO                  VARCHAR(10),         CUE_DB_WAY              VARCHAR(50),         CUE_SX_AMOUNT           VARCHAR(10),         CUE_END_TIME            VARCHAR(10),         STATE                   VARCHAR(10),    	     LOAN_CARD_ID            VARCHAR(10),         ETL_DT                  VARCHAR(20),         DATA_DT                 VARCHAR(10)        );
CREATE TABLE HDM_WBD_ZX_QRY_TBLPBOCLOANINFO_ALL  (  ROW_ID                  VARCHAR(20),         GLOBAL_TYPE    VARCHAR(10),         GLOBAL_ID      VARCHAR(20),         CUSTOMER_NAME  VARCHAR(10),         CLASS5STATE    VARCHAR(10),  				     BALANCE        VARCHAR(10),         REMAINPAYMENTCYC        VARCHAR(10),         SCHEDULEDPAYMENTAMOUNT  VARCHAR(10),         SCHEDULEDPAYMENTDATE    VARCHAR(10),         ACTUALPAYMENTAMOUNT     VARCHAR(10),         RECENTPAYDATE           VARCHAR(10),         CURROVERDUECYC          VARCHAR(10),         CURROVERDUEAMOUNT       VARCHAR(10),         OVERDUE31TO60AMOUNT     VARCHAR(10),         OVERDUE61TO90AMOUNT     VARCHAR(10),         OVERDUE91TO180AMOUNT  VARCHAR(10),         OVERDUEOVER180AMOUNT  VARCHAR(10),         LATEST24STATE         VARCHAR(10),         CUE                   VARCHAR(2000),         CUE_OUT_TIME          VARCHAR(10),         CUE_ORG               VARCHAR(50),   	 	     CUE_AMT               VARCHAR(10),         CUE_BZ                VARCHAR(10),         CUE_AMT_ZL            VARCHAR(50),         CUE_NO                VARCHAR(10),         CUE_DB_WAY            VARCHAR(50),         CUE_QS                VARCHAR(10),         CUE_GH_WAY            VARCHAR(10),    		     CUE_END_TIME          VARCHAR(10),         QUERY_TIME            VARCHAR(10),     QUERYDATE             VARCHAR(10),     QUERYREASON           VARCHAR(20),	     querier VARCHAR(150),     STATE                 VARCHAR(10),    		     LOAN_ID               VARCHAR(10),         ETL_DT                VARCHAR(10),         DATA_DT               VARCHAR(10)        );
CREATE TABLE HDM_WBD_ZX_QRY_TBLPBOCLOANINFO_CUE  (  ROW_ID                  VARCHAR(20),         GLOBAL_TYPE    VARCHAR(10),         GLOBAL_ID      VARCHAR(20),         CUSTOMER_NAME  VARCHAR(10),         CLASS5STATE    VARCHAR(10),         BALANCE        VARCHAR(10),         REMAINPAYMENTCYC        VARCHAR(10),         SCHEDULEDPAYMENTAMOUNT  VARCHAR(10),         SCHEDULEDPAYMENTDATE    VARCHAR(10),         ACTUALPAYMENTAMOUNT     VARCHAR(10),         RECENTPAYDATE           VARCHAR(10),         CURROVERDUECYC          VARCHAR(10),         CURROVERDUEAMOUNT       VARCHAR(10),         OVERDUE31TO60AMOUNT     VARCHAR(10),         OVERDUE61TO90AMOUNT     VARCHAR(10),         OVERDUE91TO180AMOUNT    VARCHAR(10),         OVERDUEOVER180AMOUNT    VARCHAR(10),         LATEST24STATE           VARCHAR(10),         CUE                     VARCHAR(2000),         CUE_OUT_TIME            VARCHAR(10),         CUE_ORG                 VARCHAR(50),         CUE_AMT                 VARCHAR(10),         CUE_BZ                  VARCHAR(10),         CUE_AMT_ZL              VARCHAR(50),         CUE_NO                  VARCHAR(10),         CUE_DB_WAY              VARCHAR(50),   	     CUE_QS                  VARCHAR(10),         CUE_GH_WAY              VARCHAR(10),         CUE_END_TIME            VARCHAR(10),         STATE                   VARCHAR(10),        LOAN_ID                 VARCHAR(10),         ETL_DT                  VARCHAR(10),         DATA_DT                 VARCHAR(10)        ) ;
CREATE TABLE HDM_WBD_ZX_QRY_TBLPERRECORDDETAIL_NEW   (  ROW_ID                  VARCHAR(20) ,        GLOBAL_TYPE    VARCHAR(10) ,       GLOBAL_ID      VARCHAR(20) ,       CUSTOMER_NAME  VARCHAR(10) ,       REPORT_ID      VARCHAR(20) ,       QUERYDATE      VARCHAR(10) ,       QUERY_TIME     VARCHAR(10) ,       QUERYREASON    VARCHAR(20) ,  		     QUERIER        VARCHAR(40) ,  		     ETL_DT         VARCHAR(10) ,        DATA_DT        VARCHAR(10) );
CREATE TABLE TBL_PER_ADMINPUNISHMENT (     ID DOUBLE,     REPORT_ID VARCHAR(20),     ORGANNAME VARCHAR(1),     CONTENT VARCHAR(1),     MONEY DOUBLE,     BEGINDATE VARCHAR(10),     ENDDATE VARCHAR(10),     RESULT VARCHAR(1),     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_CIVILJUDGEMENT (     ID DOUBLE,     REPORT_ID VARCHAR(20),     COURT VARCHAR(1),     CASEREASON VARCHAR(1),     REGISTERDATE VARCHAR(10),     CLOSEDTYPE VARCHAR(1),     CASERESULT VARCHAR(1),     CASEVALIDATEDATE VARCHAR(10),     SUITOBJECT VARCHAR(1),     SUITOBJECTMONEY DOUBLE,     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_CRE_PB_RF_INFO (     PRI_BARCODE VARCHAR(1),     PRI_NUM VARCHAR(20),     PRI_ACCOUNT VARCHAR(1),     PRI_EMP VARCHAR(1),     PRI_OA_DATE VARCHAR(10),     PRI_FIRST_HOT_DATE VARCHAR(10),     PRI_LAST_HOT_DATE VARCHAR(10),     PRI_RECENT_HOT_DATE VARCHAR(10),     PRI_PAY_DEPOSIT_COM VARCHAR(1),     PRI_PAY_DEPOSIT_PER VARCHAR(1),     PRI_MONTH_PAY_DEPOSIT VARCHAR(1),     PRI_INFO_DATE VARCHAR(10),     PRI_24_MONTH_RETST VARCHAR(1),     PRI_NEW_ID VARCHAR(1),     PRI_NEW_DATE VARCHAR(10),     PRI_UPDATE_ID VARCHAR(1),     PRI_UPDATE_DATE VARCHAR(10),     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_INFO_SUMARRY (     ID DOUBLE,     REPORT_ID VARCHAR(20),     HOUSE_LOAN_COUNT DOUBLE,     BUSI_HOUSE_LOAN_COUNT DOUBLE,     OTHER_LOAN_COUNT DOUBLE,     FIRST_LOAN_OPEN_MONTH VARCHAR(1),     LOAN_CARD_COUNT DOUBLE,     FIRST_LOAN_CARD_OPEN_MONTH VARCHAR(1),     STANDARD_LOAN_CARD_COUNT DOUBLE,     F_STANDARD_LOAN_CARD_OPENMONTH VARCHAR(1),     ANNOUNCE_COUNT DOUBLE,     DISSENT_COUNT DOUBLE,     SCORE VARCHAR(1),     SCORE_MONTH VARCHAR(1),     FELL_BACK_COUNT DOUBLE,     FELL_BACK_BALANCE DOUBLE,     ASSET_DISS_COUNT DOUBLE,     ASSET_DISS_BALCNCE DOUBLE,     ASSURE_REPAY_COUNT DOUBLE,     ASSURE_REPAY_BALANCE DOUBLE,     LOAN_OVERDUE_COUNT DOUBLE,     LOAN_OVERDUE_MONTHS DOUBLE,     LOAN_OVERDUE_HIGEST_AMOUNT_P_M DOUBLE,     LOAN_OVERDUE_MAX_DURATION DOUBLE,     LOAN_CARD_OVERDUE_COUNT DOUBLE,     LOAN_CARD_OVERDUE_MONTHS DOUBLE,     LOAN_CARD_OVERDUE_H_AMOUNT_P_M DOUBLE,     LOAN_CARD_OVERDUE_MAX_DURATION DOUBLE,     S_LOAN_CARD_ODUE_COUNT DOUBLE,     S_LOAN_CARD_ODUE_MONTHS DOUBLE,     S_LOAN_CARD_ODUE_H_AMOUNT_P_M DOUBLE,     S_LOAN_CARD_ODUE_MAX_DURATION DOUBLE,     UNPAIDLOAN_FINANCE_CORP_COUNT DOUBLE,     UNPAIDLOAN_FINANCE_ORG_COUNT DOUBLE,     UNPAIDLOAN_ACCOUNT_COUNT DOUBLE,     UNPAIDLOAN_CREDIT_LIMIT DOUBLE,     UNPAIDLOAN_BALANCE DOUBLE,     UNPAIDLOAN_LASTSIX_MONTH_REPAY DOUBLE,     UNDESTYRYLOANCARD_FANC_COUNT DOUBLE,     UNDESTYRYLOANCARD_ORG_COUNT DOUBLE,     UNDESTYRYLOANCARD_ACCOUNTCOUN DOUBLE,     UNDESTYRYLOANCARD_CREDIT_LIMIT DOUBLE,     UNDESTYRYLOANCARD_MAX_CREDIT DOUBLE,     UNDESTYRYLOANCARD_MIN_CREDIT DOUBLE,     UNDESTYRYLOANCARD_USED_CREDIT DOUBLE,     UNDESTYRYLOANCARD_USED_AVG_6 DOUBLE,     UNDESTYRYSLOANCARD_FANC_COUNT DOUBLE,     UNDESTYRYSLOANCARD_ORG_COUNT DOUBLE,     UNDESTYRYSLOANCARD_ACCOUNTCOUN DOUBLE,     UNDESTYRYSLOANCARD_CREDITLIMIT DOUBLE,     UNDESTYRYSLOANCARD_MAX_CREDIT DOUBLE,     UNDESTYRYSLOANCARD_MIN_CREDIT DOUBLE,     UNDESTYRYSLOANCARD_USED_CREDIT DOUBLE,     UNDESTYRYSLOANCARD_USED_AVG_6 DOUBLE,     GUAR_COUNT DOUBLE,     GUAR_AMOUNT DOUBLE,     GUAR_BALANCE DOUBLE,     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_LOAN_CARD_INFO (     ID DOUBLE,     REPORT_ID VARCHAR(20),     CARD_TYPE VARCHAR(2),     CUE VARCHAR(2000),     FINANCEORG VARCHAR(10),     STATE VARCHAR(20),     SHARECREDITLIMITAMOUNT DOUBLE,     USEDCREDITLIMITAMOUNT DOUBLE,     LATEST6MONTHUSEDAVGAMOUNT DOUBLE,     USEDHIGHESTAMOUNT DOUBLE,     SCHEDULEDPAYMENTDATE VARCHAR(10),     SCHEDULEDPAYMENTAMOUNT DOUBLE,     ACTUALPAYMENTAMOUNT DOUBLE,     RECENTPAYDATE VARCHAR(10),     CURROVERDUECYC DOUBLE,     CURROVERDUEAMOUNT DOUBLE,     LOAN_CARD_ID VARCHAR(1),     ACCOUNT VARCHAR(100),     CURRENCY VARCHAR(1),     OPENDATE VARCHAR(10),     CREDITLIMITAMOUNT DOUBLE,     GUARANTEETYPE VARCHAR(1),     STATEENDDATE VARCHAR(10),     STATEENDMONTH VARCHAR(10),     GUANANTEEMONEY DOUBLE,     OVERDUE31TO60AMOUNT DOUBLE,     OVERDUE61TO90AMOUNT DOUBLE,     OVERDUE91TO180AMOUNT DOUBLE,     OVERDUEOVER180AMOUNT DOUBLE,     BEGINMONTH_24MONTH VARCHAR(10),     ENDMONTH_24MONTH VARCHAR(10),     LAST_24STATE VARCHAR(20),     BEGINMONTH_FI VARCHAR(1),     ENDMONTH_FIVEYEAR VARCHAR(1),     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(10),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_LOAN_INFO (     ID DOUBLE,     REPORT_ID VARCHAR(20),     FINANCEORG VARCHAR(1),     STATE VARCHAR(10),				     STATEENDDATE VARCHAR(10),     STATEENDMONTH VARCHAR(10),     CLASS5STATE VARCHAR(10),     BALANCE DOUBLE,     REMAINPAYMENTCYC DOUBLE,     SCHEDULEDPAYMENTAMOUNT DOUBLE,     SCHEDULEDPAYMENTDATE VARCHAR(10),     ACTUALPAYMENTAMOUNT DOUBLE,     RECENTPAYDATE VARCHAR(10),     CURROVERDUECYC DOUBLE,     CURROVERDUEAMOUNT DOUBLE,     OVERDUE31TO60AMOUNT DOUBLE,     OVERDUE61TO90AMOUNT DOUBLE,     OVERDUE91TO180AMOUNT DOUBLE,     OVERDUEOVER180AMOUNT DOUBLE,     LAST24MONTHBEGINMONTH VARCHAR(10),     ACCOUNT VARCHAR(1),     TYPE VARCHAR(1),     CURRENCY VARCHAR(1),     OPENDATE VARCHAR(10),     ENDDATE VARCHAR(10),     CREDITLIMITAMOUNT DOUBLE,     GUARANTEETYPE VARCHAR(1),     PAYMENTRATING VARCHAR(1),     PAYMENTCYC VARCHAR(1),     LAST24MONTHENDMONTH VARCHAR(10),     LATEST24STATE VARCHAR(10),     LASTFIVEYEARBEGINMONTH VARCHAR(10),     LASTFIVEYEARENDMONTH VARCHAR(10),     LOAN_ID VARCHAR(10),     CUE VARCHAR(1024),					     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_PERSIONAL_INFO (     ID DOUBLE,     REPORT_ID VARCHAR(20),     GENDER VARCHAR(1),     BIRTHDAY VARCHAR(10),     MARITAL_STSTE VARCHAR(1),     MOBILE VARCHAR(1),     OFFICE_TELEPHONE_NO VARCHAR(1),     HOME_TELEPHONE_NO VARCHAR(1),     EDU_LEVEL VARCHAR(1),     EDU_DEGREE VARCHAR(1),     POST_ADDRESS VARCHAR(1),     REGISTERED_ADDRESS VARCHAR(1),     SPOUSE_NAME VARCHAR(1),     SPOUSE_CERT_TYPE VARCHAR(1),     SPOUSE_CERT_NO VARCHAR(1),     SPOUSE_EMPLOYER VARCHAR(1),     SPOUSE_TELEPHOME_NO VARCHAR(1),     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_PROFESSIONAL (     ID DOUBLE,     REPORT_ID VARCHAR(20),     EMPLOYER VARCHAR(1),     EMPLOYER_ADDRESS VARCHAR(1),     OCCUPATION VARCHAR(1),     INDUSTRY VARCHAR(1),     DUTY VARCHAR(1),     TITLE VARCHAR(1),     START_YEAR VARCHAR(10),     GET_TIME VARCHAR(10),     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_QUERYRECORDCOLLECT (     ID DOUBLE,     REPORT_ID VARCHAR(20),     LASTMONTHORG_LOANAPPROVE DOUBLE,     LASTMONTHORG_CARDAPPROVE DOUBLE,     LASTMONTHQUERY_LOANAPPROVE DOUBLE,     LASTMONTHQUERY_CARDAPPROVE DOUBLE,     LASTMONTHQUERY_SELFQUERY DOUBLE,     LAST2YEARQUERY_LOANMANAGE DOUBLE,     LAST2YEARQUERY_GUARANTEE DOUBLE,     LAST2YEARQUERY_REALCOMMER DOUBLE,     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_RECORDDETAIL (     ID DOUBLE,     REPORT_ID VARCHAR(20),     NAME VARCHAR(1),     QUERYDATE VARCHAR(10),     QUERIER VARCHAR(40),				     QUERYREASON VARCHAR(20),			     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date ) select A.row_id, A.global_id as card_id, 'query_n_1m' as index_name  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t.cert_no = t1.global_id group by t1.global_id,t1.row_id ) A where A.row_id is not null group by A.row_id ,A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'query_n_3m' as index_name  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t.cert_no = t1.global_id group by t1.global_id,t1.row_id ) A where A.row_id is not null group by A.row_id ,A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'query_n_6m' as index_name  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t.cert_no = t1.global_id group by t1.global_id,t1.row_id ) A where A.row_id is not null group by A.row_id,A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'query_n_3m_6m' as index_name  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t.cert_no = t1.global_id group by t1.global_id,t1.row_id ) A where A.row_id is not null group by A.row_id, A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'query_n_12m' as index_name  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t.cert_no = t1.global_id group by t1.global_id,t1.row_id ) A where A.row_id is not null group by A.row_id,A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_1m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id,cert_no ) t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_3m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id,cert_no ) t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_3m_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_12m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no ) t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_6m_12m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no ) t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_time' as index_name, nvl(max(replace(t.query_time,'/N','')),'-1') as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t where t.row_id is not null group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'card_query_n_1m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select row_id ,global_id ,max(query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%���ÿ�%' and t2.querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by global_id,row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'card_query_n_3m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%���ÿ�%' and t2.querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'card_query_n_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id,t1.global_id,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%���ÿ�%' and t2.querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'card_query_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id,t1.global_id,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%���ÿ�%' and t2.querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'card_query_n_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%���ÿ�%' and t2.querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_org_1m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%���ÿ�%' and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_org_3m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%���ÿ�%' and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_org_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%���ÿ�%' and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_org_3m_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%���ÿ�%' and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_org_12m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no ,max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%���ÿ�%' and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_query_n_1m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%���%' and t2.querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_query_n_3m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%���%' and t2.querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_query_n_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%���%' and t2.querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_query_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%���%' and t2.querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_query_n_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where t2.queryreason like '%���%' and t2.querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_org_1m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%���%' and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_org_3m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%���%' and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_org_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%���%' and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_org_3m_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%���%' and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_org_12m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%���%' and querier not like '%����ũ����ҵ���йɷ����޹�˾%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'post_loan_query_n_24m' as index_name, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no,sum(LAST2YEARQUERY_LOANMANAGE) as index_value from TBL_PER_QUERYRECORDCOLLECT group by report_id ,cert_no ) t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'guarantee_query_n_24m' as index_name, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no,sum(LAST2YEARQUERY_GUARANTEE) as index_value from TBL_PER_QUERYRECORDCOLLECT group by report_id ,cert_no) t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'special_business_query_n_24m' as index_name, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no,sum(LAST2YEARQUERY_REALCOMMER) as index_value from TBL_PER_QUERYRECORDCOLLECT group by report_id ,cert_no ) t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id , 'ratio_query_n_org_24m' as index_name, A.b as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t1.global_id = t.cert_no group by t1.row_id,t1.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_card_query_n_new_3m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b,max(t2.query_time) as query_time from  ( select t.row_id ,t.global_id,count(*) as cnt1 ,max(t.query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'/N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join tbl_per_recorddetail t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='���ÿ�����' and t.row_id is not null group by t.row_id,t.global_id ) t2  left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('δ����','/N') and t3.cue_cust_type='������˻�' group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id , 'ratio_query_n_org_12m' as index_name, A.b as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t1.global_id = t.cert_no group by t1.row_id,t1.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id , 'ratio_query_n_org_6m' as index_name, A.b as index_value, A.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t1.global_id = t.cert_no group by t1.row_id,t1.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id , 'ratio_query_n_org_3m' as index_name, t.b as index_value, t.query_time as report_create_time  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t1.global_id = t.cert_no group by t1.row_id,t1.global_id ) t ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_card_query_n_new_24m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'/N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='���ÿ�����' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('δ����','/N') and t3.cue_cust_type='������˻�' group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_card_query_n_new_12m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'/N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='���ÿ�����' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('δ����','/N') and t3.cue_cust_type='������˻�' group by t2.row_id ,t2.global_id ) t4 where t4.b<>0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_card_query_n_new_6m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select row_id,global_id,cnt1,querydate ,query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'/N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='���ÿ�����' and t.row_id is not null group by t.row_id,t.global_id ) a) t2 left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('δ����','/N') and t3.cue_cust_type='������˻�' group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_card_query_n_new_3m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b,max(t2.query_time) as query_time from (select row_id,global_id,cnt1,querydate,query_time from ( select t.row_id ,t.global_id,count(*) as cnt1 ,max(t.query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'/N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='���ÿ�����' and t.row_id is not null group by t.row_id,t.global_id ) a) t2 left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('δ����','/N') and t3.cue_cust_type='������˻�' group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_loan_query_n_new_24m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select row_id,global_id,cnt1,querydate,query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(t.query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'/N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='�������' and t.row_id is not null group by t.row_id,t.global_id ) a) t2 left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('/N') group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_loan_query_n_new_12m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b,max(t2.query_time) as query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(t.query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'/N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='�������' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('/N') group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_loan_query_n_new_6m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(t.query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'/N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='�������' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('/N') group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_loan_query_n_new_3m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(t.query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'/N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='�������' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('/N') group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_card_no_new_3m' as index_name, count(*) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select distinct t1.* from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) t5 on t.row_id = t5.row_id and t.global_id = t5.global_id group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_card_new_3m' as index_name, count(*) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select distinct t1.* from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) t5 on t.row_id = t5.row_id and t.global_id = t5.global_id group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_card_no_new_6m' as index_name, count(*) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select distinct t1.* from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no ) t5 on t.row_id = t5.row_id and t.global_id = t5.global_id group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_card_new_6m' as index_name, count(*) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select distinct t1.* from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) t5 on t.row_id = t5.row_id and t.global_id = t5.global_id group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t3.row_id , t3.global_id as card_id, 'n_new_card_6m' as index_name, nvl(t3.index_value,0) as index_value, t3.query_time as report_create_time  from (select t.row_id ,t.global_id ,count(distinct t1.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select * from hdm_wbd_zx_qry_tblpbocloancardinfo_all where state not in ('δ����','/N') and cue_cust_type='������˻�' ) t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no group by t.row_id ,t.global_id ) t3 ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t3.row_id , t3.global_id as card_id, 'n_new_card_3m' as index_name, count(*) as index_value, max(t3.query_time) as report_create_time  from (select distinct t1.* from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) t3 group by t3.row_id ,t3.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m_no_new_6m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m_new_6m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m_no_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m_no_new_6m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m_new_6m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m_no_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where t3.cue_db_way = '��Ѻ����' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where t3.cue_db_way = '��Ѻ����' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where t3.cue_db_way = '��Ѻ����' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'nonmortgage_n_6m_no_new_6m' as index_name , count(*) as index_value , max(t.query_time) as report_create_time  from (select t1.row_id ,t1.global_id,max(t1.query_time) as query_time,max(replace(replace(substr(t2.querydate,1,10),'.',''),'/N','')) as querydate from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no group by t1.row_id ,t1.global_id ) t left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t.row_id = t3.row_id and t.global_id = t3.global_id where t3.cue_db_way <> '��Ѻ����' group by t.row_id , t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'nonmortgage_n_6m_new_6m' as index_name, count(distinct t3.cue) as index_value, max(t.query_time) as report_create_time  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) t left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t.row_id=t3.row_id and t.global_id = t3.global_id where t3.cue_db_way <> '��Ѻ����' group by t.row_id , t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_6m_no_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '��Ѻ����' group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_6m_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '��Ѻ����' group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m_no_new_6m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '��Ѻ����' group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m_new_6m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '��Ѻ����' group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m_no_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '��Ѻ����' group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '��Ѻ����' group by A.row_id , A.global_id;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where t3.cue_db_way <> '��Ѻ����' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_6m_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where t3.cue_db_way <> '��Ѻ����' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where t3.cue_db_way <> '��Ѻ����' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where t3.cue_db_way <> '��Ѻ����' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where t3.cue_db_way <> '��Ѻ����' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m_no_new_6m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m_new_6m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m_no_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id = t3.row_id and A.global_id = t3.global_id group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id = t3.row_id and A.global_id = t3.global_id group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m_no_new_6m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id = t3.row_id and A.global_id = t3.global_id group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m_new_6m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id = t3.row_id and A.global_id = t3.global_id group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m_no_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id = t3.row_id and A.global_id = t3.global_id group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m_new_3m' as index_name, count(distinct t3.cue) as index_value  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'/N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.cue_cust_type='������˻�' ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  FROM (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  FROM (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  FROM (select t.row_id,t.global_id,count(distinct t3.cue) as index_value,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  FROM (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time  FROM (select t.row_id,t.global_id,count(distinct t3.cue) as index_value,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_12m' as index_name, nvl(A.index_value,0) as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id, global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no group by row_id ,global_id union all select row_id,global_id,count(distinct loan_card_id) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_cust_type='������˻�' group by row_id ,global_id ) t group by t.row_id ,t.global_id ) A on t1.row_id = A.row_id and t1.global_id = A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_6m_12m' as index_name, nvl(A.index_value,0) as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no group by row_id,global_id union all select row_id,global_id,count(distinct loan_card_id) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_cust_type='������˻�' group by row_id,global_id ) t group by t.row_id,t.global_id ) A on t1.row_id = A.row_id and t1.global_id = A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no group by row_id,global_id union all select row_id,global_id,count(distinct loan_card_id) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_cust_type='������˻�' group by row_id,global_id ) t group by t.row_id ,t.global_id ) A on t1.row_id = A.row_id and t1.global_id = A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_3m' as index_name, nvl(A.index_value,0) as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no group by row_id,global_id union all select row_id,global_id,count(distinct loan_card_id) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_cust_type='������˻�' group by row_id ,global_id ) t group by t.row_id,t.global_id ) A on t1.row_id = A.row_id and t1.global_id = A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_6m' as index_name, nvl(A.index_value,0) as index_value, t1.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as integer) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no group by row_id,global_id union all select row_id,global_id,count(distinct loan_card_id) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_cust_type='������˻�' group by row_id ,global_id ) t group by t.row_id,t.global_id ) A on t1.row_id = A.row_id and t1.global_id = A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'jnnc_loan_query_24m' as index_name, count(case when t1.queryreason='�������' and t.row_id is not null and t1.querier like '%����ũ����ҵ���йɷ����޹�˾%' then '1'  else '0' end ) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_own_1m' as index_name, count(t1.lastmonthquery_selfquery) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_QUERYRECORDCOLLECT t1 on t1.report_id = t.row_id and t.global_id = t1.cert_no where t.row_id is not null group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_total' as index_name, sum((case when t1.queryreason='���ÿ�����' then 1 else 0 end)) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t1.report_id = t.row_id and t.global_id = t1.cert_no group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_total' as index_name, sum((case when t1.queryreason='�������' then 1 else 0 end)) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t1.report_id = t.row_id and t.global_id = t1.cert_no group by t.row_id ,t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_total' as index_name, count(1) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t1.report_id = t.row_id and t.global_id = t1.cert_no group by t.row_id ,t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'jnnc_loan_n_query' as index_name, sum((case when t1.queryreason='�������' and t1.querier like '%����ũ����ҵ���йɷ����޹�˾%' then 1 else 0 end)) as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t1.report_id = t.row_id and t.global_id = t1.cert_no group by t.row_id ,t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_foreign_n_used' as index_name, (case when t2.index_value=0 or t2.index_value is null then -1 else t2.index_value end ) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(distinct t1.cue_org) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.cue_cust_type <> '������˻�' and t1.cue_cust_type is not null and t1.usedhighestamount>0 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_foreign_n_total' as index_name, (case when t2.index_value=0 or t2.index_value is null then -1 else t2.index_value end ) as index_value, t.query_time as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(distinct t1.cue_org) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.cue_cust_type <> '������˻�' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_credit_limit_level_total' as index_name, case when max(t1.cue_sx_amount) < 5000 then 1 when max(t1.cue_sx_amount) >=5000 and max(t1.cue_sx_amount) < 10000 then 2 when max(t1.cue_sx_amount) >=10000 and max(t1.cue_sx_amount) < 20000 then 3 when max(t1.cue_sx_amount) >=20000 and max(t1.cue_sx_amount) < 50000 then 4 when max(t1.cue_sx_amount) >=50000 then 5 else 0 end as index_value, max(t.query_time) as report_create_time  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ;