CREATE TABLE HDM_WBD_ZX_QRY_TBLPBOCLOANCARDINFO_ALL (   ROW_ID                     VARCHAR(20),         GLOBAL_TYPE                VARCHAR(1),         GLOBAL_ID                  VARCHAR(20),         CUSTOMER_NAME              VARCHAR(1),         SHARECREDITLIMITAMOUNT     VARCHAR(1),         USEDCREDITLIMITAMOUNT      VARCHAR(1),         LATEST6MONTHUSEDAVGAMOUNT  VARCHAR(1),         USEDHIGHESTAMOUNT       VARCHAR(1),         SCHEDULEDPAYMENTAMOUNT  VARCHAR(1),         SCHEDULEDPAYMENTDATE    VARCHAR(10),         ACTUALPAYMENTAMOUNT     VARCHAR(1),         RECENTPAYDATE           VARCHAR(10),         CURROVERDUECYC          VARCHAR(1),         CURROVERDUEAMOUNT       VARCHAR(1),         LAST_24STATE            VARCHAR(1),         CUE                     VARCHAR(2000),         CUE_OUT_TIME            VARCHAR(10),         CUE_ORG                 VARCHAR(50),         CUE_CARD_TYPE           VARCHAR(50),        CUE_CUST_TYPE           VARCHAR(20),         CUE_NO                  VARCHAR(1),         CUE_DB_WAY              VARCHAR(50),         CUE_SX_AMOUNT          int,     CUE_SX_SHARE_AMOUNT     VARCHAR(1),     CUE_END_TIME            VARCHAR(10),     QUERY_TIME              VARCHAR(10),     QUERYDATE               VARCHAR(10),     QUERYREASON             VARCHAR(20),     QUERIER                 VARCHAR(50),     STATE                   VARCHAR(10),          LOAN_CARD_ID            VARCHAR(1),         ETL_DT                  VARCHAR(10),         DATA_DT                 VARCHAR(10)       );
CREATE TABLE HDM_WBD_ZX_QRY_TBLPBOCLOANCARDINFO_CUE   (  ROW_ID                  VARCHAR(20),         GLOBAL_TYPE             VARCHAR(1),         GLOBAL_ID               VARCHAR(20),         CUSTOMER_NAME           VARCHAR(1),         SHARECREDITLIMITAMOUNT  VARCHAR(1),         USEDCREDITLIMITAMOUNT   VARCHAR(1),         LATEST6MONTHUSEDAVGAMOUNT  VARCHAR(1),         USEDHIGHESTAMOUNT          VARCHAR(1),         SCHEDULEDPAYMENTAMOUNT  VARCHAR(1),         SCHEDULEDPAYMENTDATE    VARCHAR(10),         ACTUALPAYMENTAMOUNT     VARCHAR(1),         RECENTPAYDATE           VARCHAR(10),         CURROVERDUECYC          VARCHAR(1),         CURROVERDUEAMOUNT       VARCHAR(1),         LAST_24STATE            VARCHAR(1),         CUE                     VARCHAR(2000),         CUE_OUT_TIME            VARCHAR(10),         CUE_ORG                 VARCHAR(50),         CUE_CUST_TYPE           VARCHAR(20),         CUE_NO                  VARCHAR(1),         CUE_DB_WAY              VARCHAR(50),         CUE_SX_AMOUNT           int,         CUE_END_TIME            VARCHAR(10),         STATE                   VARCHAR(10),    	     LOAN_CARD_ID            VARCHAR(1),         ETL_DT                  VARCHAR(10),         DATA_DT                 VARCHAR(10)        );
CREATE TABLE HDM_WBD_ZX_QRY_TBLPBOCLOANINFO_ALL  (  ROW_ID                  VARCHAR(20),         GLOBAL_TYPE    VARCHAR(1),         GLOBAL_ID      VARCHAR(20),         CUSTOMER_NAME  VARCHAR(1),         CLASS5STATE    VARCHAR(10),  				     BALANCE        VARCHAR(1),         REMAINPAYMENTCYC        VARCHAR(1),         SCHEDULEDPAYMENTAMOUNT  VARCHAR(1),         SCHEDULEDPAYMENTDATE    VARCHAR(10),         ACTUALPAYMENTAMOUNT     VARCHAR(1),         RECENTPAYDATE           VARCHAR(10),         CURROVERDUECYC          VARCHAR(1),         CURROVERDUEAMOUNT       VARCHAR(1),         OVERDUE31TO60AMOUNT     VARCHAR(1),         OVERDUE61TO90AMOUNT     VARCHAR(1),         OVERDUE91TO180AMOUNT  VARCHAR(1),         OVERDUEOVER180AMOUNT  VARCHAR(1),         LATEST24STATE         VARCHAR(10),         CUE                   VARCHAR(2000),         CUE_OUT_TIME          VARCHAR(10),         CUE_ORG               VARCHAR(50),   	 	     CUE_AMT               int,         CUE_BZ                VARCHAR(1),         CUE_AMT_ZL            VARCHAR(50),         CUE_NO                VARCHAR(1),         CUE_DB_WAY            VARCHAR(50),         CUE_QS                VARCHAR(1),         CUE_GH_WAY            VARCHAR(1),    		     CUE_END_TIME          VARCHAR(10),         QUERY_TIME            VARCHAR(10),     QUERYDATE             VARCHAR(10),     QUERYREASON           VARCHAR(20),	     querier VARCHAR(50),     STATE                 VARCHAR(10),    		     LOAN_ID               VARCHAR(10),         ETL_DT                VARCHAR(10),         DATA_DT               VARCHAR(10)        );
CREATE TABLE HDM_WBD_ZX_QRY_TBLPBOCLOANINFO_CUE  (  ROW_ID                  VARCHAR(20),         GLOBAL_TYPE    VARCHAR(1),         GLOBAL_ID      VARCHAR(20),         CUSTOMER_NAME  VARCHAR(1),         CLASS5STATE    VARCHAR(10),         BALANCE        VARCHAR(1),         REMAINPAYMENTCYC        VARCHAR(1),         SCHEDULEDPAYMENTAMOUNT  VARCHAR(1),         SCHEDULEDPAYMENTDATE    VARCHAR(10),         ACTUALPAYMENTAMOUNT     VARCHAR(1),         RECENTPAYDATE           VARCHAR(10),         CURROVERDUECYC          VARCHAR(1),         CURROVERDUEAMOUNT       VARCHAR(1),         OVERDUE31TO60AMOUNT     VARCHAR(1),         OVERDUE61TO90AMOUNT     VARCHAR(1),         OVERDUE91TO180AMOUNT    VARCHAR(1),         OVERDUEOVER180AMOUNT    VARCHAR(1),         LATEST24STATE           VARCHAR(1),         CUE                     VARCHAR(2000),         CUE_OUT_TIME            VARCHAR(10),         CUE_ORG                 VARCHAR(50),         CUE_AMT                int,         CUE_BZ                  VARCHAR(1),         CUE_AMT_ZL              VARCHAR(50),         CUE_NO                  VARCHAR(1),         CUE_DB_WAY              VARCHAR(50),   	     CUE_QS                  VARCHAR(1),         CUE_GH_WAY              VARCHAR(1),         CUE_END_TIME            VARCHAR(10),         STATE                   VARCHAR(10),        LOAN_ID                 VARCHAR(1),         ETL_DT                  VARCHAR(10),         DATA_DT                 VARCHAR(10)        ) ;
CREATE TABLE HDM_WBD_ZX_QRY_TBLPERRECORDDETAIL_NEW   (  ROW_ID                  VARCHAR(20) ,        GLOBAL_TYPE    VARCHAR(1) ,       GLOBAL_ID      VARCHAR(20) ,       CUSTOMER_NAME  VARCHAR(1) ,       REPORT_ID      VARCHAR(20) ,       QUERYDATE      VARCHAR(10) ,       QUERY_TIME     VARCHAR(10) ,       QUERYREASON    VARCHAR(20) ,  		     QUERIER        VARCHAR(50) ,  		     ETL_DT         VARCHAR(10) ,        DATA_DT        VARCHAR(10) );
CREATE TABLE TBL_PER_ADMINPUNISHMENT (     ID DOUBLE,     REPORT_ID VARCHAR(20),     ORGANNAME VARCHAR(1),     CONTENT VARCHAR(1),     MONEY DOUBLE,     BEGINDATE VARCHAR(10),     ENDDATE VARCHAR(10),     RESULT VARCHAR(1),     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_CIVILJUDGEMENT (     ID DOUBLE,     REPORT_ID VARCHAR(20),     COURT VARCHAR(1),     CASEREASON VARCHAR(1),     REGISTERDATE VARCHAR(10),     CLOSEDTYPE VARCHAR(1),     CASERESULT VARCHAR(1),     CASEVALIDATEDATE VARCHAR(10),     SUITOBJECT VARCHAR(1),     SUITOBJECTMONEY DOUBLE,     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_CRE_PB_RF_INFO (     PRI_BARCODE VARCHAR(1),     PRI_NUM VARCHAR(20),     PRI_ACCOUNT VARCHAR(1),     PRI_EMP VARCHAR(1),     PRI_OA_DATE VARCHAR(10),     PRI_FIRST_HOT_DATE VARCHAR(10),     PRI_LAST_HOT_DATE VARCHAR(10),     PRI_RECENT_HOT_DATE VARCHAR(10),     PRI_PAY_DEPOSIT_COM VARCHAR(1),     PRI_PAY_DEPOSIT_PER VARCHAR(1),     PRI_MONTH_PAY_DEPOSIT VARCHAR(1),     PRI_INFO_DATE VARCHAR(10),     PRI_24_MONTH_RETST VARCHAR(1),     PRI_NEW_ID VARCHAR(1),     PRI_NEW_DATE VARCHAR(10),     PRI_UPDATE_ID VARCHAR(1),     PRI_UPDATE_DATE VARCHAR(10),     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_INFO_SUMARRY (     ID DOUBLE,     REPORT_ID VARCHAR(20),     HOUSE_LOAN_COUNT DOUBLE,     BUSI_HOUSE_LOAN_COUNT DOUBLE,     OTHER_LOAN_COUNT DOUBLE,     FIRST_LOAN_OPEN_MONTH VARCHAR(1),     LOAN_CARD_COUNT DOUBLE,     FIRST_LOAN_CARD_OPEN_MONTH VARCHAR(1),     STANDARD_LOAN_CARD_COUNT DOUBLE,     F_STANDARD_LOAN_CARD_OPENMONTH VARCHAR(1),     ANNOUNCE_COUNT DOUBLE,     DISSENT_COUNT DOUBLE,     SCORE VARCHAR(1),     SCORE_MONTH VARCHAR(1),     FELL_BACK_COUNT DOUBLE,     FELL_BACK_BALANCE DOUBLE,     ASSET_DISS_COUNT DOUBLE,     ASSET_DISS_BALCNCE DOUBLE,     ASSURE_REPAY_COUNT DOUBLE,     ASSURE_REPAY_BALANCE DOUBLE,     LOAN_OVERDUE_COUNT DOUBLE,     LOAN_OVERDUE_MONTHS DOUBLE,     LOAN_OVERDUE_HIGEST_AMOUNT_P_M DOUBLE,     LOAN_OVERDUE_MAX_DURATION DOUBLE,     LOAN_CARD_OVERDUE_COUNT DOUBLE,     LOAN_CARD_OVERDUE_MONTHS DOUBLE,     LOAN_CARD_OVERDUE_H_AMOUNT_P_M DOUBLE,     LOAN_CARD_OVERDUE_MAX_DURATION DOUBLE,     S_LOAN_CARD_ODUE_COUNT DOUBLE,     S_LOAN_CARD_ODUE_MONTHS DOUBLE,     S_LOAN_CARD_ODUE_H_AMOUNT_P_M DOUBLE,     S_LOAN_CARD_ODUE_MAX_DURATION DOUBLE,     UNPAIDLOAN_FINANCE_CORP_COUNT DOUBLE,     UNPAIDLOAN_FINANCE_ORG_COUNT DOUBLE,     UNPAIDLOAN_ACCOUNT_COUNT DOUBLE,     UNPAIDLOAN_CREDIT_LIMIT DOUBLE,     UNPAIDLOAN_BALANCE DOUBLE,     UNPAIDLOAN_LASTSIX_MONTH_REPAY DOUBLE,     UNDESTYRYLOANCARD_FANC_COUNT DOUBLE,     UNDESTYRYLOANCARD_ORG_COUNT DOUBLE,     UNDESTYRYLOANCARD_ACCOUNTCOUN DOUBLE,     UNDESTYRYLOANCARD_CREDIT_LIMIT DOUBLE,     UNDESTYRYLOANCARD_MAX_CREDIT DOUBLE,     UNDESTYRYLOANCARD_MIN_CREDIT DOUBLE,     UNDESTYRYLOANCARD_USED_CREDIT DOUBLE,     UNDESTYRYLOANCARD_USED_AVG_6 DOUBLE,     UNDESTYRYSLOANCARD_FANC_COUNT DOUBLE,     UNDESTYRYSLOANCARD_ORG_COUNT DOUBLE,     UNDESTYRYSLOANCARD_ACCOUNTCOUN DOUBLE,     UNDESTYRYSLOANCARD_CREDITLIMIT DOUBLE,     UNDESTYRYSLOANCARD_MAX_CREDIT DOUBLE,     UNDESTYRYSLOANCARD_MIN_CREDIT DOUBLE,     UNDESTYRYSLOANCARD_USED_CREDIT DOUBLE,     UNDESTYRYSLOANCARD_USED_AVG_6 DOUBLE,     GUAR_COUNT DOUBLE,     GUAR_AMOUNT DOUBLE,     GUAR_BALANCE DOUBLE,     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_LOAN_CARD_INFO (     ID DOUBLE,     REPORT_ID VARCHAR(20),     CARD_TYPE VARCHAR(1),     CUE VARCHAR(2000),     FINANCEORG VARCHAR(1),     STATE VARCHAR(10),     SHARECREDITLIMITAMOUNT DOUBLE,     USEDCREDITLIMITAMOUNT DOUBLE,     LATEST6MONTHUSEDAVGAMOUNT DOUBLE,     USEDHIGHESTAMOUNT DOUBLE,     SCHEDULEDPAYMENTDATE VARCHAR(10),     SCHEDULEDPAYMENTAMOUNT DOUBLE,     ACTUALPAYMENTAMOUNT DOUBLE,     RECENTPAYDATE VARCHAR(10),     CURROVERDUECYC DOUBLE,     CURROVERDUEAMOUNT DOUBLE,     LOAN_CARD_ID VARCHAR(1),     ACCOUNT VARCHAR(1),     CURRENCY VARCHAR(1),     OPENDATE VARCHAR(10),     CREDITLIMITAMOUNT DOUBLE,     GUARANTEETYPE VARCHAR(1),     STATEENDDATE VARCHAR(10),     STATEENDMONTH VARCHAR(10),     GUANANTEEMONEY DOUBLE,     OVERDUE31TO60AMOUNT DOUBLE,     OVERDUE61TO90AMOUNT DOUBLE,     OVERDUE91TO180AMOUNT DOUBLE,     OVERDUEOVER180AMOUNT DOUBLE,     BEGINMONTH_24MONTH VARCHAR(10),     ENDMONTH_24MONTH VARCHAR(10),     LAST_24STATE VARCHAR(1),     BEGINMONTH_FI VARCHAR(1),     ENDMONTH_FIVEYEAR VARCHAR(1),     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_LOAN_INFO (     ID DOUBLE,     REPORT_ID VARCHAR(20),     FINANCEORG VARCHAR(1),     STATE VARCHAR(10),				     STATEENDDATE VARCHAR(10),     STATEENDMONTH VARCHAR(10),     CLASS5STATE VARCHAR(10),     BALANCE DOUBLE,     REMAINPAYMENTCYC DOUBLE,     SCHEDULEDPAYMENTAMOUNT DOUBLE,     SCHEDULEDPAYMENTDATE VARCHAR(10),     ACTUALPAYMENTAMOUNT DOUBLE,     RECENTPAYDATE VARCHAR(10),     CURROVERDUECYC DOUBLE,     CURROVERDUEAMOUNT DOUBLE,     OVERDUE31TO60AMOUNT DOUBLE,     OVERDUE61TO90AMOUNT DOUBLE,     OVERDUE91TO180AMOUNT DOUBLE,     OVERDUEOVER180AMOUNT DOUBLE,     LAST24MONTHBEGINMONTH VARCHAR(10),     ACCOUNT VARCHAR(1),     TYPE VARCHAR(1),     CURRENCY VARCHAR(1),     OPENDATE VARCHAR(10),     ENDDATE VARCHAR(10),     CREDITLIMITAMOUNT DOUBLE,     GUARANTEETYPE VARCHAR(1),     PAYMENTRATING VARCHAR(1),     PAYMENTCYC VARCHAR(1),     LAST24MONTHENDMONTH VARCHAR(10),     LATEST24STATE VARCHAR(10),     LASTFIVEYEARBEGINMONTH VARCHAR(10),     LASTFIVEYEARENDMONTH VARCHAR(10),     LOAN_ID VARCHAR(1),     CUE VARCHAR(2000),					     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_PERSIONAL_INFO (     ID DOUBLE,     REPORT_ID VARCHAR(20),     GENDER VARCHAR(1),     BIRTHDAY VARCHAR(10),     MARITAL_STSTE VARCHAR(1),     MOBILE VARCHAR(1),     OFFICE_TELEPHONE_NO VARCHAR(1),     HOME_TELEPHONE_NO VARCHAR(1),     EDU_LEVEL VARCHAR(1),     EDU_DEGREE VARCHAR(1),     POST_ADDRESS VARCHAR(1),     REGISTERED_ADDRESS VARCHAR(1),     SPOUSE_NAME VARCHAR(1),     SPOUSE_CERT_TYPE VARCHAR(1),     SPOUSE_CERT_NO VARCHAR(1),     SPOUSE_EMPLOYER VARCHAR(1),     SPOUSE_TELEPHOME_NO VARCHAR(1),     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_PROFESSIONAL (     ID DOUBLE,     REPORT_ID VARCHAR(20),     EMPLOYER VARCHAR(1),     EMPLOYER_ADDRESS VARCHAR(1),     OCCUPATION VARCHAR(1),     INDUSTRY VARCHAR(1),     DUTY VARCHAR(1),     TITLE VARCHAR(1),     START_YEAR VARCHAR(10),     GET_TIME VARCHAR(10),     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_QUERYRECORDCOLLECT (     ID DOUBLE,     REPORT_ID VARCHAR(20),     LASTMONTHORG_LOANAPPROVE DOUBLE,     LASTMONTHORG_CARDAPPROVE DOUBLE,     LASTMONTHQUERY_LOANAPPROVE DOUBLE,     LASTMONTHQUERY_CARDAPPROVE DOUBLE,     LASTMONTHQUERY_SELFQUERY DOUBLE,     LAST2YEARQUERY_LOANMANAGE DOUBLE,     LAST2YEARQUERY_GUARANTEE DOUBLE,     LAST2YEARQUERY_REALCOMMER DOUBLE,     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_RECORDDETAIL (     ID DOUBLE,     REPORT_ID VARCHAR(20),     NAME VARCHAR(1),     QUERYDATE VARCHAR(10),     QUERIER VARCHAR(50),				     QUERYREASON VARCHAR(20),			     CUS_NAME VARCHAR(1),     CERT_TYPE VARCHAR(1),     CERT_NO VARCHAR(20),     ETL_DATE VARCHAR(10) );
CREATE TABLE TBL_PER_RESULT_INFO(id double,bar_code VARCHAR(10),report_sn VARCHAR(20),query_time VARCHAR(10),report_create_time VARCHAR(10),name VARCHAR(10),cert_type VARCHAR(1),cert_no VARCHAR(20),query_reason VARCHAR(10),qyery_format VARCHAR(10),query_org VARCHAR(50),user_code VARCHAR(10),query_result_cue VARCHAR(2000),etl_date VARCHAR(10));
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date ) select A.row_id, A.global_id as card_id, 'query_n_1m' as index_name, to_char(nvl(sum(A.index_value),0),'99999') as index_value, max(A.query_time) as report_create_time,'' as etl_date from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t.cert_no = t1.global_id where replace(replace(substr(t.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) group by t1.global_id,t1.row_id ) A where A.row_id is not null group by A.row_id ,A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'query_n_3m' as index_name, to_char(nvl(sum(A.index_value),0),'99999') as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t.cert_no = t1.global_id where replace(replace(substr(t.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-3) group by t1.global_id,t1.row_id ) A where A.row_id is not null group by A.row_id ,A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'query_n_6m' as index_name, to_char(nvl(sum(A.index_value),0),'99999') as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t.cert_no = t1.global_id where replace(replace(substr(t.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) group by t1.global_id,t1.row_id ) A where A.row_id is not null group by A.row_id,A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'query_n_3m_6m' as index_name, to_char(nvl(sum(A.index_value),0),'99999') as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t.cert_no = t1.global_id where replace(replace(substr(t.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and replace(replace(substr(t.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-3) group by t1.global_id,t1.row_id ) A where A.row_id is not null group by A.row_id, A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'query_n_12m' as index_name, to_char(nvl(sum(A.index_value),0),'99999') as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t.cert_no = t1.global_id where replace(replace(substr(t.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-12) group by t1.global_id,t1.row_id ) A where A.row_id is not null group by A.row_id,A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_1m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate, count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%江南农村商业银行股份有限公司%' group by report_id,cert_no ) t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-1) ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_3m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate, count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%江南农村商业银行股份有限公司%' group by report_id,cert_no ) t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate, count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_3m_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate, count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_12m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate , count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no ) t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-12) ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_org_6m_12m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate , count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no ) t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-12) and replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_time' as index_name, nvl(max(replace(t.query_time,'\N','')),'-1') as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t where t.row_id is not null group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'card_query_n_1m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select row_id ,global_id ,max(query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by global_id,row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'card_query_n_3m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-3) and t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'card_query_n_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id,t1.global_id,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'card_query_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id,t1.global_id,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-3) and t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'card_query_n_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-12) and t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_org_1m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no, max(querydate) as querydate , count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%信用卡%' and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-1) ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_org_3m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate, count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%信用卡%' and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_org_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate, count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%信用卡%' and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_org_3m_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate, count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%信用卡%' and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_org_12m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no ,max(querydate) as querydate ,count(regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%信用卡%' and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-12) ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_query_n_1m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_query_n_3m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-3) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_query_n_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_query_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') <= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-3) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_query_n_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-12) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_org_1m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate , count(distinct regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%贷款%' and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-1) ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_org_3m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate , count(distinct regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%贷款%' and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_org_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate , count(distinct regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%贷款%' and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_org_3m_6m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate , count(distinct regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%贷款%' and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_org_12m' as index_name, nvl(t1.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id ,cert_no , max(querydate) as querydate , count(distinct regexp_replace(querier,'/(.*)','')) as index_value from TBL_PER_RECORDDETAIL where report_id is not null and queryreason like '%贷款%' and querier not like '%江南农村商业银行股份有限公司%' group by report_id ,cert_no )t1 on t1.report_id = t.row_id and t1.cert_no = t.global_id where replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-12) ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'post_loan_query_n_24m' as index_name, to_char(nvl(t1.index_value,0),'99999') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no,sum(LAST2YEARQUERY_LOANMANAGE) as index_value from TBL_PER_QUERYRECORDCOLLECT group by report_id ,cert_no ) t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'guarantee_query_n_24m' as index_name, to_char(nvl(t1.index_value,0),'99999') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no,sum(LAST2YEARQUERY_GUARANTEE) as index_value from TBL_PER_QUERYRECORDCOLLECT group by report_id ,cert_no) t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'special_business_query_n_24m' as index_name, to_char(nvl(t1.index_value,0),'99999') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select report_id,cert_no,sum(LAST2YEARQUERY_REALCOMMER) as index_value from TBL_PER_QUERYRECORDCOLLECT group by report_id ,cert_no ) t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id , 'ratio_query_n_org_24m' as index_name, A.b as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,round(count(regexp_replace(t.querier,'/(.*)',''))/count(distinct regexp_replace(t.querier,'/(.*)','')),2) as b from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t1.global_id = t.cert_no where replace(replace(substr(t.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-24) and row_id is not null group by t1.row_id,t1.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id , 'ratio_query_n_org_12m' as index_name, A.b as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,round(count(regexp_replace(t.querier,'/(.*)',''))/count(distinct regexp_replace(t.querier,'/(.*)','')),2) as b from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t1.global_id = t.cert_no where replace(replace(substr(t.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-12) and row_id is not null group by t1.row_id,t1.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id , 'ratio_query_n_org_6m' as index_name, A.b as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,round(count(regexp_replace(t.querier,'/(.*)',''))/count(distinct regexp_replace(t.querier,'/(.*)','')),2) as b from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t1.global_id = t.cert_no where replace(replace(substr(t.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and row_id is not null group by t1.row_id,t1.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id , 'ratio_query_n_org_3m' as index_name, t.b as index_value, t.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,round(count(regexp_replace(t.querier,'/(.*)',''))/count(distinct regexp_replace(t.querier,'/(.*)','')),2) as b from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t on t.report_id = t1.row_id and t1.global_id = t.cert_no where replace(replace(substr(t.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-3) and t1.row_id is not null group by t1.row_id,t1.global_id ) t ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_card_query_n_new_24m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time,'' as etl_date  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'\N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='信用卡审批' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('未激活','\N') and t3.cue_cust_type='人民币账户' and t3.cue_out_time >= add_months(t2.querydate,-24) group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_card_query_n_new_12m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time,'' as etl_date  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'\N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='信用卡审批' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('未激活','\N') and t3.cue_cust_type='人民币账户' and t3.cue_out_time >= add_months(t2.querydate,-12) group by t2.row_id ,t2.global_id ) t4 where t4.b<>0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_card_query_n_new_6m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time,'' as etl_date  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select row_id,global_id,cnt1,querydate ,query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'\N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='信用卡审批' and t.row_id is not null group by t.row_id,t.global_id ) aa ) t2 left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('未激活','\N') and t3.cue_cust_type='人民币账户' and t3.cue_out_time >= add_months(t2.querydate,-6) group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_card_query_n_new_3m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time,'' as etl_date  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b,max(t2.query_time) as query_time from (select row_id,global_id,cnt1,querydate,query_time from ( select t.row_id ,t.global_id,count(*) as cnt1 ,max(t.query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'\N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='信用卡审批' and t.row_id is not null group by t.row_id,t.global_id ) aa ) t2 left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('未激活','\N') and t3.cue_cust_type='人民币账户' and t3.cue_out_time >= add_months(t2.querydate,-3) group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_loan_query_n_new_24m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time,'' as etl_date  from (select  t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,t2.querydate,max(query_time) as c from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(t.query_time) as query_time ,max(cast(replace(replace(substr(t1.querydate,1,10),'.',''),'\N','') as int)) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='贷款审批' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('\N') and t3.cue_out_time >= add_months(t2.querydate,-24) group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_loan_query_n_new_12m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time,'' as etl_date  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b,max(t2.query_time) as query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(t.query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'\N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='贷款审批' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('\N') and t3.cue_out_time >= add_months(t2.querydate,-12) group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_loan_query_n_new_6m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time,'' as etl_date  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(t.query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'\N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='贷款审批' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('\N') and t3.cue_out_time >= add_months(t2.querydate,-6) group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t4.row_id , t4.global_id as card_id, 'ratio_loan_query_n_new_3m' as index_name, round(t4.a/t4.b,2) as index_value, t4.query_time as report_create_time,'' as etl_date  from (select t2.row_id ,t2.global_id,max(t2.cnt1) as a,count(*) as b ,max(t2.query_time) as query_time from (select t.row_id ,t.global_id ,count(*) as cnt1 ,max(t.query_time) as query_time ,max(replace(replace(substr(t1.querydate,1,10),'.',''),'\N','')) as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no where t1.queryreason='贷款审批' and t.row_id is not null group by t.row_id,t.global_id ) t2 left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t2.row_id=t3.row_id and t2.global_id = t3.global_id where t3.state not in ('\N') and t3.cue_out_time >= add_months(t2.querydate,-3) group by t2.row_id ,t2.global_id ) t4 where t4.b <> 0 ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_card_no_new_3m' as index_name, count(*) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select distinct t1.* from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) t5 on t.row_id = t5.row_id and t.global_id = t5.global_id group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_card_new_3m' as index_name, count(*) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select distinct t1.* from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) t5 on t.row_id = t5.row_id and t.global_id = t5.global_id group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_card_no_new_6m' as index_name, count(*) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select distinct t1.* from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) t5 on t.row_id = t5.row_id and t.global_id = t5.global_id group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_card_new_6m' as index_name, count(*) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select distinct t1.* from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) t5 on t.row_id = t5.row_id and t.global_id = t5.global_id group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t3.row_id , t3.global_id as card_id, 'n_new_card_6m' as index_name, nvl(t3.index_value,0) as index_value, t3.query_time as report_create_time,'' as etl_date  from (select t.row_id ,t.global_id ,count(distinct t1.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select * from hdm_wbd_zx_qry_tblpbocloancardinfo_all where state not in ('未激活','\N') and cue_cust_type='人民币账户' ) t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) group by t.row_id ,t.global_id ) t3 ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t3.row_id , t3.global_id as card_id, 'n_new_card_3m' as index_name, count(*) as index_value, max(t3.query_time) as report_create_time,'' as etl_date  from (select distinct t1.* from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) ) t3 group by t3.row_id ,t3.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m_no_new_6m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m_new_6m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m_no_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m_no_new_6m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m_new_6m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m_no_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way = '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-12) and t.row_id is not null and t3.cue_db_way = '抵押担保' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-12) and replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') <= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and t.row_id is not null and t3.cue_db_way = '抵押担保' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') <= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) and t.row_id is not null and t3.cue_db_way = '抵押担保' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_3m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) and t.row_id is not null and t3.cue_db_way = '抵押担保' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'mortgage_n_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and t.row_id is not null and t3.cue_db_way = '抵押担保' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'nonmortgage_n_6m_no_new_6m' as index_name , count(*) as index_value , max(t.query_time) as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id,max(t1.query_time) as query_time,max(replace(replace(substr(t2.querydate,1,10),'.',''),'\N','')) as querydate from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.global_id,'\N',null) is not null group by t1.row_id ,t1.global_id ) t left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t.row_id = t3.row_id and t.global_id = t3.global_id where t3.cue_db_way <> '抵押担保' and t3.cue_out_time >= add_months(t.querydate,-6) group by t.row_id , t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'nonmortgage_n_6m_new_6m' as index_name, count(distinct t3.cue) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) t left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t.row_id=t3.row_id and t.global_id = t3.global_id where t3.cue_db_way <> '抵押担保' and t3.cue_out_time >= add_months(t.querydate,-6) group by t.row_id , t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_6m_no_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_6m_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m_no_new_6m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m_new_6m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m_no_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_db_way <> '抵押担保' and t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id , A.global_id;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-12) and t.row_id is not null and t3.cue_db_way <> '抵押担保' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_6m_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-12) and replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and t.row_id is not null and t3.cue_db_way <> '抵押担保' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) and t.row_id is not null and t3.cue_db_way <> '抵押担保' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_3m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) and t.row_id is not null and t3.cue_db_way <> '抵押担保' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'nonmortgage_n_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t3.global_id = t.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and t.row_id is not null and t3.cue_db_way <> '抵押担保' group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m_no_new_6m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m_new_6m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m_no_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id = t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id = t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m_no_new_6m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id = t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m_new_6m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id = t2.report_id and t1.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id = t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m_no_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id = t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m_new_3m' as index_name, count(distinct t3.cue) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t1.global_id = t2.cert_no where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-3) group by A.row_id , A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  FROM (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-12) and t.row_id is not null group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m_12m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  FROM (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-12) and replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') <= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and t.row_id is not null group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  FROM (select t.row_id,t.global_id,count(distinct t3.cue) as index_value,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-6) and replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') <= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) and t.row_id is not null group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_3m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  FROM (select t.row_id,t.global_id,count(distinct t3.cue) as index_value ,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) and t.row_id is not null group by t.row_id,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.global_id as card_id, 'loan_n_6m' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  FROM (select t.row_id,t.global_id,count(distinct t3.cue) as index_value,max(t.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on t3.row_id = t.row_id and t.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t.query_time,1,10),'.',''),'\N',''),-3) and t.row_id is not null group by t.row_id,t.global_id ) A ;- 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'jnnc_loan_query_24m' as index_name, count(case when t1.queryreason='贷款审批' and t.row_id is not null and t1.querier like '%江南农村商业银行股份有限公司%' and t1.querydate>=add_months(t.query_time,-24) then '1' else '0' end ) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t.row_id = t1.report_id and t.global_id = t1.cert_no group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_own_1m' as index_name, count(t1.lastmonthquery_selfquery) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_QUERYRECORDCOLLECT t1 on t1.report_id = t.row_id and t.global_id = t1.cert_no where t.row_id is not null group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_query_n_total' as index_name, sum((case when t1.queryreason='信用卡审批' then 1 else 0 end)) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t1.report_id = t.row_id and t.global_id = t1.cert_no group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_query_n_total' as index_name, sum((case when t1.queryreason='贷款审批' then 1 else 0 end)) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t1.report_id = t.row_id and t.global_id = t1.cert_no group by t.row_id ,t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'query_n_total' as index_name, count(1) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t1.report_id = t.row_id and t.global_id = t1.cert_no group by t.row_id ,t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'jnnc_loan_n_query' as index_name, sum((case when t1.queryreason='贷款审批' and t1.querier like '%江南农村商业银行股份有限公司%' then 1 else 0 end)) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join TBL_PER_RECORDDETAIL t1 on t1.report_id = t.row_id and t.global_id = t1.cert_no group by t.row_id ,t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_foreign_n_used' as index_name, (case when t2.index_value=0 or t2.index_value is null then -1 else t2.index_value end ) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(distinct t1.cue_org) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.cue_cust_type <> '人民币账户' and t1.cue_cust_type is not null and cast(t1.usedhighestamount as double)>0 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_foreign_n_total' as index_name, (case when t2.index_value=0 or t2.index_value is null then -1 else t2.index_value end ) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(distinct t1.cue_org) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.cue_cust_type <> '人民币账户' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_credit_limit_level_total' as index_name, case when max(t1.cue_sx_amount) < 5000 then 1 when max(t1.cue_sx_amount) >=5000 and max(t1.cue_sx_amount) < 10000 then 2 when max(t1.cue_sx_amount) >=10000 and max(t1.cue_sx_amount) < 20000 then 3 when max(t1.cue_sx_amount) >=20000 and max(t1.cue_sx_amount) < 50000 then 4 when max(t1.cue_sx_amount) >=50000 then 5 else 0 end as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.card_id , 'n_card_low_money_total' as index_name, nvl(A.index_value,-1) as index_value, A.report_create_time,'' as etl_date  from (select t.row_id , t.global_id as card_id, sum(case when t1.cue_sx_amount < 5000 then 1 when t1.cue_sx_amount > 5000 then 0 else null end) as index_value, max(t.query_time) as report_create_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.card_id, 'n_card_medium1_money_total' as index_name, nvl(A.index_value,-1) as index_value, A.report_create_time,'' as etl_date  from (select t.row_id , t.global_id as card_id, sum(case when t1.cue_sx_amount >= 5000 and t1.cue_sx_amount < 10000 then 1 else null end ) as index_value, max(t.query_time) as report_create_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.card_id, 'n_card_medium2_money_total' as index_name, nvl(A.index_value,-1) as index_value, A.report_create_time,'' as etl_date  from (select t.row_id , t.global_id as card_id, sum(case when t1.cue_sx_amount >= 10000 and t1.cue_sx_amount < 20000 then 1 else null end ) as index_value, max(t.query_time) as report_create_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.card_id , 'n_card_medium3_money_total' as index_name, nvl(A.index_value,-1) as index_value, A.report_create_time,'' as etl_date  from (select t.row_id , t.global_id as card_id, sum(case when t1.cue_sx_amount >= 20000 and t1.cue_sx_amount < 50000 then 1 else null end ) as index_value, max(t.query_time) as report_create_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id , A.card_id, 'n_card_high_money_total' as index_name, nvl(A.index_value,-1) as index_value, A.report_create_time,'' as etl_date  from (select t.row_id , t.global_id as card_id, sum(case when t1.cue_sx_amount >= 50000 then 1 else null end ) as index_value, max(t.query_time) as report_create_time from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id group by t.row_id ,t.global_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_credit_limit_level_used' as index_name, nvl(t2.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , case when max(t1.cue_sx_amount) < 5000 then 1 when max(t1.cue_sx_amount) >=5000 and max(t1.cue_sx_amount) < 10000 then 2 when max(t1.cue_sx_amount) >=10000 and max(t1.cue_sx_amount) < 20000 then 3 when max(t1.cue_sx_amount) >=20000 and max(t1.cue_sx_amount) < 50000 then 4 when max(t1.cue_sx_amount) >=50000 then 5 else 0 end as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_low_money_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_sx_amount < 5000 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_medium1_money_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_sx_amount >= 5000 and t1.cue_sx_amount < 10000 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_medium2_money_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_sx_amount >= 10000 and t1.cue_sx_amount < 20000 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_medium3_money_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_sx_amount >= 20000 and t1.cue_sx_amount < 50000 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_high_money_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_sx_amount >= 50000 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_mortgage_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_db_way='抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_other_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_db_way in ('其他担保','组合（不含保证）担保','质押（含保证金）担保') group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date ) select t.row_id , t.global_id, 'n_card_guaranteetype_free_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_db_way in ('信用/免担保') group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_assurance_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') and t1.cue_db_way in ('保证') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_n_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_n_nonactive' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('未激活','\N') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_n_closed' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(distinct t1.cue) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('冻结','销户','止付') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'card_n_total' as index_name, nvl(t2.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'credit_card_n_Freeze' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state in ('冻结') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'card_first_creditlimit' as index_name, nvl(t2.cue_sx_amount,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id , t1.global_id , t1.cue_sx_amount  from (select row_id ,global_id ,cue_sx_amount , row_number() over(partition by row_id ,global_id order by cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloancardinfo_all where global_id is not null and row_id is not null ) t1 where t1.rn = 1 )t2 on t.row_id=t2.row_id and t.global_id = t2.global_id where t.row_id is not null ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_business_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人经营性贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_car_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_commercial_house_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人商用房（包括商住两用）贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_consumer_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人消费贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_student_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人助学贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_housing_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_housing_fund_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='个人住房公积金贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_farmer_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl='农户贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'sum_house_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl like '%房%' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_other_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') and t1.cue_amt_zl not like '%房%' and t1.cue_amt_zl='个人汽车贷款' and t1.cue_amt_zl is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'other_loan_guranteetype_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.state is not null and t1.state<>'结清' and t1.cue_db_way in ('混合担保','抵押担保','非抵押担保') then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'sum_car_house_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(*) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where (t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%汽车%') and t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_assurance_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum( case when t1.cue_db_way<>'保证' then 0 else 1 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') and t1.cue_db_way is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_mortgage_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_db_way<>'抵押担保' then 0 else 1 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') and t1.cue_db_way is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_famer_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_db_way<>'农户联保' then 0 else 1 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') and t1.cue_db_way is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_other_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_db_way in ('其他担保','质押（含保证金）担保','组合（含保证）担保','组合（不含保证）担保') then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') and t1.cue_db_way is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_free_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_db_way in ('信用/免担保') then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') and t1.cue_db_way is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_month_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_gh_way like '%按月归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_quarter_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_gh_way like '%按季归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_year_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum( case when t1.cue_gh_way like '%按年归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_one_time_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_gh_way like '%一次性归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_irregular_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_gh_way like '%不定期归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_other_used' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum( case when t1.cue_gh_way like '%按日归还%' or t1.cue_gh_way like '%按周归还%' or t1.cue_gh_way like '%按半年归还%' or t1.cue_gh_way like '%按其他方式归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '结清' and t1.state is not null and t1.state in ('正常','呆账') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_mini_repay_card' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.actualpaymentamount <>0 and t1.scheduledpaymentamount/t1.actualpaymentamount >= 0.8 and t1.scheduledpaymentamount/t1.actualpaymentamount <= 1.2 then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_credit_card_used' as index_name, nvl(t1.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select A.REPORT_ID ,A.cert_no , max(replace(A.loan_card_count,'\N',0)) as index_value from TBL_PER_INFO_SUMARRY A left join (select row_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all where state in ('正常','呆账') ) B on A.REPORT_ID = B.row_id group by A.REPORT_ID ,A.cert_no ) t1 on t.row_id = t1.REPORT_ID and t.global_id = t1.cert_no ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_q_credit_card_used' as index_name, nvl(t1.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select A.REPORT_ID ,A.cert_no , max(replace(A.standard_loan_card_count,'\N',0)) as index_value from TBL_PER_INFO_SUMARRY A left join (select row_id from hdm_wbd_zx_qry_tblpbocloancardinfo_all where state in ('正常','呆账') ) B on A.REPORT_ID = B.row_id group by A.REPORT_ID ,A.cert_no ) t1 on t.row_id=t1.REPORT_ID and t.global_id = t1.cert_no ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_credit_card_total' as index_name, nvl(t1.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select REPORT_ID ,cert_no , max(replace(cast(loan_card_count as varchar),'\N',0)) as index_value from TBL_PER_INFO_SUMARRY group by REPORT_ID ,cert_no ) t1 on t.row_id=t1.REPORT_ID and t.global_id = t1.cert_no ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'n_q_credit_card_total' as index_name, nvl(t1.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select REPORT_ID ,cert_no, max(replace(standard_loan_card_count,'\N',0)) as index_value from TBL_PER_INFO_SUMARRY group by REPORT_ID ,cert_no ) t1 on t.row_id=t1.REPORT_ID and t.global_id = t1.cert_no ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_mortgage_n_closed' as index_name, nvl(cast(sum(t2.index_value) as int),-1) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when (t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%车%' or t1.cue_db_way='抵押担保') and t1.state='结清' then 1 when (t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%车%' or t1.cue_db_way='抵押担保') and t1.state<>'结清' then 0 else null end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'nonmortgage_n_used' as index_name ,nvl(max(t2.index_value),-1) as index_value ,max(t1.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id ,t.global_id ,cast(sum(t.a) as int) as index_value from (select row_id , global_id ,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where (cue_amt_zl not like '%房%' or cue_amt_zl not like '%车%') and cue_db_way <> '抵押担保' and state in ('正常','呆账') group by row_id , global_id ) t group by t.row_id ,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'nonmortgage_n_closed' as index_name, nvl(max(t2.index_value),-1) as index_value, max(t1.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id ,t.global_id,cast(sum(t.a) as int) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where (cue_amt_zl not like '%房%' or cue_amt_zl not like '%车%') and cue_db_way <> '抵押担保' and state='结清' group by row_id,global_id ) t group by t.row_id ,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'nonmortgage_n_total' as index_name, nvl(max(t2.index_value),-1) as index_value, max(t1.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where (cue_amt_zl not like '%房%' or cue_amt_zl not like '%车%') and cue_db_way <> '抵押担保' group by row_id,global_id ) t group by t.row_id ,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_n_used' as index_name, nvl(max(t2.index_value),-1) as index_value, max(t1.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where state in ('正常','呆账') group by row_id,global_id) t group by t.row_id,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_n_closed' as index_name, nvl(max(t2.index_value),-1) as index_value, max(t1.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where state='结清' group by row_id,global_id ) t group by t.row_id,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_n_total' as index_name, nvl(max(t2.index_value),0) as index_value, max(t1.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from (select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where state <>'\N' group by row_id,global_id ) t group by t.row_id,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id group by t1.row_id , t1.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_first_type' as index_name, nvl(t2.cue_amt_zl,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id , W.cue_amt_zl  from (select t.row_id ,t.global_id , t.cue_amt_zl , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloaninfo_all t where t.cue_out_time is not null and t.global_id is not null ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_first_guaranteetype' as index_name, nvl(t2.cue_db_way,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id , W.cue_db_way  from (select t.row_id ,t.global_id , t.cue_db_way , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloaninfo_all t where t.cue_out_time is not null and t.global_id is not null ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_first_over' as index_name, nvl(t3.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t2.row_id, t2.global_id , case when t2.state='结清' then '1' else '0' end as index_value from (select W.row_id ,W.global_id , W.state from (select t.row_id , t.global_id , t.state , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloaninfo_all t where t.cue_out_time is not null and t.global_id is not null ) W where W.rn =1 ) t2 ) t3 on t1.row_id=t3.row_id and t1.global_id = t3.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_first_amount' as index_name, nvl(t2.cue_amt,-1) as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id , W.cue_amt  from (select t.row_id ,t.global_id , t.cue_amt , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloaninfo_all t where t.cue_out_time is not null and t.global_id is not null ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_first_type' as index_name, nvl(t2.cue_cust_type,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id , W.cue_cust_type  from (select t.row_id ,t.global_id , t.cue_cust_type , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloancardinfo_all t where t.cue_out_time is not null and t.global_id is not null ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_first_guaranteetype' as index_name, nvl(t2.cue_db_way,'无信贷账户') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id, W.cue_db_way  from (select t.row_id ,t.global_id, t.cue_db_way , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloancardinfo_all t where t.cue_out_time is not null and t.global_id is not null and state <> '\N' ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_first_over' as index_name, nvl(t3.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t2.row_id ,t2.global_id , case when t2.state='销户' then '1' else '0' end as index_value from (select W.row_id ,W.global_id , W.state from (select t.row_id ,t.global_id, t.state , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloancardinfo_all t where t.cue_out_time is not null and t.global_id is not null and state <> '\N' ) W where W.rn =1 ) t2 ) t3 on t1.row_id=t3.row_id and t1.global_id = t3.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_first_amount' as index_name, nvl(t2.cue_sx_amount,-1) as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select W.row_id ,W.global_id , W.cue_sx_amount  from (select t.row_id ,t.global_id , t.cue_sx_amount , row_number() over(partition by t.global_id order by t.cue_out_time ) as rn from hdm_wbd_zx_qry_tblpbocloancardinfo_all t where t.cue_out_time is not null and t.global_id is not null and state <> '\N' ) W where W.rn =1 ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'card_max_creditlimit_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,max(cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_out_time is not null and row_id is not null and state in ('正常','呆账') group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'card_sum_creditlimit_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,sum(cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_out_time is not null and row_id is not null and state in ('正常','呆账') group by row_id ,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'card_max_creditlimit_total' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,max(cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_out_time is not null and row_id is not null and state <> '\N' group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_max_creditlimitamount_used' as index_name, nvl(t.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t2.row_id,t2.global_id,max(t2.cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t2 left join (select row_id from hdm_wbd_zx_qry_tblpbocloaninfo_all where state not in ('结清','\N') ) t3 on t2.row_id = t3.row_id where t2.cue_out_time is not null group by t2.row_id,t2.global_id ) t on t1.row_id=t.row_id and t1.global_id = t.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_max_creditlimitamount_total' as index_name, nvl(t.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t2.row_id,t2.global_id,max(t2.cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t2 left join (select row_id from hdm_wbd_zx_qry_tblpbocloaninfo_all where state not in ('\N')) t3 on t2.row_id = t3.row_id where t2.cue_out_time is not null group by t2.row_id,t2.global_id ) t on t1.row_id=t.row_id and t1.global_id = t.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'card_min_creditlimit_total' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,nvl(min(cue_sx_amount),0) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_out_time is not null and row_id is not null and state <> '\N' group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'card_min_creditlimit_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,nvl(min(cue_sx_amount),0) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_out_time is not null and row_id is not null and state in ('正常','呆账') group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_min_creditlimitamount_total' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,min(cue_amt) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all where state<>'\N' group by row_id ,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_min_creditlimitamount_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,min(cue_amt) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all where state not in ('结清','\N') group by row_id ,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'n_card_last3_high_money_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,min(cue_amt) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all where state not in ('结清','\N') group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'n_card_5hundred_used' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id,count(*) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all where cue_sx_amount < 500 and state in ('正常','呆账') group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'loan_org_type' as index_name, nvl(t2.index_value,'-1') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select row_id,global_id, max(case when regexp_substr(cue,'日(.*?)“') in ('外资银行','商业银行','住房公积金管理中心','住房储蓄银行') then '0' when regexp_substr(cue,'日(.*?)“') in ('机构','信托投资银行','财务公司','消费金融公司','汽车金融公司') then '1' when regexp_substr(cue,'日(.*?)“') in ('村镇银行','小额信贷公司') or cue is null then '2' else '-1' end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all where row_id is not null group by row_id,global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_mortgage_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '\N' and t1.cue_db_way='抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_other_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '\N' and t1.cue_db_way in ('其他担保','组合（不含保证）担保','质押（含保证金）担保') group by t1.global_id,t1.row_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_free_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '\N' and t1.cue_db_way in ('信用/免担保') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_card_guaranteetype_assurance_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '\N' and t1.cue_db_way in ('保证') group by t1.row_id,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_business_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '\N' and t1.cue_amt_zl='个人经营性贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_car_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '\N' and t1.cue_amt_zl='个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_commercial_house_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '\N' and t1.cue_amt_zl='个人商用房（包括商住两用）贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_consumer_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '\N' and t1.cue_amt_zl='个人消费贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_student_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '\N' and t1.cue_amt_zl='个人助学贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_housing_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '\N' and t1.cue_amt_zl='个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_housing_fund_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '\N' and t1.cue_amt_zl='个人住房公积金贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_farmer_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '\N' and t1.cue_amt_zl='农户贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'sum_house_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '\N' and t1.cue_amt_zl like '%房%' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_type_other_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state <> '\N' and t1.cue_amt_zl not like '%房%' and t1.cue_amt_zl not like '%车%' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'other_loan_guaranteetype_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.cue_db_way in ('混合担保','抵押担保','非抵押担保') then '1' else '0' end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' and t1.cue_amt_zl = '其他贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'car_loan_guaranteetype_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.cue_db_way in ('混合担保','抵押担保','非抵押担保') then '1' else '0' end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' and t1.cue_amt_zl like '%车%' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'sum_car_house_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_amt_zl like '%车%' or t1.cue_amt_zl like '%房%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_assurance_total' as index_name, nvl(t2.index_value,-1) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_db_way='保证' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_mortgage_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_db_way='抵押担保' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_famer_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_db_way='农户联保' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_other_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_db_way in ('其他担保','质押（含保证金）担保','组合（不含保证）担保','组合（含保证）担保') then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_guaranteetype_free_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_db_way='信用/免担保' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_month_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_gh_way like '%按月归还%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_quarter_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_gh_way like '%按季归还%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_year_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_gh_way like '%按年归还%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_one_time_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_gh_way like '%一次性归还%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_irregular_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id ,sum(case when t1.cue_gh_way like '%不定期归还%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id, 'n_loan_paymentrating_other_total' as index_name, nvl(t2.index_value,'-1') as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_gh_way like '%按日归还%' or t1.cue_gh_way like '%按周归还%' or t1.cue_gh_way like '%按半年归还%' or t1.cue_gh_way like '%按其他方式归还%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.state<>'\N' group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m1_3m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(replace(func_right(t1.last_24state, 3),'1','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(replace(func_right(t1.last_24state, 3),'2','')),0) end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m1_6m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(replace(func_right(t1.last_24state, 6),'1','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(replace(func_right(t1.last_24state, 6),'2','')),0) end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m1_12m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(replace(func_right(t1.last_24state, 12),'1','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(replace(func_right(t1.last_24state, 12),'2','')),0) end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m1_24m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(replace(func_right(t1.last_24state, 24),'1','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(replace(func_right(t1.last_24state, 24),'2','')),0) end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m2_3m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(replace(func_right(t1.last_24state, 3),'2','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(replace(func_right(t1.last_24state, 3),'3','')),0) end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m2_6m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(replace(func_right(t1.last_24state, 6),'2','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(replace(func_right(t1.last_24state, 6),'3','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m2_12m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(replace(func_right(t1.last_24state, 12),'2','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(replace(func_right(t1.last_24state, 12),'3','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_m2_24m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(replace(func_right(t1.last_24state, 24),'2','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(replace(func_right(t1.last_24state, 24),'3','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'credit_card_ov_3m' as index_name, to_char(nvl(sum(t2.index_value), '0'), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.last_24state, 3)) - length(regexp_replace(func_right(t1.last_24state, 3),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'credit_card_ov_6m' as index_name, to_char(nvl(sum(t2.index_value), '0'), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.last_24state, 6)) - length(regexp_replace(func_right(t1.last_24state, 6),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'credit_card_ov_12m' as index_name, to_char(nvl(sum(t2.index_value), '0'), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.last_24state, 12)) - length(regexp_replace(func_right(t1.last_24state, 12),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_now_n' as index_name, sum(to_char(nvl(t2.index_value, '0'), '99999')) as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverduecyc) else null end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_now_money' as index_name, sum(nvl(t2.index_value, '0')) as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverdueamount) else null end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_first_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when t1.cue_card_type = '贷记卡' and substr(replace(last_24state, '/', ''), 1, 2) like '%1%' then '1' when t1.cue_card_type = '准贷记卡' and substr(replace(last_24state, '/', ''), 2, 2) like '%2%' then '1' else '0' end else '0' end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_third_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when t1.cue_card_type = '贷记卡' and substr(replace(last_24state, '/', ''), 1, 4) like '%3%' then '1' when t1.cue_card_type = '准贷记卡' and substr(replace(last_24state, '/', ''), 2, 4) like '%4%' then '1' else '0' end else '0' end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_mortgage_first_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when substr(replace(latest24state, '/', ''), 1, 2) like '%1%' then '1' else '0' end else '0' end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_mortgage_max_month_ol_24m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when regexp_substr(t1.latest24state , '[0-9]+') like '%9%' then 9 when regexp_substr(t1.latest24state , '[0-9]+') like '%8%' then 8 when regexp_substr(t1.latest24state , '[0-9]+') like '%7%' then 7 when regexp_substr(t1.latest24state , '[0-9]+') like '%6%' then 6 when regexp_substr(t1.latest24state , '[0-9]+') like '%5%' then 5 when regexp_substr(t1.latest24state , '[0-9]+') like '%4%' then 4 when regexp_substr(t1.latest24state , '[0-9]+') like '%3%' then 3 when regexp_substr(t1.latest24state , '[0-9]+') like '%2%' then 2 when regexp_substr(t1.latest24state , '[0-9]+') like '%1%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (t1.cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or t1.cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_mortgage_third_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when substr(replace(latest24state, '/', ''), 1, 4) like '%3%' then '1' else '0' end else '0' end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (t1.cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or t1.cue_db_way = '抵押担保') and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'house_ol_3m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - length(regexp_replace(func_right(t1.latest24state, 3),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'house_ol_6m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - length(regexp_replace(func_right(t1.latest24state, 6),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'house_ol_12m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - length(regexp_replace(func_right(t1.latest24state, 12),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'house_ol_24m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - length(regexp_replace(func_right(t1.latest24state, 24),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人住房贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'car_ol_3m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - length(regexp_replace(func_right(t1.latest24state, 3),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'car_ol_6m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - length(regexp_replace(func_right(t1.latest24state, 6),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'car_ol_12m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - length(regexp_replace(func_right(t1.latest24state, 12),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'car_ol_24m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - length(regexp_replace(func_right(t1.latest24state, 24),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl = '个人汽车贷款' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_ol_3m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - length(regexp_replace(func_right(t1.latest24state, 3),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_ol_6m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - length(regexp_replace(func_right(t1.latest24state, 6),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_ol_12m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - length(regexp_replace(func_right(t1.latest24state, 12),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_ol_24m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - length(regexp_replace(func_right(t1.latest24state, 24),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_ol_3m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - length(regexp_replace(func_right(t1.latest24state, 3),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_ol_6m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - length(regexp_replace(func_right(t1.latest24state, 6),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_ol_12m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - length(regexp_replace(func_right(t1.latest24state, 12),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_ol_24m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - length(regexp_replace(func_right(t1.latest24state, 24),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_first_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when substr(replace(latest24state, '/', ''), 1, 2) like '%1%' then '1' else '0' end else '0' end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_max_month_ol_24m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when regexp_substr(t1.latest24state , '[0-9]+') like '%9%' then 9 when regexp_substr(t1.latest24state , '[0-9]+') like '%8%' then 8 when regexp_substr(t1.latest24state , '[0-9]+') like '%7%' then 7 when regexp_substr(t1.latest24state , '[0-9]+') like '%6%' then 6 when regexp_substr(t1.latest24state , '[0-9]+') like '%5%' then 5 when regexp_substr(t1.latest24state , '[0-9]+') like '%4%' then 4 when regexp_substr(t1.latest24state , '[0-9]+') like '%3%' then 3 when regexp_substr(t1.latest24state , '[0-9]+') like '%2%' then 2 when regexp_substr(t1.latest24state , '[0-9]+') like '%1%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_third_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when substr(replace(latest24state, '/', ''), 1, 4) like '%3%' then '1' else '0' end else '0' end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m1_3m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - nvl(length(replace(func_right(t1.latest24state, 3),'1','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t2.global_id = t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m1_6m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - nvl(length(replace(func_right(t1.latest24state, 6),'1','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m1_12m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - nvl(length(replace(func_right(t1.latest24state, 12),'1','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m1_24m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - nvl(length(replace(func_right(t1.latest24state, 24),'1','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m2_3m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - nvl(length(replace(func_right(t1.latest24state, 3),'2','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m2_6m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - nvl(length(replace(func_right(t1.latest24state, 6),'2','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m2_12m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - nvl(length(replace(func_right(t1.latest24state, 12),'2','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_m2_24m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - nvl(length(replace(func_right(t1.latest24state, 24),'2','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_now_n' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverduecyc) else null end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_now_money' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverdueamount) else null end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_first_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when substr(replace(latest24state, '/', ''), 1, 2) like '%1%' then '1' else '0' end else '0' end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_max_month_ol_24m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when regexp_substr(t1.latest24state , '[0-9]+') like '%9%' then 9 when regexp_substr(t1.latest24state , '[0-9]+') like '%8%' then 8 when regexp_substr(t1.latest24state , '[0-9]+') like '%7%' then 7 when regexp_substr(t1.latest24state , '[0-9]+') like '%6%' then 6 when regexp_substr(t1.latest24state , '[0-9]+') like '%5%' then 5 when regexp_substr(t1.latest24state , '[0-9]+') like '%4%' then 4 when regexp_substr(t1.latest24state , '[0-9]+') like '%3%' then 3 when regexp_substr(t1.latest24state , '[0-9]+') like '%2%' then 2 when regexp_substr(t1.latest24state , '[0-9]+') like '%1%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_third_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when substr(replace(latest24state, '/', ''), 1, 4) like '%3%' then '1' else '0' end else '0' end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'all_credit_card_max_month_ol' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when regexp_substr(t1.last_24state , '[0-9]+') like '%9%' then 9 when regexp_substr(t1.last_24state , '[0-9]+') like '%8%' then 8 when regexp_substr(t1.last_24state , '[0-9]+') like '%7%' then 7 when regexp_substr(t1.last_24state , '[0-9]+') like '%6%' then 6 when regexp_substr(t1.last_24state , '[0-9]+') like '%5%' then 5 when regexp_substr(t1.last_24state , '[0-9]+') like '%4%' then 4 when regexp_substr(t1.last_24state , '[0-9]+') like '%3%' then 3 when regexp_substr(t1.last_24state , '[0-9]+') like '%2%' then 2 when regexp_substr(t1.last_24state , '[0-9]+') like '%1%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'all_q_credit_card_max_month_ol' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.last_24state, 24)) - length(replace(regexp_replace(func_right(t1.last_24state,24),'[0-9]+',''),'N',''))) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '准贷记卡' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'all_loan_max_month_ol' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when regexp_substr(t1.latest24state , '[0-9]+') like '%9%' then 9 when regexp_substr(t1.latest24state , '[0-9]+') like '%8%' then 8 when regexp_substr(t1.latest24state , '[0-9]+') like '%7%' then 7 when regexp_substr(t1.latest24state , '[0-9]+') like '%6%' then 6 when regexp_substr(t1.latest24state , '[0-9]+') like '%5%' then 5 when regexp_substr(t1.latest24state , '[0-9]+') like '%4%' then 4 when regexp_substr(t1.latest24state , '[0-9]+') like '%3%' then 3 when regexp_substr(t1.latest24state , '[0-9]+') like '%2%' then 2 when regexp_substr(t1.latest24state , '[0-9]+') like '%1%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_sixth_ol' as index_name, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when t1.cue_card_type = '贷记卡' and substr(replace(last_24state, '/', ''), 1, 7) like '%6%' then '1' when t1.cue_card_type = '准贷记卡' and substr(replace(last_24state, '/', ''), 2, 7) like '%7%' then '1' else '0' end else '0' end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_mortgage_sixth_ol' as index_name, nvl(t2.index_value, 0) as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when substr(replace(latest24state, '/', ''), 1, 7) like '%6%' then 1 else 0 end else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_nonmortgage_sixth_ol' as index_name, nvl(t2.index_value, 0) as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when substr(replace(latest24state, '/', ''), 1, 7) like '%6%' then 1 else 0 end else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_six_ol' as index_name, nvl(t2.index_value, 0) as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.query_time - to_date(t1.cue_out_time) < '666666'then case when substr(replace(latest24state, '/', ''), 1,7) like '%6%' then 1 else 0 end else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_org NOT LIKE '%江南农%商%行%' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_3m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(replace(func_right(t1.last_24state, 3),'[0-9]+','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(replace(func_right(t1.last_24state, 3),'[2-9]','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_6m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(replace(func_right(t1.last_24state, 6),'[0-9]+','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(replace(func_right(t1.last_24state, 6),'[2-9]','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_12m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(replace(func_right(t1.last_24state, 12),'[0-9]+','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(replace(func_right(t1.last_24state, 12),'[2-9]','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_ol_24m' as index_name, to_char(sum(nvl(t2.index_value, '0')), '99999') as index_value, max(t.query_time) as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(replace(func_right(t1.last_24state, 24),'[0-9]+','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(replace(func_right(t1.last_24state, 24),'[2-9]','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_3m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - length(regexp_replace(func_right(t1.latest24state, 3),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_6m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - length(regexp_replace(func_right(t1.latest24state, 6),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_12m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - length(regexp_replace(func_right(t1.latest24state, 12),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_ol_24m' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - length(regexp_replace(func_right(t1.latest24state, 24),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'ice_card' as index_name, to_char(nvl(t2.index_value, '-1'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' and t1.state = '冻结' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'stop_pay' as index_name, to_char(nvl(t2.index_value, '-1'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' and t1.state = '止付' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'hk_y_24m' as index_name, to_char(nvl(t2.index_value, '-1'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when t1.latest24state like '%N%' then 1 when t1.latest24state is null then -1 else 0 end ) AS index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_dz_count' as index_name, to_char(nvl(t2.index_value,'-1'),'99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '呆账' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_dz_count' as index_name, to_char(nvl(t2.index_value, '-1'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' and t1.state = '呆账' group by t1.row_id,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'class5_loan_count_N' as index_name, to_char(nvl(t2.index_value, '-1'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.class5state <> '正常' group by t1.row_id,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'class5_loan_count_G' as index_name, to_char(nvl(t2.index_value, '-1'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.class5state = '关注' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_long_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '未激活' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_long_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_short_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.state <> '未激活' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_short_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.state <> '未激活' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_long_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_long_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_short_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_short_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_long_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_long_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_short_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_short_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_long_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_long_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_short_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_short_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_long_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_long_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_short_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_short_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_long_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_long_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_short_time_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_short_time_sct_total' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'card_long_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_long_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_short_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'card_short_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_long_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_long_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_short_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way <> '抵押担保' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'nonmortgage_short_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way != '抵押担保' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_long_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_long_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_short_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'house_short_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人住房贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_long_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_long_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_short_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'car_short_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.cue_amt_zl = '个人汽车贷款' and t1.state = '正常' and t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'cert_mortgage_long_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_long_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_short_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'cert_mortgage_short_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.cue_amt_zl not in ('个人汽车贷款', '个人住房贷款') and t1.cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id, 'loan_long_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_long_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_short_time_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t.row_id , t.global_id as card_id, 'loan_short_time_sct_used' as index_name, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME,'' as etl_date from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_limit_card_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(case when t3.state in ('正常','呆账') then t3.cue_sx_amount else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%信用卡%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_limit_average_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(case when t3.state in ('正常','呆账') then t3.cue_sx_amount else null end)/count(case when t3.state in ('正常','呆账') then t3.cue_sx_amount else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%信用卡%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_card_use_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(case when t3.state in ('正常','呆账') then t3.cue_sx_amount else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_card_use_sct' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(t3.usedcreditlimitamount) < 50000 then '1' when sum(t3.usedcreditlimitamount) >= 50000 and sum(t3.usedcreditlimitamount) < 100000 then '2' when sum(t3.usedcreditlimitamount) >= 100000 and sum(t3.usedcreditlimitamount) < 150000 then '3' when sum(t3.usedcreditlimitamount) >= 150000 and sum(t3.usedcreditlimitamount) < 200000 then '4' when sum(t3.usedcreditlimitamount) >= 200000 then '5' else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'used_money_six_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(case when t3.state in ('正常','呆账') then t3.latest6monthusedavgamount else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'used_money_six_sct' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(t3.latest6monthusedavgamount) < 50000 then '1' when sum(t3.latest6monthusedavgamount) >= 50000 and sum(t3.latest6monthusedavgamount) < 100000 then '2' when sum(t3.latest6monthusedavgamount) >= 100000 and sum(t3.latest6monthusedavgamount) < 150000 then '3' when sum(t3.latest6monthusedavgamount) >= 150000 and sum(t3.latest6monthusedavgamount) < 200000 then '4' when sum(t3.latest6monthusedavgamount) >= 200000 then '5' else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%信用卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_six_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_card' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') group by t1.global_id ,t1.row_id ) A ) W ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_low_money' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') and t3.cue_sx_amount < 50000 group by t1.global_id ,t1.row_id ) A ) W ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_medium1_money' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') and t3.cue_sx_amount >= 50000 and t3.cue_sx_amount < 100000 group by t1.global_id ,t1.row_id ) A ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_medium2_money' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') and t3.cue_sx_amount >= 100000 and t3.cue_sx_amount < 200000 group by t1.global_id ,t1.row_id ) A ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_medium3_money' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') and t3.cue_sx_amount >= 200000 and t3.cue_sx_amount < 500000 group by t1.global_id ,t1.row_id ) A ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_high_money' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') and t3.cue_sx_amount >= 500000 group by t1.global_id ,t1.row_id ) A ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_no_new_3m' as index_name, nvl(max(W.index_value),-20) as index_value, max(W.query_time) as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when B.index_value <0.1 then '1' when B.index_value >=0.1 and B.index_value <0.2 then '2' when B.index_value >=0.2 and B.index_value <0.3 then '3' when B.index_value >=0.3 and B.index_value <0.4 then '4' when B.index_value >=0.4 and B.index_value <0.5 then '5' when B.index_value >=0.5 and B.index_value <0.6 then '6' when B.index_value >=0.6 and B.index_value <0.7 then '7' when B.index_value >=0.7 and B.index_value <0.8 then '8' when B.index_value >=0.8 and B.index_value <0.9 then '9' when B.index_value >=0.9 and B.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id =t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t1.cue_sx_amount,0)) <> 0 then sum(t1.usedcreditlimitamount)/sum(t1.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t1.state not in ('未激活','\N') group by t1.global_id ,t1.row_id ) B on A.row_id = B.row_id and A.global_id = B.global_id ) W group by W.row_id, W.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_new_3m' as index_name, nvl(max(W.index_value),-20) as index_value, max(W.query_time) as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when B.index_value <0.1 then '1' when B.index_value >=0.1 and B.index_value <0.2 then '2' when B.index_value >=0.2 and B.index_value <0.3 then '3' when B.index_value >=0.3 and B.index_value <0.4 then '4' when B.index_value >=0.4 and B.index_value <0.5 then '5' when B.index_value >=0.5 and B.index_value <0.6 then '6' when B.index_value >=0.6 and B.index_value <0.7 then '7' when B.index_value >=0.7 and B.index_value <0.8 then '8' when B.index_value >=0.8 and B.index_value <0.9 then '9' when B.index_value >=0.9 and B.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id =t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.state in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t1.cue_sx_amount,0)) <> 0 then sum(t1.usedcreditlimitamount)/sum(t1.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t1.state not in ('未激活','\N') group by t1.global_id ,t1.row_id ) B on A.row_id = B.row_id and A.global_id = A.global_id ) W group by W.row_id, W.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_no_new_6m' as index_name, nvl(max(W.index_value),-20) as index_value, max(W.query_time) as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when B.index_value <0.1 then '1' when B.index_value >=0.1 and B.index_value <0.2 then '2' when B.index_value >=0.2 and B.index_value <0.3 then '3' when B.index_value >=0.3 and B.index_value <0.4 then '4' when B.index_value >=0.4 and B.index_value <0.5 then '5' when B.index_value >=0.5 and B.index_value <0.6 then '6' when B.index_value >=0.6 and B.index_value <0.7 then '7' when B.index_value >=0.7 and B.index_value <0.8 then '8' when B.index_value >=0.8 and B.index_value <0.9 then '9' when B.index_value >=0.9 and B.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id =t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.state in ('未激活','\N') and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t1.cue_sx_amount,0)) <> 0 then sum(t1.usedcreditlimitamount)/sum(t1.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t1.state not in ('未激活','\N') group by t1.global_id ,t1.row_id ) B on A.row_id = B.row_id and A.global_id = B.global_id ) W group by W.row_id, W.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_six_sct_new_6m' as index_name, nvl(max(W.index_value),-20) as index_value, max(W.query_time) as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when B.index_value <0.1 then '1' when B.index_value >=0.1 and B.index_value <0.2 then '2' when B.index_value >=0.2 and B.index_value <0.3 then '3' when B.index_value >=0.3 and B.index_value <0.4 then '4' when B.index_value >=0.4 and B.index_value <0.5 then '5' when B.index_value >=0.5 and B.index_value <0.6 then '6' when B.index_value >=0.6 and B.index_value <0.7 then '7' when B.index_value >=0.7 and B.index_value <0.8 then '8' when B.index_value >=0.8 and B.index_value <0.9 then '9' when B.index_value >=0.9 and B.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id = t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.state in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null ) A left join (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t1.cue_sx_amount,0)) <> 0 then sum(t1.usedcreditlimitamount)/sum(t1.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t1.state not in ('未激活','\N') group by t1.global_id ,t1.row_id ) B on A.row_id = B.row_id and A.global_id = B.global_id ) W group by W.row_id, W.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_usenow_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_usenow_sct' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when A.index_value <0.1 then '1' when A.index_value >=0.1 and A.index_value <0.2 then '2' when A.index_value >=0.2 and A.index_value <0.3 then '3' when A.index_value >=0.3 and A.index_value <0.4 then '4' when A.index_value >=0.4 and A.index_value <0.5 then '5' when A.index_value >=0.5 and A.index_value <0.6 then '6' when A.index_value >=0.6 and A.index_value <0.7 then '7' when A.index_value >=0.7 and A.index_value <0.8 then '8' when A.index_value >=0.8 and A.index_value <0.9 then '9' when A.index_value >=0.9 and A.index_value <1.0 then '10' else null end as index_value, A.query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') group by t1.global_id ,t1.row_id ) A ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'mini_payment_last' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.scheduledpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'minipay_payamount_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_minipay_payamount_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when min(t3.scheduledpaymentamount) <> 0 then sum(t3.actualpaymentamount)/min(t3.scheduledpaymentamount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_minipay_payamount_sct' as index_name, nvl(W.index_value,-1) as index_value, W.query_time as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when max(A.index_value) <0.1 then '1' when max(A.index_value) >=0.1 and max(A.index_value) <0.2 then '2' when max(A.index_value) >=0.2 and max(A.index_value) <0.3 then '3' when max(A.index_value) >=0.3 and max(A.index_value) <0.4 then '4' when max(A.index_value) >=0.4 and max(A.index_value) <0.5 then '5' when max(A.index_value) >=0.5 and max(A.index_value) <0.6 then '6' when max(A.index_value) >=0.6 and max(A.index_value) <0.7 then '7' when max(A.index_value) >=0.7 and max(A.index_value) <0.8 then '8' when max(A.index_value) >=0.8 and max(A.index_value) <0.9 then '9' when max(A.index_value) >=0.9 and max(A.index_value) <1.0 then '10' else null end as index_value, max(A.query_time) as query_time from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when min(t3.scheduledpaymentamount) <> 0 then sum(t3.actualpaymentamount)/min(t3.scheduledpaymentamount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A group by A.row_id, A.global_id ) W ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'mortgage_balance_loan' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.balance) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way ='抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'mortgage_balance_sct_loan' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,case when sum(t3.balance) < 50000 then '1' when sum(t3.balance) >= 50000 and sum(t3.balance) < 100000 then '2' when sum(t3.balance) >= 100000 and sum(t3.balance) < 150000 then '3' when sum(t3.balance) >= 150000 and sum(t3.balance) < 200000 then '4' when sum(t3.balance) >= 200000 then '5' else null end as index_value ,max(t1.query_time) as query_time from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way ='抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_mortgage_loan_low_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.cue_db_way ='抵押担保' then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt < 50000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_mortgage_loan_medium1_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.cue_db_way ='抵押担保' then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 50000 and t3.cue_amt < 200000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_mortgage_loan_medium2_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.cue_db_way ='抵押担保' then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 200000 and t3.cue_amt < 600000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_mortgage_loan_medium3_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.cue_db_way ='抵押担保' then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 600000 and t3.cue_amt < 1000000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_mortgage_loan_high_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.cue_db_way ='抵押担保' then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 1000000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'mortgage_pay_amount_last' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way ='抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'nonmortgage_balance_loan' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.balance) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'nonmortgage_balance_sct_loan' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(t3.balance) < 50000 then '1' when sum(t3.balance) >= 50000 and sum(t3.balance) < 100000 then '2' when sum(t3.balance) >= 100000 and sum(t3.balance) < 150000 then '3' when sum(t3.balance) >= 150000 and sum(t3.balance) < 200000 then '4' when sum(t3.balance) >= 200000 then '5' else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_nonmortgage_low_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt < 50000 and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_nonmortgage_medium1_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 50000 and t3.cue_amt < 200000 and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_nonmortgage_medium2_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 200000 and t3.cue_amt < 600000 and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_nonmortgage_medium3_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 600000 and t3.cue_amt < 100000 and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_nonmortgage_high_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 100000 and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'nonmortgage_pay_amount_last' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_db_way <> '抵押担保' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'loan_balance' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.balance) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'loan_balance_sct' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(t3.balance) < 50000 then '1' when sum(t3.balance) >= 50000 and sum(t3.balance) < 100000 then '2' when sum(t3.balance) >= 100000 and sum(t3.balance) < 150000 then '3' when sum(t3.balance) >= 150000 and sum(t3.balance) < 200000 then '4' when sum(t3.balance) >= 200000 then '5' else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_loan_low_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt < 50000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_loan_medium1_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 50000 and t3.cue_amt < 200000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_loan_medium2_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 200000 and t3.cue_amt < 600000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_loan_medium3_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 600000 and t3.cue_amt < 1000000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'n_loan_high_money_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date   from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt >= 1000000 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'pay_amount_last_loan' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date   from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_limit_card_total' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date   from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.cue_sx_amount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%信用卡%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_limit_average_total' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date   from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when count(1) <> 0 then sum(t3.cue_sx_amount)/count(1) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%信用卡%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'house_repay_amount_1m' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date   from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt_zl ='个人住房贷款' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'car_repay_amount_1m' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date   from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.actualpaymentamount) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t2.queryreason like '%贷款%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt_zl ='个人汽车贷款' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_six_card_house_amount' as index_name, case when sum(t3.actualpaymentamount) <> 0 then nvl(sum(A.usedcreditlimitamount) /sum(t3.actualpaymentamount) ,0) else -1 end as index_value , max(A.query_time) as report_create_time,'' as etl_date   from (select t.row_id, t.global_id, max(t.query_time) as query_time , max(replace(replace(substr(t2.querydate,1,10),'.',''),'\N','')) as querydate , sum(t1.usedcreditlimitamount) as usedcreditlimitamount from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-6) and replace(t1.row_id,'\N',null) is not null and t2.queryreason like '%信用卡%' group by t.row_id ,t.global_id ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-1) group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_use_card_house_amount' as index_name, case when sum(t3.actualpaymentamount) <> 0 then nvl(sum(A.usedcreditlimitamount) /sum(t3.actualpaymentamount) ,0) else -1 end as index_value , max(A.query_time) as report_create_time,'' as etl_date   from (select t.row_id, t.global_id, max(t.query_time) as query_time , max(replace(replace(substr(t2.querydate,1,10),'.',''),'\N','')) as querydate , sum(t1.usedcreditlimitamount) as usedcreditlimitamount from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.state not in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-1) and replace(t1.row_id,'\N',null) is not null and t2.queryreason like '%信用卡%' group by t.row_id ,t.global_id ) A left join hdm_wbd_zx_qry_tblpbocloaninfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-1) group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_usenow_credit_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date   from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when nvl(sum(t3.cue_sx_amount),0) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t3.cue_card_type like '%贷记卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_usenow_q_credit_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date   from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when nvl(sum(t3.cue_sx_amount),0) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) and t3.cue_card_type like '%准贷记卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_six_credit_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date   from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when nvl(sum(t3.cue_sx_amount),0) <> 0 then sum(t3.latest6monthusedavgamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t3.cue_card_type like '%贷记卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_six_q_credit_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(t3.cue_sx_amount) <> 0 then sum(t3.latest6monthusedavgamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t3.cue_card_type like '%准贷记卡%' group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'loan_amount_used' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(case when t3.state in ('正常','呆账') then t3.cue_amt else null end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'loan_amount_total' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.cue_amt) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_card_use_new_3m' as index_name, nvl(sum(t3.usedcreditlimitamount),0) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.state in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-1) group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'used_money_six_new_3m' as index_name, nvl(sum(t3.latest6monthusedavgamount),0) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t.row_id,t.global_id,t.query_time,replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') as querydate from hdm_wbd_zx_qry_tblperrecorddetail_new t left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 on t.row_id=t1.row_id and t.global_id = t1.global_id left join TBL_PER_RECORDDETAIL t2 on t1.row_id=t2.report_id and t2.cert_no = t1.global_id where t1.state in ('未激活','\N') and t1.cue_cust_type='人民币账户' and t1.cue_out_time >= add_months(replace(replace(substr(t2.querydate,1,10),'.',''),'\N',''),-3) and replace(t1.row_id,'\N',null) is not null ) A left join hdm_wbd_zx_qry_tblpbocloancardinfo_all t3 on A.row_id=t3.row_id and A.global_id = t3.global_id where t3.cue_out_time >= add_months(A.querydate,-6) group by A.row_id ,A.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_pay_card' as index_name, nvl(A.index_value,-1) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when nvl(sum(t3.cue_sx_amount),0) <> 0 then sum(t3.scheduledpaymentamount)/sum(t3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' and t3.state in ('正常','呆账') group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id, t.global_id, 'issu_account_n' as index_name, nvl(t2.index_value,0) as index_value, t.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , count(1) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state not in ('正常','\N') group by t1.row_id ,t1.global_id ) t2 on t.row_id=t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'issu_card_n' as index_name, nvl(count(case when A.index_value > 0.9 then A.index_value else null end),0) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when nvl(sum(t3.cue_sx_amount),0) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t2.querier not like '%江南农村商业银行股份有限公司%' group by t1.global_id ,t1.row_id ) A group by A.row_id, A.global_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'last_1m_courtaction_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_CIVILJUDGEMENT t3 on t1.row_id = t3.report_id and t1.global_id = t3.cert_no where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-1) group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'last_3m_courtaction_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_CIVILJUDGEMENT t3 on t1.row_id = t3.report_id and t1.global_id = t3.cert_no where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-3) group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'last_6m_courtaction_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_CIVILJUDGEMENT t3 on t1.row_id = t3.report_id and t1.global_id = t3.cert_no where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_admin_punment_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_ADMINPUNISHMENT t3 on t1.row_id = t3.report_id and t3.cert_no = t1.global_id group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_taxarrears_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_PROFESSIONAL t3 on t1.row_id = t3.report_id and t1.global_id = t3.cert_no group by t1.global_id ,t1.row_id ) A ;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'credit_related_complaints_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(*) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join TBL_PER_CIVILJUDGEMENT t3 on t1.row_id = t3.report_id and t1.global_id = t3.cert_no group by t1.global_id ,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'loan_card_cnt' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,count(1) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt_zl ='个人汽车贷款' and t3.cue_amt > 0 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'personal_house_loan_amount' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t3.cue_amt) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join hdm_wbd_zx_qry_tblpbocloaninfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where t1.queryreason like '%贷款%' and t1.querier not like '%江南农村商业银行股份有限公司%' and t3.cue_amt_zl ='个人商用房（包括商住两用）贷款' and t3.cue_amt > 0 group by t1.global_id,t1.row_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'prod_m_sup_amount' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,sum(t2.PRI_MONTH_PAY_DEPOSIT) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_CRE_PB_RF_INFO t2 on t2.PRI_NUM = t1.row_id and t2.cert_no = t1.global_id group by t1.row_id ,t1.global_id ) A ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'prod_deposit_proporption' as index_name, nvl(A.index_value,0) as index_value, A.query_time as report_create_time,'' as etl_date  from (select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,max(t2.PRI_PAY_DEPOSIT_PER ) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_CRE_PB_RF_INFO t2 on t2.PRI_NUM = t1.row_id and t2.cert_no = t1.global_id group by t1.row_id ,t1.global_id ) A ; 
insert into hdm_wbd_index_factor(row_id,card_id ,index_name ,index_value ,report_create_time,etl_date)select A.row_id,A.global_id as card_id,'take_work_dt' as index_name,case when A.index_value < 30 then A.index_value else -1 end as index_value,A.query_time as report_create_time ,'' as etl_date  from (select  t1.row_id,t1.global_id,max(t1.query_time) as query_time ,max(case when cast(nvl(replace(t2.START_YEAR,'--',0),0) as int) >0 then cast(substr(current_timestamp(),1,4) as int) - cast(nvl(replace(t2.START_YEAR,'--',0),0) as int)  else 0 end) as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new  t1  left join TBL_PER_PROFESSIONAL  t2 on t2.report_id = t1.row_id  and t2.cert_no = t1.global_id group by t1.row_id,t1.global_id) A ;
drop table temp1;
drop table temp2;
drop table temp3;
drop table temp4;
drop table temp5;
create table temp2(row_id varchar(20),global_id varchar(20),REPORT_CREATE_TIME varchar(100),index_value varchar(20));
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, sum(t2.index_value) as index_value, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(regexp_replace(func_right(t1.last_24state, 3),'[0-9]+','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(regexp_replace(func_right(t1.last_24state, 3),'[2-9]','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME) select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - length(regexp_replace(func_right(t1.latest24state,3),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_3m' as index_name, to_char(sum(nvl(t3.index_value, '0')), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ; 
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, sum(t2.index_value) as index_value, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(regexp_replace(func_right(t1.last_24state, 6),'[0-9]+','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(regexp_replace(func_right(t1.last_24state, 6),'[2-9]','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - length(regexp_replace(func_right(t1.latest24state,6),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_6m' as index_name, to_char(sum(nvl(t3.index_value, '0')), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, sum(t2.index_value) as index_value, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(regexp_replace(func_right(t1.last_24state,12),'[0-9]+','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(regexp_replace(func_right(t1.last_24state,12),'[2-9]','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id ,t.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - length(regexp_replace(func_right(t1.latest24state,12),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_12m' as index_name, to_char(sum(nvl(t3.index_value, '0')), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, sum(t2.index_value) as index_value, max(t.query_time) as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(regexp_replace(func_right(t1.last_24state,24),'[0-9]+','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(regexp_replace(func_right(t1.last_24state,24),'[2-9]','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id group by t.row_id , t.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME) select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - length(regexp_replace(func_right(t1.latest24state,24),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_24m' as index_name, to_char(sum(nvl(t3.index_value, '0')), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ; 
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_long_time_total' as index_name, max(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款','个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_long_time_sct_total' as index_name, max(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME) select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_short_time_total' as index_name, min(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ; 
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_short_time_sct_total' as index_name, min(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '未激活' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_long_time_total' as index_name, max(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ; 
delete from temp2;
create table temp3(row_id varchar(20),global_id varchar(20),cue_out_time varchar(10));
insert into temp3 select row_id ,global_id ,cue_out_time from hdm_wbd_zx_qry_tblpbocloancardinfo_all where global_id is not null and state <> '未激活';
insert into temp3 select row_id ,global_id ,cue_out_time from hdm_wbd_zx_qry_tblpbocloaninfo_all where global_id is not null;
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_custfirst_age' as index_name, case when cast(t3.index_value as int) < -1 or t3.index_value is null or cast(t3.index_value as int) > 150 then '-1' else t3.index_value end as index_value, t3.REPORT_CREATE_TIME as REPORT_CREATE_TIME,'' as etl_date from (select t.row_id, t.global_id ,to_char(ceil((to_date(t2.cue_out_time) - to_date(replace(replace(t4.birthday, '.', ''),'--',''))) / 365),'99999') as index_value ,t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select W.row_id ,W.global_id ,W.cue_out_time from (select t1.row_id , t1.global_id , t1.cue_out_time , row_number() over(partition by t1.global_id order by t1.cue_out_time ) AS rn from temp3 t1 ) W where W.rn = 1 ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id left join (select distinct report_id ,cert_no ,birthday from TBL_PER_PERSIONAL_INFO ) t4 on t4.REPORT_ID = t.row_id and t4.cert_no = t.global_id ) t3 ;
delete from temp3;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '未激活' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_long_time_sct_total' as index_name, max(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '未激活' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_short_time_total' as index_name, min(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state <> '未激活' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_short_time_sct_total' as index_name, min(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2; 
create table temp1(row_id varchar(20),global_id varchar(20),index_value varchar(20));
insert into temp1(row_id,global_id,index_value)select t1.row_id ,t1.global_id , sum(case when (t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%车%' or t1.cue_db_way='抵押担保') and t1.state in ('正常','逾期','呆账') then 1 when (t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%车%' or t1.cue_db_way='抵押担保') and t1.state='结清' then 0 else null end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id;
insert into temp1(row_id,global_id,index_value)select t2.row_id , t2.global_id , sum(case when t2.cue_db_way='抵押担保' and t2.cue_sx_amount>=150000 and t2.state in ('正常','呆账') then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t2 where t2.row_id is not null and t2.state <>'\N' group by t2.row_id ,t2.global_id;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_mortgage_n_used' as index_name, nvl(cast(sum(t3.index_value) as int),-1) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join temp1 t3 on t.row_id=t3.row_id and t.global_id = t3.global_id group by t.row_id , t.global_id ;
delete from temp1;
insert into temp1(row_id,global_id,index_value)select t1.row_id ,t1.global_id , sum(case when t1.cue_amt_zl like '%房%' or t1.cue_amt_zl like '%车%' or t1.cue_db_way='抵押担保' then 1 when (t1.cue_amt_zl not like '%房%' or t1.cue_amt_zl not like '%车%' or t1.cue_db_way<>'抵押担保') and t1.state <> '\N' then 0 else null end) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id;
insert into temp1(row_id,global_id,index_value) select t2.row_id ,t2.global_id , sum(case when t2.cue_db_way='抵押担保' and t2.cue_sx_amount>=150000 then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t2 where t2.row_id is not null and t2.state <>'\N' group by t2.row_id ,t2.global_id; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t.row_id , t.global_id as card_id, 'loan_mortgage_n_total' as index_name, nvl(cast(sum(t3.index_value) as int),-1) as index_value, max(t.query_time) as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t left join temp2 t3 on t.row_id=t3.row_id and t.global_id = t3.global_id group by t.row_id , t.global_id ;
delete from temp1;
create table temp4(row_id varchar(20),global_id varchar(20),a varchar(20));
insert into temp4(row_id,global_id,a)select row_id,global_id,count(*) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where state = '结清' group by row_id,global_id;
insert into temp4(row_id,global_id,a)select row_id,global_id,count(*) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all where state = '销户' group by row_id,global_id; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_closed' as index_name, nvl(t2.index_value,-1) as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from temp4 t group by t.row_id ,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ;
delete from temp4; 
insert into temp4(row_id,global_id,a)select row_id,global_id,count(*) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all where state <>'\N' group by row_id,global_id;
insert into temp4(row_id,global_id,a) select row_id,global_id,count(*) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all where state <>'\N' group by row_id,global_id;
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_total' as index_name, nvl(t2.index_value,'0') as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from temp4 t group by t.row_id,t.global_id ) t2 on t1.row_id=t2.row_id and t1.global_id = t2.global_id ;
delete from temp4; 
insert into temp2(row_id,global_id,REPORT_CREATE_TIME,index_value) select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME, t2.index_value as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when regexp_substr(t1.last_24state , '[0-9]+') like '%9%' then 9 when regexp_substr(t1.last_24state , '[0-9]+') like '%8%' then 8 when regexp_substr(t1.last_24state , '[0-9]+') like '%7%' then 7 when regexp_substr(t1.last_24state , '[0-9]+') like '%6%' then 6 when regexp_substr(t1.last_24state , '[0-9]+') like '%5%' then 5 when regexp_substr(t1.last_24state , '[0-9]+') like '%4%' then 4 when regexp_substr(t1.last_24state , '[0-9]+') like '%3%' then 3 when regexp_substr(t1.last_24state , '[0-9]+') like '%2%' then 2 when regexp_substr(t1.last_24state , '[0-9]+') like '%1%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id; 
insert into temp2(row_id,global_id,REPORT_CREATE_TIME,index_value)select t.row_id , t.global_id, t.query_time as REPORT_CREATE_TIME, t2.index_value as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when regexp_substr(t1.last_24state , '[0-9]+') like '%9%' then 8 when regexp_substr(t1.last_24state , '[0-9]+') like '%8%' then 7 when regexp_substr(t1.last_24state , '[0-9]+') like '%7%' then 6 when regexp_substr(t1.last_24state , '[0-9]+') like '%6%' then 5 when regexp_substr(t1.last_24state , '[0-9]+') like '%5%' then 4 when regexp_substr(t1.last_24state , '[0-9]+') like '%4%' then 3 when regexp_substr(t1.last_24state , '[0-9]+') like '%3%' then 2 when regexp_substr(t1.last_24state , '[0-9]+') like '%2%' then 1 else 0 end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '准贷记卡' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t2.global_id = t.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'card_max_month_ol_24m' as index_name, to_char(nvl(sum(t3.index_value), '0'), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - length(regexp_replace(func_right(t1.latest24state, 3),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.state = '正常' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.last_24state, 3)) - length(regexp_replace(func_right(t1.last_24state, 3),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'loan_mortgage_ol_3m' as index_name, sum(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - length(regexp_replace(func_right(t1.latest24state, 6),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.last_24state, 6)) - length(regexp_replace(func_right(t1.last_24state, 6),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ;
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'loan_mortgage_ol_6m' as index_name, sum(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ;
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - length(regexp_replace(func_right(t1.latest24state, 12),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.last_24state, 12)) - length(regexp_replace(func_right(t1.last_24state, 12),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'loan_mortgage_ol_12m' as index_name, sum(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - length(regexp_replace(func_right(t1.latest24state, 24),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.last_24state, 24)) - length(regexp_replace(func_right(t1.last_24state, 24),'[0-9]+',''))) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'loan_mortgage_ol_24m' as index_name, sum(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ; 
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(replace(func_right(t1.last_24state, 3),'1','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(replace(func_right(t1.last_24state, 3),'2','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - nvl(length(replace(func_right(t1.latest24state, 3),'1','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m1_3m' as index_name, to_char(nvl(sum(t3.index_value), '0'), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(replace(func_right(t1.last_24state, 6),'1','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(replace(func_right(t1.last_24state, 6),'2','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - nvl(length(replace(func_right(t1.latest24state, 6),'1','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m1_6m' as index_name, to_char(nvl(sum(t3.index_value), '0'), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(replace(func_right(t1.last_24state,12),'1','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(replace(func_right(t1.last_24state,12),'2','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME) select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - nvl(length(replace(func_right(t1.latest24state, 12),'1','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m1_12m' as index_name, to_char(nvl(sum(t3.index_value), '0'), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ; 
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(replace(func_right(t1.last_24state,24),'1','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(replace(func_right(t1.last_24state,24),'2','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME) select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - nvl(length(replace(func_right(t1.latest24state, 24),'1','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m1_24m' as index_name, to_char(nvl(sum(t3.index_value), '0'), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(replace(func_right(t1.last_24state, 3),'2','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 3)) - nvl(length(replace(func_right(t1.last_24state, 3),'3','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 3)) - nvl(length(replace(func_right(t1.latest24state, 3),'2','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m2_3m' as index_name, to_char(nvl(sum(t3.index_value), '0'), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(replace(func_right(t1.last_24state, 6),'2','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 6)) - nvl(length(replace(func_right(t1.last_24state,6),'3','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 6)) - nvl(length(replace(func_right(t1.latest24state, 6),'2','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m2_6m' as index_name, to_char(nvl(sum(t3.index_value), '0'), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(replace(func_right(t1.last_24state,12),'2','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 12)) - nvl(length(replace(func_right(t1.last_24state,12),'3','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 12)) - nvl(length(replace(func_right(t1.latest24state,12),'2','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m2_12m' as index_name, to_char(nvl(sum(t3.index_value), '0'), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ; 
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when t1.cue_card_type = '贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(replace(func_right(t1.last_24state,24),'2','')),0) when t1.cue_card_type = '准贷记卡' then length(func_right(t1.last_24state, 24)) - nvl(length(replace(func_right(t1.last_24state,24),'3','')),0) end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, nvl(t2.index_value, '0') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(length(func_right(t1.latest24state, 24)) - nvl(length(replace(func_right(t1.latest24state, 24),'2','')),0)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_m2_24m' as index_name, to_char(nvl(sum(t3.index_value), '0'), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ; 
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '9999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverduecyc) else null end) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '9999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverduecyc) else null end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_now_n' as index_name, to_char(nvl(sum(t3.index_value), '0'), '9999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverdueamount) else null end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , sum(case when nvl(to_number(t1.curroverduecyc), 0) > 0 then to_number(t1.curroverdueamount) else null end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_ol_now_money' as index_name, to_char(nvl(sum(t3.index_value), '0'), '99999999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when regexp_substr(t1.last_24state , '[0-9]+') like '%9%' then 9 when regexp_substr(t1.last_24state , '[0-9]+') like '%8%' then 8 when regexp_substr(t1.last_24state , '[0-9]+') like '%7%' then 7 when regexp_substr(t1.last_24state , '[0-9]+') like '%6%' then 6 when regexp_substr(t1.last_24state , '[0-9]+') like '%5%' then 5 when regexp_substr(t1.last_24state , '[0-9]+') like '%4%' then 4 when regexp_substr(t1.last_24state , '[0-9]+') like '%3%' then 3 when regexp_substr(t1.last_24state , '[0-9]+') like '%2%' then 2 when regexp_substr(t1.last_24state , '[0-9]+') like '%1%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '贷记卡' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when regexp_substr(t1.last_24state , '[0-9]+') like '%9%' then 8 when regexp_substr(t1.last_24state , '[0-9]+') like '%8%' then 7 when regexp_substr(t1.last_24state , '[0-9]+') like '%7%' then 6 when regexp_substr(t1.last_24state , '[0-9]+') like '%6%' then 5 when regexp_substr(t1.last_24state , '[0-9]+') like '%5%' then 4 when regexp_substr(t1.last_24state , '[0-9]+') like '%4%' then 3 when regexp_substr(t1.last_24state , '[0-9]+') like '%3%' then 2 when regexp_substr(t1.last_24state , '[0-9]+') like '%2%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.cue_card_type = '准贷记卡' group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, t2.index_value as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(case when regexp_substr(t1.latest24state , '[0-9]+') like '%9%' then 9 when regexp_substr(t1.latest24state , '[0-9]+') like '%8%' then 8 when regexp_substr(t1.latest24state , '[0-9]+') like '%7%' then 7 when regexp_substr(t1.latest24state , '[0-9]+') like '%6%' then 6 when regexp_substr(t1.latest24state , '[0-9]+') like '%5%' then 5 when regexp_substr(t1.latest24state , '[0-9]+') like '%4%' then 4 when regexp_substr(t1.latest24state , '[0-9]+') like '%3%' then 3 when regexp_substr(t1.latest24state , '[0-9]+') like '%2%' then 2 when regexp_substr(t1.latest24state , '[0-9]+') like '%1%' then 1 else 0 end ) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null group by t1.row_id ,t1.global_id ) t2 on t2.row_id = t.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_max_month_ol_24m' as index_name, to_char(nvl(max(t3.index_value), '0'), '99999') as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_long_time_used' as index_name, max(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_long_time_sct_used' as index_name, max(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ; 
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_short_time_used' as index_name, min(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ;
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and (cue_amt_zl in ('个人汽车贷款', '个人住房贷款') or cue_db_way = '抵押担保') and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id, to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where cue_db_way is not null and cue_sx_amount > 150000 and cue_db_way = '抵押担保' and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select A.row_id , A.global_id, 'mortgage_short_time_sct_used' as index_name, max(A.index_value) as index_value, max(A.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 A group by A.row_id , A.global_id ;
delete from temp2; 
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME) select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_long_time_used' as index_name, max(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , max(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id ; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_long_time_sct_used' as index_name, max(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME) select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_short_time_used' as index_name, min(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ;
delete from temp2;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloancardinfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id;
insert into temp2(row_id,global_id,index_value,REPORT_CREATE_TIME)select t.row_id , t.global_id , to_char(nvl(t2.index_value, '0'), '99999') as index_value, t.query_time as REPORT_CREATE_TIME from hdm_wbd_zx_qry_tblperrecorddetail_new t left join (select t1.row_id ,t1.global_id , min(ceil((t1.query_time - to_date(t1.cue_out_time)) / 30 / 12)) as index_value from hdm_wbd_zx_qry_tblpbocloaninfo_all t1 where t1.row_id is not null and t1.state = '正常' group by t1.row_id ,t1.global_id) t2 on t.row_id = t2.row_id and t.global_id = t2.global_id; 
insert into hdm_wbd_index_factor (row_id, card_id, index_name, index_value, REPORT_CREATE_TIME, etl_date ) select t3.row_id , t3.global_id, 'account_short_time_sct_used' as index_name, min(t3.index_value) as index_value, max(t3.REPORT_CREATE_TIME) as REPORT_CREATE_TIME,'' as etl_date from temp2 t3 group by t3.row_id , t3.global_id ; 
delete from temp2;
create table temp5(row_id varchar(20),global_id varchar(20),query_time varchar(100),index_value varchar(20));
insert into temp5(row_id,global_id,query_time,index_value)select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') group by t1.global_id ,t1.row_id;
insert into temp5(row_id,global_id,query_time,index_value)select tt1.row_id ,tt1.global_id ,max(tt1.query_time) as query_time ,case when sum(nvl(tt3.cue_sx_amount,0)) <> 0 then sum(tt3.usedcreditlimitamount)/sum(tt3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new tt1 left join TBL_PER_RECORDDETAIL tt2 on tt2.report_id = tt1.row_id and tt2.cert_no = tt1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue tt3 on tt1.row_id = tt3.row_id and tt1.global_id = tt3.global_id where replace(replace(substr(tt2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(tt1.query_time,1,10),'.',''),'\N',''),-1) and tt2.queryreason like '%信用卡%' and tt3.state not in ('未激活','\N') group by tt1.global_id ,tt1.row_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select A.row_id, A.global_id as card_id, 'ratio_max_usenow_six_card' as index_name, max(nvl(A.index_value,-1)) as index_value, max(A.query_time) as report_create_time,'' as etl_date  from temp5 A group by A.global_id ,A.row_id ;
delete from temp5; 
insert into temp5(row_id,global_id,query_time,index_value)select t1.row_id ,t1.global_id ,max(t1.query_time) as query_time ,case when sum(nvl(t3.cue_sx_amount,0)) <> 0 then sum(t3.usedcreditlimitamount)/sum(t3.cue_sx_amount)/6 else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join TBL_PER_RECORDDETAIL t2 on t2.report_id = t1.row_id and t2.cert_no = t1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue t3 on t1.row_id = t3.row_id and t1.global_id = t3.global_id where replace(replace(substr(t2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(t1.query_time,1,10),'.',''),'\N',''),-6) and t2.queryreason like '%信用卡%' and t3.state not in ('未激活','\N') group by t1.global_id ,t1.row_id;
insert into temp5(row_id,global_id,query_time,index_value)select tt1.row_id ,tt1.global_id ,max(tt1.query_time) as query_time ,case when sum(nvl(tt3.cue_sx_amount,0)) <> 0 then sum(tt3.usedcreditlimitamount)/sum(tt3.cue_sx_amount) else null end as index_value from hdm_wbd_zx_qry_tblperrecorddetail_new tt1 left join TBL_PER_RECORDDETAIL tt2 on tt2.report_id = tt1.row_id and tt2.cert_no = tt1.global_id left join hdm_wbd_zx_qry_tblpbocloancardinfo_cue tt3 on tt1.row_id = tt3.row_id and tt1.global_id = tt3.global_id where replace(replace(substr(tt2.querydate,1,10),'.',''),'\N','') >= add_months(replace(replace(substr(tt1.query_time,1,10),'.',''),'\N',''),-1) and tt2.queryreason like '%信用卡%' and tt3.state not in ('未激活','\N') group by tt1.global_id ,tt1.row_id ; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select W.row_id, W.global_id as card_id, 'ratio_max_usenow_six_sct' as index_name, nvl(W.index_value,-20) as index_value, W.query_time as report_create_time,'' as etl_date  from (select A.row_id, A.global_id , case when max(A.index_value) <0.1 then '1' when max(A.index_value) >=0.1 and max(A.index_value) <0.2 then '2' when max(A.index_value) >=0.2 and max(A.index_value) <0.3 then '3' when max(A.index_value) >=0.3 and max(A.index_value) <0.4 then '4' when max(A.index_value) >=0.4 and max(A.index_value) <0.5 then '5' when max(A.index_value) >=0.5 and max(A.index_value) <0.6 then '6' when max(A.index_value) >=0.6 and max(A.index_value) <0.7 then '7' when max(A.index_value) >=0.7 and max(A.index_value) <0.8 then '8' when max(A.index_value) >=0.8 and max(A.index_value) <0.9 then '9' when max(A.index_value) >=0.9 and max(A.index_value) <1.0 then '10' end as index_value, max(A.query_time) as query_time from temp5 A group by A.global_id ,A.row_id ) W ; 
delete from temp5;
insert into temp4(row_id,global_id,a)select row_id, global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_out_time >= add_months(t2.querydate,-12) group by row_id ,global_id; 
insert into temp4(row_id,global_id,a)select row_id,global_id,count(distinct loan_card_id) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_out_time >= add_months(t2.querydate,-12) and t.state not in ('未激活','\N') and t.cue_cust_type='人民币账户' group by row_id ,global_id; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_12m' as index_name, nvl(A.index_value,0) as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from temp4 t group by t.row_id ,t.global_id ) A on t1.row_id = A.row_id and t1.global_id = A.global_id ;
delete from temp4;
insert into temp4(row_id,global_id,a)select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_out_time >= add_months(t2.querydate,-12) and t.cue_out_time <= add_months(t2.querydate,-6) group by row_id,global_id;
insert into temp4(row_id,global_id,a)select row_id,global_id,count(distinct loan_card_id) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_out_time >= add_months(t2.querydate,-12) and t.cue_out_time <= add_months(t2.querydate,-6) and t.state not in ('未激活','\N') and t.cue_cust_type='人民币账户' group by row_id,global_id; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_6m_12m' as index_name, nvl(A.index_value,0) as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from temp4 t group by t.row_id,t.global_id ) A on t1.row_id = A.row_id and t1.global_id = A.global_id ;
delete from temp4;
insert into temp4(row_id,global_id,a)select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_out_time >= add_months(t2.querydate,-6) and t.cue_out_time <= add_months(t2.querydate,-3) group by row_id,global_id; 
insert into temp4(row_id,global_id,a)select row_id,global_id,count(distinct loan_card_id) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_out_time >= add_months(t2.querydate,-6) and t.cue_out_time <= add_months(t2.querydate,-3) and t.state not in ('未激活','\N') and t.cue_cust_type='人民币账户' group by row_id,global_id; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_3m_6m' as index_name, nvl(A.index_value,0) as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from temp4 t group by t.row_id ,t.global_id ) A on t1.row_id = A.row_id and t1.global_id = A.global_id ;
delete from temp4; 
insert into temp4(row_id,global_id,a)select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_out_time >= add_months(t2.querydate,-3) group by row_id,global_id;
insert into temp4(row_id,global_id,a)select row_id,global_id,count(distinct loan_card_id) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_out_time >= add_months(t2.querydate,-3) and t.state not in ('未激活','\N') and t.cue_cust_type='人民币账户' group by row_id ,global_id; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_3m' as index_name, nvl(A.index_value,0) as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from temp4 t group by t.row_id,t.global_id ) A on t1.row_id = A.row_id and t1.global_id = A.global_id ;
delete from temp4; 
insert into temp4(row_id,global_id,a)select row_id,global_id,count(distinct loan_id) as a from hdm_wbd_zx_qry_tblpbocloaninfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_out_time >= add_months(t2.querydate,-6) group by row_id,global_id; 
insert into temp4(row_id,global_id,a)select row_id,global_id,count(distinct loan_card_id) as a from hdm_wbd_zx_qry_tblpbocloancardinfo_all t left join TBL_PER_RECORDDETAIL t2 on t2.report_id=t.row_id and t.global_id = t2.cert_no where t.cue_out_time >= add_months(t2.querydate,-6) and t.state not in ('未激活','\N') and t.cue_cust_type='人民币账户' group by row_id ,global_id; 
insert into hdm_wbd_index_factor( row_id, card_id , index_name , index_value , report_create_time, etl_date )select t1.row_id , t1.global_id, 'account_n_6m' as index_name, nvl(A.index_value,0) as index_value, t1.query_time as report_create_time,'' as etl_date  from hdm_wbd_zx_qry_tblperrecorddetail_new t1 left join (select t.row_id,t.global_id,cast(sum(t.a) as int) as index_value from temp4 t group by t.row_id,t.global_id ) A on t1.row_id = A.row_id and t1.global_id = A.global_id ; 