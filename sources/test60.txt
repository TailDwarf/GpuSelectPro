drop table KMTEMP;
drop table temp1;
drop table temp2
drop table temp3;
drop table temp4;
drop table SEND1;
create table KMTEMP(k varchar(10));
insert into KMTEMP(k) values('50800801');
insert into KMTEMP(k) values('50800802');
insert into KMTEMP(k) values('50800803');
insert into KMTEMP(k) values('50800800');
insert into KMTEMP(k) values('50800700');
insert into KMTEMP(k) values('50800600');
insert into KMTEMP(k) values('50800500');
insert into KMTEMP(k) values('50800804');
insert into KMTEMP(k) values('50800805');
insert into KMTEMP(k) values('50800888');
insert into KMTEMP(k) values('50800899');
insert into KMTEMP(k) values('50800900');
insert into KMTEMP(k) values('50800901');
insert into KMTEMP(k) values('50800902');
insert into KMTEMP(k) values('50800400');
insert into KMTEMP(k) values('50800302');
insert into KMTEMP(k) values('50800301');
insert into KMTEMP(k) values('50800300');
insert into KMTEMP(k) values('50800299');
insert into KMTEMP(k) values('50800207');
insert into KMTEMP(k) values('50800206');
insert into KMTEMP(k) values('50800205');
insert into KMTEMP(k) values('50800204');
insert into KMTEMP(k) values('50800203');
insert into KMTEMP(k) values('50800202');
insert into KMTEMP(k) values('50800201');
insert into KMTEMP(k) values('50800200');
insert into KMTEMP(k) values('50800104');
insert into KMTEMP(k) values('50800103');
insert into KMTEMP(k) values('50800903');
insert into KMTEMP(k) values('50801402');
insert into KMTEMP(k) values('50801401');
insert into KMTEMP(k) values('50801400');
insert into KMTEMP(k) values('50801399');
insert into KMTEMP(k) values('50801302');
insert into KMTEMP(k) values('50801301');
insert into KMTEMP(k) values('50801300');
insert into KMTEMP(k) values('50801299');
insert into KMTEMP(k) values('50801205');
insert into KMTEMP(k) values('50801203');
insert into KMTEMP(k) values('50801202');
insert into KMTEMP(k) values('50801201');
insert into KMTEMP(k) values('50801200');
insert into KMTEMP(k) values('50801105');
insert into KMTEMP(k) values('50801104');
insert into KMTEMP(k) values('50801103');
insert into KMTEMP(k) values('50801102');
insert into KMTEMP(k) values('50801101');
insert into KMTEMP(k) values('50801100');
insert into KMTEMP(k) values('50801099');
insert into KMTEMP(k) values('50801005');
insert into KMTEMP(k) values('50801003');
insert into KMTEMP(k) values('50801002');
insert into KMTEMP(k) values('50801001');
insert into KMTEMP(k) values('50801000');
insert into KMTEMP(k) values('50800999');
insert into KMTEMP(k) values('50800906');
insert into KMTEMP(k) values('50800905');
insert into KMTEMP(k) values('50800904');
insert into KMTEMP(k) values('26600011');
insert into KMTEMP(k) values('26600010');
insert into KMTEMP(k) values('26600009');
insert into KMTEMP(k) values('26600008');
insert into KMTEMP(k) values('26600006');
insert into KMTEMP(k) values('26600000');
insert into KMTEMP(k) values('26109912');
insert into KMTEMP(k) values('26109911');
insert into KMTEMP(k) values('26109910');
insert into KMTEMP(k) values('26109909');
insert into KMTEMP(k) values('26109908');
insert into KMTEMP(k) values('26109907');
insert into KMTEMP(k) values('26109906');
insert into KMTEMP(k) values('26109905');
insert into KMTEMP(k) values('26109904');
insert into KMTEMP(k) values('26109903');
insert into KMTEMP(k) values('26109902');
insert into KMTEMP(k) values('26109901');
insert into KMTEMP(k) values('26109900');
insert into KMTEMP(k) values('26100700');
insert into KMTEMP(k) values('26100612');
insert into KMTEMP(k) values('26100602');
insert into KMTEMP(k) values('26100600');
insert into KMTEMP(k) values('26100520');
insert into KMTEMP(k) values('26100510');
insert into KMTEMP(k) values('26100500');
insert into KMTEMP(k) values('26100420');
insert into KMTEMP(k) values('26100410');
insert into KMTEMP(k) values('26100400');
insert into KMTEMP(k) values('26600012');
insert into KMTEMP(k) values('50800102');
insert into KMTEMP(k) values('50800101');
insert into KMTEMP(k) values('50800100');
insert into KMTEMP(k) values('50800000');
insert into KMTEMP(k) values('50500000');
insert into KMTEMP(k) values('50000000');
insert into KMTEMP(k) values('41700300');
insert into KMTEMP(k) values('41700200');
insert into KMTEMP(k) values('41700100');
insert into KMTEMP(k) values('41700000');
insert into KMTEMP(k) values('41500000');
insert into KMTEMP(k) values('41400500');
insert into KMTEMP(k) values('41400000');
insert into KMTEMP(k) values('40000000');
insert into KMTEMP(k) values('31100000');
insert into KMTEMP(k) values('27600000');
insert into KMTEMP(k) values('26800500');
insert into KMTEMP(k) values('26800400');
insert into KMTEMP(k) values('26800300');
insert into KMTEMP(k) values('26800200');
insert into KMTEMP(k) values('26800100');
insert into KMTEMP(k) values('26800000');
insert into KMTEMP(k) values('26700100');
insert into KMTEMP(k) values('26600018');
insert into KMTEMP(k) values('26600017');
insert into KMTEMP(k) values('26600016');
insert into KMTEMP(k) values('26600015');
insert into KMTEMP(k) values('26600014');
insert into KMTEMP(k) values('26600013');
insert into KMTEMP(k) values('50801403');
insert into KMTEMP(k) values('50809907');
insert into KMTEMP(k) values('50809906');
insert into KMTEMP(k) values('50809905');
insert into KMTEMP(k) values('50809904');
insert into KMTEMP(k) values('50809903');
insert into KMTEMP(k) values('50809902');
insert into KMTEMP(k) values('50809901');
insert into KMTEMP(k) values('50809900');
insert into KMTEMP(k) values('50808901');
insert into KMTEMP(k) values('50803599');
insert into KMTEMP(k) values('50803503');
insert into KMTEMP(k) values('50803502');
insert into KMTEMP(k) values('50803501');
insert into KMTEMP(k) values('50803500');
insert into KMTEMP(k) values('50803400');
insert into KMTEMP(k) values('50803399');
insert into KMTEMP(k) values('50803306');
insert into KMTEMP(k) values('50803305');
insert into KMTEMP(k) values('50803304');
insert into KMTEMP(k) values('50803303');
insert into KMTEMP(k) values('50803302');
insert into KMTEMP(k) values('50803301');
insert into KMTEMP(k) values('50803300');
insert into KMTEMP(k) values('50803299');
insert into KMTEMP(k) values('50803205');
insert into KMTEMP(k) values('50803204');
insert into KMTEMP(k) values('50803203');
insert into KMTEMP(k) values('50803202');
insert into KMTEMP(k) values('50803201');
insert into KMTEMP(k) values('50809908');
insert into KMTEMP(k) values('TP303207');
insert into KMTEMP(k) values('TP303206');
insert into KMTEMP(k) values('TP303205');
insert into KMTEMP(k) values('TP303204');
insert into KMTEMP(k) values('TP303203');
insert into KMTEMP(k) values('TP303202');
insert into KMTEMP(k) values('TP303201');
insert into KMTEMP(k) values('TP303102');
insert into KMTEMP(k) values('TP303101');
insert into KMTEMP(k) values('90000000');
insert into KMTEMP(k) values('71600000');
insert into KMTEMP(k) values('52020103');
insert into KMTEMP(k) values('51701300');
insert into KMTEMP(k) values('51701200');
insert into KMTEMP(k) values('51701100');
insert into KMTEMP(k) values('51701000');
insert into KMTEMP(k) values('51700300');
insert into KMTEMP(k) values('51700200');
insert into KMTEMP(k) values('51700100');
insert into KMTEMP(k) values('51700000');
insert into KMTEMP(k) values('51500000');
insert into KMTEMP(k) values('51400900');
insert into KMTEMP(k) values('50920103');
insert into KMTEMP(k) values('50900400');
insert into KMTEMP(k) values('50900300');
insert into KMTEMP(k) values('50900200');
insert into KMTEMP(k) values('50900100');
insert into KMTEMP(k) values('50900000');
insert into KMTEMP(k) values('50809999');
insert into KMTEMP(k) values('50802303');
insert into KMTEMP(k) values('50802302');
insert into KMTEMP(k) values('50802301');
insert into KMTEMP(k) values('50802300');
insert into KMTEMP(k) values('50802200');
insert into KMTEMP(k) values('50802100');
insert into KMTEMP(k) values('50802000');
insert into KMTEMP(k) values('50801999');
insert into KMTEMP(k) values('50801903');
insert into KMTEMP(k) values('50801902');
insert into KMTEMP(k) values('50801901');
insert into KMTEMP(k) values('50801900');
insert into KMTEMP(k) values('50801804');
insert into KMTEMP(k) values('50801803');
insert into KMTEMP(k) values('50801802');
insert into KMTEMP(k) values('50801801');
insert into KMTEMP(k) values('50801800');
insert into KMTEMP(k) values('50801799');
insert into KMTEMP(k) values('50801703');
insert into KMTEMP(k) values('50801702');
insert into KMTEMP(k) values('50801701');
insert into KMTEMP(k) values('50801700');
insert into KMTEMP(k) values('50801600');
insert into KMTEMP(k) values('50801503');
insert into KMTEMP(k) values('50801502');
insert into KMTEMP(k) values('50801501');
insert into KMTEMP(k) values('50801500');
insert into KMTEMP(k) values('50801499');
insert into KMTEMP(k) values('50801404');
insert into KMTEMP(k) values('50802304');
insert into KMTEMP(k) values('50803200');
insert into KMTEMP(k) values('50803199');
insert into KMTEMP(k) values('50803115');
insert into KMTEMP(k) values('50803114');
insert into KMTEMP(k) values('50803113');
insert into KMTEMP(k) values('50803112');
insert into KMTEMP(k) values('50803111');
insert into KMTEMP(k) values('50803110');
insert into KMTEMP(k) values('50803109');
insert into KMTEMP(k) values('50803108');
insert into KMTEMP(k) values('50803107');
insert into KMTEMP(k) values('50803106');
insert into KMTEMP(k) values('50803105');
insert into KMTEMP(k) values('50803104');
insert into KMTEMP(k) values('50803103');
insert into KMTEMP(k) values('50803102');
insert into KMTEMP(k) values('50803101');
insert into KMTEMP(k) values('50803100');
insert into KMTEMP(k) values('50803000');
insert into KMTEMP(k) values('50802900');
insert into KMTEMP(k) values('50802705');
insert into KMTEMP(k) values('50802704');
insert into KMTEMP(k) values('50802703');
insert into KMTEMP(k) values('50802702');
insert into KMTEMP(k) values('50802701');
insert into KMTEMP(k) values('50802700');
insert into KMTEMP(k) values('50802600');
insert into KMTEMP(k) values('50802500');
insert into KMTEMP(k) values('50802400');
insert into KMTEMP(k) values('18001200');
insert into KMTEMP(k) values('18001100');
insert into KMTEMP(k) values('18001000');
insert into KMTEMP(k) values('18000900');
insert into KMTEMP(k) values('18000800');
insert into KMTEMP(k) values('18000700');
insert into KMTEMP(k) values('18000300');
insert into KMTEMP(k) values('18000200');
insert into KMTEMP(k) values('18000000');
insert into KMTEMP(k) values('16109904');
insert into KMTEMP(k) values('16109903');
insert into KMTEMP(k) values('16109902');
insert into KMTEMP(k) values('16109901');
insert into KMTEMP(k) values('16109900');
insert into KMTEMP(k) values('16100800');
insert into KMTEMP(k) values('16100700');
insert into KMTEMP(k) values('16100690');
insert into KMTEMP(k) values('16100680');
insert into KMTEMP(k) values('16100679');
insert into KMTEMP(k) values('16100678');
insert into KMTEMP(k) values('16100677');
insert into KMTEMP(k) values('16100676');
insert into KMTEMP(k) values('16100675');
insert into KMTEMP(k) values('16100674');
insert into KMTEMP(k) values('16100673');
insert into KMTEMP(k) values('16100672');
insert into KMTEMP(k) values('16100671');
insert into KMTEMP(k) values('16100670');
insert into KMTEMP(k) values('16100660');
insert into KMTEMP(k) values('18009900');
insert into KMTEMP(k) values('18401000');
insert into KMTEMP(k) values('18400900');
insert into KMTEMP(k) values('18400800');
insert into KMTEMP(k) values('18400700');
insert into KMTEMP(k) values('18400600');
insert into KMTEMP(k) values('18400500');
insert into KMTEMP(k) values('18400000');
insert into KMTEMP(k) values('18309900');
insert into KMTEMP(k) values('18300180');
insert into KMTEMP(k) values('18300170');
insert into KMTEMP(k) values('18300160');
insert into KMTEMP(k) values('18300150');
insert into KMTEMP(k) values('18300140');
insert into KMTEMP(k) values('18300139');
insert into KMTEMP(k) values('18300132');
insert into KMTEMP(k) values('18300131');
insert into KMTEMP(k) values('18300130');
insert into KMTEMP(k) values('18300120');
insert into KMTEMP(k) values('18300110');
insert into KMTEMP(k) values('18300100');
insert into KMTEMP(k) values('18300000');
insert into KMTEMP(k) values('18200000');
insert into KMTEMP(k) values('18101200');
insert into KMTEMP(k) values('18101100');
insert into KMTEMP(k) values('18101000');
insert into KMTEMP(k) values('18100900');
insert into KMTEMP(k) values('18100800');
insert into KMTEMP(k) values('18100700');
insert into KMTEMP(k) values('18100000');
insert into KMTEMP(k) values('10500200');
insert into KMTEMP(k) values('10500100');
insert into KMTEMP(k) values('10500000');
insert into KMTEMP(k) values('10300500');
insert into KMTEMP(k) values('10300400');
insert into KMTEMP(k) values('10300302');
insert into KMTEMP(k) values('10300301');
insert into KMTEMP(k) values('10300300');
insert into KMTEMP(k) values('10300202');
insert into KMTEMP(k) values('10300201');
insert into KMTEMP(k) values('10300200');
insert into KMTEMP(k) values('10300110');
insert into KMTEMP(k) values('10300109');
insert into KMTEMP(k) values('10300108');
insert into KMTEMP(k) values('10300107');
insert into KMTEMP(k) values('10300106');
insert into KMTEMP(k) values('10300105');
insert into KMTEMP(k) values('10300104');
insert into KMTEMP(k) values('10300103');
insert into KMTEMP(k) values('10300102');
insert into KMTEMP(k) values('10300101');
insert into KMTEMP(k) values('10300100');
insert into KMTEMP(k) values('10300000');
insert into KMTEMP(k) values('10100500');
insert into KMTEMP(k) values('10100400');
insert into KMTEMP(k) values('10100300');
insert into KMTEMP(k) values('10100200');
insert into KMTEMP(k) values('10100100');
insert into KMTEMP(k) values('10100000');
insert into KMTEMP(k) values('10500300');
insert into KMTEMP(k) values('16100650');
insert into KMTEMP(k) values('16100640');
insert into KMTEMP(k) values('16100630');
insert into KMTEMP(k) values('16100620');
insert into KMTEMP(k) values('16100610');
insert into KMTEMP(k) values('16100600');
insert into KMTEMP(k) values('16100520');
insert into KMTEMP(k) values('16100510');
insert into KMTEMP(k) values('16100500');
insert into KMTEMP(k) values('16100420');
insert into KMTEMP(k) values('16100410');
insert into KMTEMP(k) values('16100400');
insert into KMTEMP(k) values('16100300');
insert into KMTEMP(k) values('16100220');
insert into KMTEMP(k) values('16100210');
insert into KMTEMP(k) values('16100200');
insert into KMTEMP(k) values('16100180');
insert into KMTEMP(k) values('16100170');
insert into KMTEMP(k) values('16100160');
insert into KMTEMP(k) values('16100150');
insert into KMTEMP(k) values('16100140');
insert into KMTEMP(k) values('16100130');
insert into KMTEMP(k) values('16100120');
insert into KMTEMP(k) values('16100110');
insert into KMTEMP(k) values('16100100');
insert into KMTEMP(k) values('16100000');
insert into KMTEMP(k) values('10500600');
insert into KMTEMP(k) values('10500500');
insert into KMTEMP(k) values('10500400');
insert into KMTEMP(k) values('18401100');
insert into KMTEMP(k) values('20900600');
insert into KMTEMP(k) values('20900400');
insert into KMTEMP(k) values('20900300');
insert into KMTEMP(k) values('20900200');
insert into KMTEMP(k) values('20900102');
insert into KMTEMP(k) values('20900101');
insert into KMTEMP(k) values('20900100');
insert into KMTEMP(k) values('20900000');
insert into KMTEMP(k) values('19801100');
insert into KMTEMP(k) values('19801000');
insert into KMTEMP(k) values('19800900');
insert into KMTEMP(k) values('19800800');
insert into KMTEMP(k) values('19800700');
insert into KMTEMP(k) values('19800600');
insert into KMTEMP(k) values('19800500');
insert into KMTEMP(k) values('19800000');
insert into KMTEMP(k) values('19600000');
insert into KMTEMP(k) values('19500000');
insert into KMTEMP(k) values('19400000');
insert into KMTEMP(k) values('19309900');
insert into KMTEMP(k) values('19306803');
insert into KMTEMP(k) values('19306802');
insert into KMTEMP(k) values('19306801');
insert into KMTEMP(k) values('19306800');
insert into KMTEMP(k) values('19306705');
insert into KMTEMP(k) values('19306704');
insert into KMTEMP(k) values('19306703');
insert into KMTEMP(k) values('19306702');
insert into KMTEMP(k) values('19306701');
insert into KMTEMP(k) values('20900601');
insert into KMTEMP(k) values('26100307');
insert into KMTEMP(k) values('26100306');
insert into KMTEMP(k) values('26100305');
insert into KMTEMP(k) values('26100304');
insert into KMTEMP(k) values('26100303');
insert into KMTEMP(k) values('26100302');
insert into KMTEMP(k) values('26100301');
insert into KMTEMP(k) values('26100300');
insert into KMTEMP(k) values('26100220');
insert into KMTEMP(k) values('26100210');
insert into KMTEMP(k) values('26100200');
insert into KMTEMP(k) values('26100120');
insert into KMTEMP(k) values('26100110');
insert into KMTEMP(k) values('26100100');
insert into KMTEMP(k) values('26100000');
insert into KMTEMP(k) values('22400000');
insert into KMTEMP(k) values('20900803');
insert into KMTEMP(k) values('20900802');
insert into KMTEMP(k) values('20900801');
insert into KMTEMP(k) values('20900800');
insert into KMTEMP(k) values('20900701');
insert into KMTEMP(k) values('20900700');
insert into KMTEMP(k) values('20900608');
insert into KMTEMP(k) values('20900607');
insert into KMTEMP(k) values('20900606');
insert into KMTEMP(k) values('20900605');
insert into KMTEMP(k) values('20900604');
insert into KMTEMP(k) values('20900603');
insert into KMTEMP(k) values('20900602');
insert into KMTEMP(k) values('19301505');
insert into KMTEMP(k) values('19301504');
insert into KMTEMP(k) values('19301503');
insert into KMTEMP(k) values('19301502');
insert into KMTEMP(k) values('19301501');
insert into KMTEMP(k) values('19301500');
insert into KMTEMP(k) values('19300200');
insert into KMTEMP(k) values('19300000');
insert into KMTEMP(k) values('19201000');
insert into KMTEMP(k) values('19200900');
insert into KMTEMP(k) values('19200800');
insert into KMTEMP(k) values('19200700');
insert into KMTEMP(k) values('19200000');
insert into KMTEMP(k) values('18809900');
insert into KMTEMP(k) values('18800600');
insert into KMTEMP(k) values('18800500');
insert into KMTEMP(k) values('18800400');
insert into KMTEMP(k) values('18800300');
insert into KMTEMP(k) values('18800200');
insert into KMTEMP(k) values('18800100');
insert into KMTEMP(k) values('18800000');
insert into KMTEMP(k) values('18700201');
insert into KMTEMP(k) values('18700200');
insert into KMTEMP(k) values('18700100');
insert into KMTEMP(k) values('18700000');
insert into KMTEMP(k) values('18600200');
insert into KMTEMP(k) values('18600100');
insert into KMTEMP(k) values('18600000');
insert into KMTEMP(k) values('18409900');
insert into KMTEMP(k) values('19301600');
insert into KMTEMP(k) values('19306700');
insert into KMTEMP(k) values('19306605');
insert into KMTEMP(k) values('19306604');
insert into KMTEMP(k) values('19306603');
insert into KMTEMP(k) values('19306602');
insert into KMTEMP(k) values('19306601');
insert into KMTEMP(k) values('19306600');
insert into KMTEMP(k) values('19306505');
insert into KMTEMP(k) values('19306504');
insert into KMTEMP(k) values('19306503');
insert into KMTEMP(k) values('19306502');
insert into KMTEMP(k) values('19306501');
insert into KMTEMP(k) values('19306500');
insert into KMTEMP(k) values('19305200');
insert into KMTEMP(k) values('19301803');
insert into KMTEMP(k) values('19301802');
insert into KMTEMP(k) values('19301801');
insert into KMTEMP(k) values('19301800');
insert into KMTEMP(k) values('19301705');
insert into KMTEMP(k) values('19301704');
insert into KMTEMP(k) values('19301703');
insert into KMTEMP(k) values('19301702');
insert into KMTEMP(k) values('19301701');
insert into KMTEMP(k) values('19301700');
insert into KMTEMP(k) values('19301605');
insert into KMTEMP(k) values('19301604');
insert into KMTEMP(k) values('19301603');
insert into KMTEMP(k) values('19301602');
insert into KMTEMP(k) values('19301601');
drop table temp3;
drop table SEND1;
drop table temp1;
drop table temp2;
drop table temp4;
UPDATE ZNMAT011 SET IFDONE='' ;
drop sequence temp_seq; 
create sequence temp_seq start with 0 increment by 1 maxvalue 9999999999 nocycle nocache ;
create table temp3(DATYPE varchar(2));
insert into temp3 SELECT DATYPE FROM ZNMAT088A WHERE BS = '1' ;
create table SEND1(CUSTMCATYP VARCHAR(50),CUSTMCACOD VARCHAR(50),BJGTLINES VARCHAR(50),SEQNR_SPR VARCHAR(50),SEQNR_ROT VARCHAR(50),RULEID_SPR VARCHAR(50),CRNSCOD VARCHAR(5),ABJGTLINES VARCHAR(120),ACNTAGE VARCHAR(50),BMD_CODE VARCHAR(20),BUZNSNTURE VARCHAR(50),CATE_CODE VARCHAR(20),CBFTCODE VARCHAR(50),CHANNEL VARCHAR(50),COBASEDPRO VARCHAR(50),CUSTMNO VARCHAR(50),KM VARCHAR(10),MAKTPRO VARCHAR(50),OPTNAGE VARCHAR(50),SECTOR VARCHAR(50),STAFFNO VARCHAR(50),ZIZHU_CODE VARCHAR(20),OPEXPENSES DOUBLE);;
insert into SEND1 select ZTAB.CUSTMCATYP,ZTAB.CUSTMCACOD,ZTAB.BJGTLINES,ZTAB.SEQNR,ZTAB.SEQNR_ROT,ZTAB.RULEID AS RULEID_SPR ,ZTAB.CRNSCOD,ZTAB.ABJGTLINES,ZTAB.ACNTAGE,ZTAB.BMD_CODE,ZTAB.BUZNSNTURE,ZTAB.CATE_CODE,ZTAB.CBFTCODE,ZTAB.CHANNEL,ZTAB.COBASEDPRO,ZTAB.CUSTMNO,ZTAB.KM,ZTAB.MAKTPRO,ZTAB.OPTNAGE,ZTAB.SECTOR,ZTAB.STAFFNO,ZTAB.ZIZHU_CODE,SUM(ZTAB.OPEXPENSES) FROM ZNMAT011 ZTAB join temp3 on ZTAB.DATYPE = temp3.DATYPE left join kmtemp on  ZTAB.KM = kmtemp.k  where ZTAB.PERIO = '2019002' AND ZTAB.VERSION = '' AND ZTAB.MANDT = '801' AND ZTAB.IFDONE = ''  and( ZTAB.STAFFNO='4214' or ZTAB.STAFFNO='8883')  GROUP BY ZTAB.CUSTMCATYP,ZTAB.CUSTMCACOD,ZTAB.BJGTLINES,ZTAB.SEQNR ,ZTAB.SEQNR_ROT ,ZTAB.RULEID,ZTAB.CRNSCOD,ZTAB.ABJGTLINES,ZTAB.ACNTAGE,ZTAB.BMD_CODE,ZTAB.BUZNSNTURE,ZTAB.CATE_CODE,ZTAB.CBFTCODE,ZTAB.CHANNEL,ZTAB.COBASEDPRO, ZTAB.CUSTMNO, ZTAB.KM,ZTAB.MAKTPRO,ZTAB.OPTNAGE,ZTAB.SECTOR,ZTAB.STAFFNO,ZTAB.ZIZHU_CODE ;
create table temp1(ABJGTLINES VARCHAR(120));
insert into temp1 SELECT DISTINCT FIELDCOD AS ABJGTLINES FROM ZNMAT065 WHERE PERIO ='2019002' AND RULEID ='HQ_CC2PC_RL_GG'  AND SETKIND ='R' ;;
create table temp2(MANDT VARCHAR(3),BJGTLINES VARCHAR(50),PERIO VARCHAR(7),SEQNR VARCHAR(50),RULEID VARCHAR(50),RULEID_FQ VARCHAR(50),DATYPE VARCHAR(2),GENERALACNT VARCHAR(50),SECTORNUM DOUBLE);
insert into temp2 SELECT TAB.MANDT,TAB.ABJGTLINES ,'2019002' ,NEXTVAL(temp_seq),'HQ_CC2PC_RL_GG' AS RULEID ,'HQ_CC2PC_RL_GG' AS RULEID_FQ ,'A3' AS DATYPE ,TAB.GENERALACNT, TAB.SECTORNUM FROM  ZNMAT004 TAB left join temp1 on  TAB.ABJGTLINES = temp1.ABJGTLINES where  TAB.PERIO = '2019002' AND TAB.MANDT = '801' AND TAB.DATYPE = 'B9' GROUP BY TAB.MANDT,TAB.KEYVALUE,TAB.ABJGTLINES,TAB.GENERALACNT, TAB.SECTORNUM ;
create table temp4(MANDT VARCHAR(3),CUSTMCATYP VARCHAR(50),CUSTMCACOD VARCHAR(50),BJGTLINES VARCHAR(50),PERIO VARCHAR(7),SEQNR VARCHAR(50),SEQNR_SPR VARCHAR(50),SEQNR_ROT VARCHAR(50),RULEID_SPR VARCHAR(50),RULEID VARCHAR(50),RULEID_FQ VARCHAR(50),DATYPE VARCHAR(2),CRNSCOD VARCHAR(5),ACNTAGE VARCHAR(50),BMD_CODE VARCHAR(20),BUZNSNTURE VARCHAR(50),CATE_CODE VARCHAR(20),CBFTCODE VARCHAR(50),CHANNEL VARCHAR(50),COBASEDPRO VARCHAR(50),CUSTMNO VARCHAR(50),KM VARCHAR(10),MAKTPRO VARCHAR(50),OPTNAGE VARCHAR(50),SECTOR VARCHAR(50),STAFFNO VARCHAR(50),ZIZHU_CODE VARCHAR(20),ABJGTLINES VARCHAR(120),GENERALACNT VARCHAR(50),OPEXPENSES DOUBLE);
insert into temp4 select temp2.MANDT,SEND1.CUSTMCATYP,SEND1.CUSTMCACOD,temp2.BJGTLINES,temp2.PERIO,temp2.SEQNR,SEND1.SEQNR_SPR,SEND1.SEQNR_ROT,SEND1.RULEID_SPR,temp2.RULEID,temp2.RULEID_FQ,temp2.DATYPE,SEND1.CRNSCOD,SEND1.ACNTAGE,SEND1.BMD_CODE,SEND1.BUZNSNTURE,SEND1.CATE_CODE,SEND1.CBFTCODE,SEND1.CHANNEL,SEND1.COBASEDPRO,SEND1.CUSTMNO,SEND1.KM,SEND1.MAKTPRO,SEND1.OPTNAGE,SEND1.SECTOR,SEND1.STAFFNO,SEND1.ZIZHU_CODE ,SEND1.ABJGTLINES,temp2.GENERALACNT,ROUND(SUM ( SEND1.OPEXPENSES * 100 / 100 * ( temp2.SECTORNUM / 47948.00000 ) ),5) from temp2 cross join SEND1 on temp2.MANDT = SEND1.CUSTMCATYP GROUP BY temp2.MANDT,SEND1.CUSTMCATYP,SEND1.CUSTMCACOD,temp2.BJGTLINES,temp2.PERIO,temp2.SEQNR,SEND1.SEQNR_SPR,SEND1.SEQNR_ROT,SEND1.RULEID_SPR,temp2.RULEID,temp2.RULEID_FQ,temp2.DATYPE,SEND1.CRNSCOD,SEND1.ACNTAGE,SEND1.BMD_CODE,SEND1.BUZNSNTURE,SEND1.CATE_CODE,SEND1.CBFTCODE,SEND1.CHANNEL,SEND1.COBASEDPRO,SEND1.CUSTMNO,SEND1.KM,SEND1.MAKTPRO,SEND1.OPTNAGE,SEND1.SECTOR,SEND1.STAFFNO,SEND1.ZIZHU_CODE ,SEND1.ABJGTLINES,temp2.GENERALACNT ;
INSERT INTO ZNMAT011(MANDT,CUSTMCATYP,CUSTMCACOD,BJGTLINES,PERIO,SEQNR,SEQNR_SPR,SEQNR_ROT,RULEID_SPR,RULEID,ruleid_fq,DATYPE,CRNSCOD,ACNTAGE,BMD_CODE,BUZNSNTURE,CATE_CODE,CBFTCODE,CHANNEL,COBASEDPRO,CUSTMNO,KM,MAKTPRO,OPTNAGE,SECTOR,STAFFNO,ZIZHU_CODE ,ABJGTLINES,GENERALACNT,OPEXPENSES)SELECT MANDT,CUSTMCATYP,CUSTMCACOD,BJGTLINES,PERIO,SEQNR,SEQNR_SPR,SEQNR_ROT,RULEID_SPR,RULEID,RULEID_FQ,DATYPE,CRNSCOD,ACNTAGE,BMD_CODE,BUZNSNTURE,CATE_CODE,CBFTCODE,CHANNEL,COBASEDPRO,CUSTMNO,KM,MAKTPRO,OPTNAGE,SECTOR,STAFFNO,ZIZHU_CODE,ABJGTLINES,GENERALACNT,OPEXPENSES FROM temp4 where OPEXPENSES >= 0.05000000000000 ;
drop sequence temp_seq; 