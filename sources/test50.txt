drop table c;
drop table e;
drop table tempa;
drop table tempc;
drop table t1;
drop table t3;
drop table t4;
drop table tempd;
CREATE  TABLE ZNMAT004NOPKLIST (MANDT VARCHAR(3) ,CUSTMNO VARCHAR(50),PERIO VARCHAR(7) ,GRPID_CUSCAT VARCHAR(35) ) ;
insert into ZNMAT004NOPKLIST select '801',cust_no,'2019002','' FROM ZNMAT142 WHERE PERIO = '2019002'  AND IS_UNPACKED = 'X' AND GRPID_CUSCAT <> '' ;
create table C(STAFFNO VARCHAR(50));
insert into C(STAFFNO) select DISTINCT STAFFNO from ZNMAT134 WHERE PERIO = '2019002' ;
create table E(PRDLEAF VARCHAR(50));
insert into E(PRDLEAF)select DISTINCT PRDLEAF FROM  ZNMAT023 WHERE PRDNO LIKE 'G01%' AND PERIO = '2019002' ;
create table tempA(PREFIX VARCHAR(10),ACNTAGE VARCHAR(50),OPTNAGE VARCHAR(50),BMD_CODE VARCHAR(20),COBASEDPRO VARCHAR(50),GRPID_LOB VARCHAR(35),GRPID_CUSCAT VARCHAR(35),GRPID_PRDSA VARCHAR(35),LOBID_MAPRD VARCHAR(18),LOBID_MACUS VARCHAR(18),CUSCAT_MAIN VARCHAR(18),CUSTMNO VARCHAR(50),STAFFNO VARCHAR(50),BEASID VARCHAR(50),SELIID VARCHAR(50),INTERESTIN DOUBLE,CSTCAPITAL DOUBLE,VALCAPITAL DOUBLE,INTERESTEX DOUBLE,FEECOMIN DOUBLE,FEECOMEX DOUBLE,REINVES DOUBLE,VALUEGAINS DOUBLE,EXCHANGE DOUBLE,REBZNSO DOUBLE,PFABLITY DOUBLE,JZZB_VAL DOUBLE,INC_TAX DOUBLE,OPTAX DOUBLE,BSGAP DOUBLE,OTHER_COST DOUBLE,INCOME_OPO DOUBLE,EXPENSE_OPO DOUBLE,BAL_AVG_M DOUBLE,MOBGNBA DOUBLE,MOENDBA DOUBLE,IOATCRBTTA DOUBLE,RISKWEASS DOUBLE,CAP_SUM DOUBLE,BAL_BW DOUBLE,VOL_AVG_D DOUBLE,EXPENSE_ZCJZSS DOUBLE,VAL_JZSS DOUBLE,CAPITAL_JG DOUBLE,CAPITAL_CRED DOUBLE,RWA_CR DOUBLE,AVG_D_JZSS DOUBLE,BAL_JRZC DOUBLE,AVG_D_JRZC DOUBLE,BAL_BBW DOUBLE,AVG_D_BBW DOUBLE,TICKETDELS DOUBLE,TICKETRATIO DOUBLE,WKLODEQ DOUBLE,CREDIT DOUBLE,ACNTNUM DOUBLE,CUSTNO DOUBLE,MOVEAC DOUBLE,ACNTTIME DOUBLE,LENDERS DOUBLE,VOLB DOUBLE,TRANSNUM DOUBLE,APPROVAL DOUBLE,TRANS_COUNT_SCF_S DOUBLE,DIFFICULTY DOUBLE,TRANS_COUNT_MJ_S DOUBLE,INVEBAPR DOUBLE,BAL_SXZC_LY DOUBLE,RMB_TOTAL_AMT DOUBLE,FOR_TOTAL_AMT DOUBLE,IS_NEW INT,ZGUEST_GROUP VARCHAR(20),KEYVALUE VARCHAR(60));
insert into tempA SELECT 'PC',A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.GRPID_CUSCAT AS CUSTMNO,IFNULL(C.STAFFNO,'9999999999') AS STAFFNO,A.BEASID,A.SELIID,A.INTERESTIN,A.CSTCAPITAL,A.VALCAPITAL,A.INTERESTEX,A.FEECOMIN,A.FEECOMEX,A.REINVES,A.VALUEGAINS,A.EXCHANGE,A.REBZNSO,A.PFABLITY,A.JZZB_VAL,A.INC_TAX,A.OPTAX,A.BSGAP,A.OTHER_COST,A.INCOME_OPO,A.EXPENSE_OPO,A.BAL_AVG_M,A.MOBGNBA,A.MOENDBA,A.IOATCRBTTA,A.RISKWEASS,A.CAP_SUM,A.BAL_BW,A.VOL_AVG_D,A.EXPENSE_ZCJZSS,A.VAL_JZSS,A.CAPITAL_JG,A.CAPITAL_CRED,A.RWA_CR,A.AVG_D_JZSS,A.BAL_JRZC,A.AVG_D_JRZC,A.BAL_BBW,A.AVG_D_BBW,A.TICKETDELS,A.TICKETRATIO,A.WKLODEQ,A.CREDIT,A.ACNTNUM,A.CUSTNO,A.MOVEAC,A.ACNTTIME,A.LENDERS,A.VOLB,A.TRANSNUM,A.APPROVAL,A.TRANS_COUNT_SCF_S,A.DIFFICULTY,A.TRANS_COUNT_MJ_S,A.INVEBAPR,A.BAL_SXZC_LY,A.RMB_TOTAL_AMT,A.FOR_TOTAL_AMT,A.IS_NEW,A.ZGUEST_GROUP,A.KEYVALUE FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST B ON A.CUSTMNO = B.CUSTMNO left JOIN  C ON  A.STAFFNO = C.STAFFNO left JOIN  E ON A.COBASEDPRO = E.PRDLEAF  WHERE B.CUSTMNO IS NULL AND A.PERIO = '2019002' AND E.PRDLEAF IS NULL and B.PERIO <='2019002' ;
create table F(PRDLEAF VARCHAR(50));
insert into F(PRDLEAF) select DISTINCT PRDLEAF FROM  ZNMAT023 WHERE (PRDNO LIKE 'G01%' OR PRDNO LIKE 'G02%') AND PERIO = '2019002' ;
insert into tempA SELECT 'PC',A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.GRPID_CUSCAT AS CUSTMNO,case A.STAFFNO when '' then '9999999999' else A.STAFFNO end AS STAFFNO,A.BEASID,A.SELIID,A.INTERESTIN,A.CSTCAPITAL,A.VALCAPITAL,A.INTERESTEX,A.FEECOMIN,A.FEECOMEX,A.REINVES,A.VALUEGAINS,A.EXCHANGE,A.REBZNSO,A.PFABLITY,A.JZZB_VAL,A.INC_TAX,A.OPTAX,A.BSGAP,A.OTHER_COST,A.INCOME_OPO,A.EXPENSE_OPO,A.BAL_AVG_M,A.MOBGNBA,A.MOENDBA,A.IOATCRBTTA,A.RISKWEASS,A.CAP_SUM,A.BAL_BW,A.VOL_AVG_D,A.EXPENSE_ZCJZSS,A.VAL_JZSS,A.CAPITAL_JG,A.CAPITAL_CRED,A.RWA_CR,A.AVG_D_JZSS,A.BAL_JRZC,A.AVG_D_JRZC,A.BAL_BBW,A.AVG_D_BBW,A.TICKETDELS,A.TICKETRATIO,A.WKLODEQ,A.CREDIT,A.ACNTNUM,A.CUSTNO,A.MOVEAC,A.ACNTTIME,A.LENDERS,A.VOLB,A.TRANSNUM,A.APPROVAL,A.TRANS_COUNT_SCF_S,A.DIFFICULTY,A.TRANS_COUNT_MJ_S,A.INVEBAPR,A.BAL_SXZC_LY,A.RMB_TOTAL_AMT,A.FOR_TOTAL_AMT,A.IS_NEW,A.ZGUEST_GROUP,A.KEYVALUE  FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST B ON A.CUSTMNO = B.CUSTMNO left JOIN  F ON A.COBASEDPRO = F.PRDLEAF  WHERE B.CUSTMNO IS NULL AND A.PERIO= '2019002' AND F.PRDLEAF IS NULL and B.PERIO <='2019002' ;
create sequence temp_seq start with 0 increment by 1 maxvalue 9999999999 nocycle nocache ;
insert into ZNMAT004(MANDT, DATYPE, PERIO, KEYVALUE, GENERALACNT, ACNTAGE, OPTNAGE, BMD_CODE, COBASEDPRO, GRPID_LOB, GRPID_CUSCAT, GRPID_PRDSA, LOBID_MAPRD, LOBID_MACUS, CUSCAT_MAIN, CUSTMNO, STAFFNO, BEASID, SELIID, INTERESTIN, CSTCAPITAL, VALCAPITAL, INTERESTEX, FEECOMIN, FEECOMEX, REINVES, VALUEGAINS, EXCHANGE, REBZNSO, PFABLITY,	 JZZB_VAL, INC_TAX, OPTAX, BSGAP, OTHER_COST, INCOME_OPO, EXPENSE_OPO, TAMBOAIAO, MOBGNBA, MOENDBA, IOATCRBTTA, RISKWEASS, CAP_SUM, BAL_BW, VOL_AVG_D, EXPENSE_ZCJZSS, VAL_JZSS, CAPITAL_JG, CAPITAL_CRED, RWA_CR, AVG_D_JZSS, BAL_JRZC, AVG_D_JRZC, BAL_BBW, AVG_D_BBW, TICKETDELS, TICKETRATIO, WKLODEQ, CREDIT, ACNTNUM, CUSTNO, MOVEAC, ACNTTIME, LENDERS, VOLB, TRANSNUM, APPROVAL, TRANS_COUNT_SCF_S, DIFFICULTY, TRANS_COUNT_MJ_S, INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT)SELECT '801', 'B0', '2019002', concat(PREFIX,cast(NEXTVAL(temp_seq) as varchar(10))),concat(PREFIX,cast(NEXTVAL(temp_seq) as varchar(10))), ACNTAGE, OPTNAGE, BMD_CODE, COBASEDPRO, GRPID_LOB, GRPID_CUSCAT, GRPID_PRDSA, LOBID_MAPRD, LOBID_MACUS, CUSCAT_MAIN, CUSTMNO, STAFFNO, BEASID, SELIID, abs(SUM(INTERESTIN)), abs(SUM(CSTCAPITAL)), abs(SUM(VALCAPITAL)), abs(SUM(INTERESTEX)), abs(SUM(FEECOMIN)), abs(SUM(FEECOMEX)), abs(SUM(REINVES)), abs(SUM(VALUEGAINS)), abs(SUM(EXCHANGE)), abs(SUM(REBZNSO)), abs(SUM(PFABLITY)), abs(SUM(JZZB_VAL)), abs(SUM(INC_TAX)), abs(SUM(OPTAX)), abs(SUM(BSGAP)), abs(SUM(OTHER_COST)), abs(SUM(INCOME_OPO)), abs(SUM(EXPENSE_OPO)), abs(SUM(BAL_AVG_M)), abs(SUM(MOBGNBA)), abs(SUM(MOENDBA)),abs(SUM(IOATCRBTTA)), abs(SUM(RISKWEASS)), abs(SUM(CAP_SUM)), abs(SUM(BAL_BW)), abs(SUM(VOL_AVG_D)), abs(SUM(EXPENSE_ZCJZSS)), abs(SUM(VAL_JZSS)), abs(SUM(CAPITAL_JG)), abs(SUM(CAPITAL_CRED)), abs(SUM(RWA_CR)), abs(SUM(AVG_D_JZSS)), abs(SUM(BAL_JRZC)), abs(SUM(AVG_D_JRZC)), abs(SUM(BAL_BBW)), abs(SUM(AVG_D_BBW)), abs(SUM(TICKETDELS)), abs(SUM(TICKETRATIO)), abs(SUM(WKLODEQ)), abs(SUM(CREDIT)), 1, abs(SUM(CUSTNO)), abs(SUM(MOVEAC)), abs(SUM(ACNTTIME)), abs(SUM(LENDERS)), abs(SUM(VOLB)), abs(SUM(TRANSNUM)), abs(SUM(APPROVAL)), abs(SUM(TRANS_COUNT_SCF_S)), abs(SUM(DIFFICULTY)), abs(SUM(TRANS_COUNT_MJ_S)), abs(SUM(INVEBAPR)),abs(SUM(BAL_SXZC_LY)),abs(SUM(RMB_TOTAL_AMT)),abs(SUM(FOR_TOTAL_AMT)),abs(SUM(IS_NEW)),ZGUEST_GROUP, COUNT(INTERESTIN) FROM tempA GROUP BY PREFIX,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,ZGUEST_GROUP ;
drop tempa;
create table T1(PERIO VARCHAR(7),KEYVALUE VARCHAR(60),ACNTAGE VARCHAR(50),OPTNAGE VARCHAR(50),BMD_CODE VARCHAR(20),COBASEDPRO VARCHAR(50),GRPID_LOB VARCHAR(35),GRPID_CUSCAT VARCHAR(35),GRPID_PRDSA VARCHAR(35),LOBID_MAPRD VARCHAR(18),LOBID_MACUS VARCHAR(18),CUSCAT_MAIN VARCHAR(18),CUSTMNO VARCHAR(50), STAFFNO VARCHAR(50),BEASID VARCHAR(50),SELIID VARCHAR(50),ZGUEST_GROUP VARCHAR(20) );
insert into T1(PERIO,KEYVALUE,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,ZGUEST_GROUP) SELECT A.PERIO,A.KEYVALUE,A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.GRPID_CUSCAT,IFNULL(C.STAFFNO,'9999999999'),A.BEASID,A.SELIID,A.ZGUEST_GROUP  FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST  B ON A.CUSTMNO = B.CUSTMNO  left JOIN C ON A.STAFFNO = C.STAFFNO left JOIN E ON A.COBASEDPRO = E.PRDLEAF  WHERE B.CUSTMNO IS NULL AND A.PERIO= '2019002' AND E.PRDLEAF IS NULL  and B.PERIO <= '2019002' ;
insert into ZNMAT004KEYMAP (mandt,perio,COKEY_OLD,COKEY_NEW)  SELECT '801','2019002',T1.KEYVALUE,T2.KEYVALUE  FROM ZNMAT004 T2 join T1 on T2.ACNTAGE = T1.ACNTAGE AND T2.OPTNAGE =	T1.OPTNAGE AND T2.BMD_CODE = T1.BMD_CODE AND T2.COBASEDPRO = T1.COBASEDPRO AND T2.GRPID_LOB = T1.GRPID_LOB AND T2.GRPID_CUSCAT = T1.GRPID_CUSCAT AND T2.GRPID_PRDSA = T1.GRPID_PRDSA AND T2.LOBID_MAPRD = T1.LOBID_MAPRD AND T2.LOBID_MACUS = T1.LOBID_MACUS AND T2.CUSCAT_MAIN = T1.CUSCAT_MAIN AND T2.CUSTMNO  = T1.CUSTMNO AND T2.STAFFNO = T1.STAFFNO AND T2.BEASID = T1.BEASID AND T2.SELIID = T1.SELIID AND T2.ZGUEST_GROUP = T1.ZGUEST_GROUP WHERE T2.KEYVALUE like 'PC%' and T2.PERIO = '2019002' AND T2.MANDT ='801' AND T2.DATYPE ='B0' ORDER BY T2.KEYVALUE ASC,T1.KEYVALUE ASC ;
drop table T1;
create table T3(PERIO VARCHAR(7),KEYVALUE VARCHAR(60),ACNTAGE VARCHAR(50),OPTNAGE VARCHAR(50),BMD_CODE VARCHAR(20),COBASEDPRO VARCHAR(50),GRPID_LOB VARCHAR(35),GRPID_CUSCAT VARCHAR(35),GRPID_PRDSA VARCHAR(35),LOBID_MAPRD VARCHAR(18),LOBID_MACUS VARCHAR(18),CUSCAT_MAIN VARCHAR(18),CUSTMNO VARCHAR(50), STAFFNO VARCHAR(50),BEASID VARCHAR(50),SELIID VARCHAR(50),ZGUEST_GROUP VARCHAR(20) );
insert into T3(PERIO,KEYVALUE,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,ZGUEST_GROUP) SELECT A.PERIO,A.KEYVALUE,A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.CUSTMNO,case A.STAFFNO when '' then '9999999999' else A.STAFFNO end AS STAFFNO,A.BEASID,A.SELIID,A.ZGUEST_GROUP  FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST B ON A.CUSTMNO = B.CUSTMNO left JOIN E ON A.COBASEDPRO = E.PRDLEAF	WHERE B.CUSTMNO IS not NULL  and B.PERIO <= '2019002' AND E.PRDLEAF IS NULL	AND  A.PERIO = '2019002' ;
insert into ZNMAT004KEYMAP(mandt,perio,COKEY_OLD,COKEY_NEW) SELECT '801','2019002',T3.KEYVALUE,T2.KEYVALUE  FROM ZNMAT004 T2 join T3 on  T2.ACNTAGE = T3.ACNTAGE AND T2.OPTNAGE = T3.OPTNAGE AND T2.BMD_CODE = T3.BMD_CODE AND T2.COBASEDPRO = T3.COBASEDPRO AND T2.GRPID_LOB = T3.GRPID_LOB AND T2.GRPID_CUSCAT = T3.GRPID_CUSCAT AND T2.GRPID_PRDSA = T3.GRPID_PRDSA AND T2.LOBID_MAPRD = T3.LOBID_MAPRD AND T2.LOBID_MACUS = T3.LOBID_MACUS AND T2.CUSCAT_MAIN = T3.CUSCAT_MAIN AND T2.CUSTMNO     = T3.CUSTMNO AND T2.STAFFNO    = T3.STAFFNO AND T2.BEASID   = T3.BEASID AND T2.SELIID  = T3.SELIID AND T2.ZGUEST_GROUP = T3.ZGUEST_GROUP WHERE  T2.PERIO = '2019002' AND T2.DATYPE ='B0' AND T2.MANDT ='801' AND  T2.KEYVALUE like 'PP%' ORDER BY T2.KEYVALUE ASC,T3.KEYVALUE ASC ;
drop table T3;
create table tempC(MANDT VARCHAR(3),DATYPE VARCHAR(2),PERIO VARCHAR(7),KEYVALUE VARCHAR(60),GENERALACNT VARCHAR(50),ACNTAGE VARCHAR(50),OPTNAGE VARCHAR(50),BMD_CODE VARCHAR(20),COBASEDPRO VARCHAR(50),GRPID_LOB VARCHAR(35),GRPID_CUSCAT VARCHAR(35),GRPID_PRDSA VARCHAR(35),LOBID_MAPRD VARCHAR(18),LOBID_MACUS VARCHAR(18),CUSCAT_MAIN VARCHAR(18),CUSTMNO VARCHAR(50),STAFFNO VARCHAR(50),BEASID VARCHAR(50),SELIID VARCHAR(50),INTERESTIN DOUBLE,CSTCAPITAL DOUBLE,VALCAPITAL DOUBLE,INTERESTEX DOUBLE,FEECOMIN DOUBLE,FEECOMEX DOUBLE,REINVES DOUBLE,VALUEGAINS DOUBLE,EXCHANGE DOUBLE,REBZNSO DOUBLE,PFABLITY DOUBLE,JZZB_VAL DOUBLE,INC_TAX DOUBLE,OPTAX DOUBLE,BSGAP DOUBLE,OTHER_COST DOUBLE,INCOME_OPO DOUBLE,EXPENSE_OPO DOUBLE,BAL_AVG_M DOUBLE,MOBGNBA DOUBLE,MOENDBA DOUBLE,IOATCRBTTA DOUBLE,RISKWEASS DOUBLE,CAP_SUM DOUBLE,BAL_BW DOUBLE,VOL_AVG_D DOUBLE,EXPENSE_ZCJZSS DOUBLE,VAL_JZSS DOUBLE,CAPITAL_JG DOUBLE,CAPITAL_CRED DOUBLE,RWA_CR DOUBLE,AVG_D_JZSS DOUBLE,BAL_JRZC DOUBLE,AVG_D_JRZC DOUBLE,BAL_BBW DOUBLE,AVG_D_BBW DOUBLE,TICKETDELS DOUBLE,TICKETRATIO DOUBLE,WKLODEQ DOUBLE,CREDIT DOUBLE,ACNTNUM DOUBLE,CUSTNO DOUBLE,MOVEAC DOUBLE,ACNTTIME DOUBLE,LENDERS DOUBLE,VOLB DOUBLE,TRANSNUM DOUBLE,APPROVAL DOUBLE,TRANS_COUNT_SCF_S DOUBLE,DIFFICULTY DOUBLE,TRANS_COUNT_MJ_S DOUBLE,INVEBAPR DOUBLE,BAL_SXZC_LY DOUBLE,RMB_TOTAL_AMT DOUBLE,FOR_TOTAL_AMT DOUBLE,IS_NEW INT,ZGUEST_GROUP VARCHAR(20),PACKCOUNT int);
INSERT INTO tempC(MANDT,DATYPE,perio,KEYVALUE,GENERALACNT,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,INTERESTIN,CSTCAPITAL,VALCAPITAL,INTERESTEX,FEECOMIN,FEECOMEX,REINVES,VALUEGAINS,EXCHANGE,REBZNSO,PFABLITY,JZZB_VAL,INC_TAX,OPTAX,BSGAP,OTHER_COST,INCOME_OPO,EXPENSE_OPO,BAL_AVG_M,MOBGNBA,MOENDBA,IOATCRBTTA,RISKWEASS,CAP_SUM,BAL_BW,VOL_AVG_D,EXPENSE_ZCJZSS,VAL_JZSS,CAPITAL_JG,CAPITAL_CRED,RWA_CR,AVG_D_JZSS,BAL_JRZC,AVG_D_JRZC,BAL_BBW,AVG_D_BBW,TICKETDELS,TICKETRATIO,WKLODEQ,CREDIT,ACNTNUM,CUSTNO,MOVEAC,ACNTTIME,LENDERS,VOLB,TRANSNUM,APPROVAL,TRANS_COUNT_SCF_S,DIFFICULTY,TRANS_COUNT_MJ_S,INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT) SELECT  '801', 'B0','2019002',A.KEYVALUE,A.GENERALACNT,A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.CUSTMNO,case A.STAFFNO when '' then '9999999999' else A.STAFFNO end AS STAFFNO,A.BEASID,A.SELIID,ABS(A.INTERESTIN),ABS(A.CSTCAPITAL),ABS(A.VALCAPITAL),ABS(A.INTERESTEX),ABS(A.FEECOMIN),ABS(A.FEECOMEX),ABS(A.REINVES),ABS(A.VALUEGAINS),ABS(A.EXCHANGE),ABS(A.REBZNSO),ABS(A.PFABLITY),ABS(A.JZZB_VAL),ABS(A.INC_TAX),ABS(A.OPTAX),ABS(A.BSGAP),ABS(A.OTHER_COST),ABS(A.INCOME_OPO),ABS(A.EXPENSE_OPO),ABS(A.BAL_AVG_M),ABS(A.MOBGNBA),ABS(A.MOENDBA),ABS(A.IOATCRBTTA),ABS(A.RISKWEASS),ABS(A.CAP_SUM),ABS(A.BAL_BW),ABS(A.VOL_AVG_D),ABS(A.EXPENSE_ZCJZSS),ABS(A.VAL_JZSS),ABS(A.CAPITAL_JG),ABS(A.CAPITAL_CRED),ABS(A.RWA_CR),ABS(A.AVG_D_JZSS),ABS(A.BAL_JRZC),ABS(A.AVG_D_JRZC),ABS(A.BAL_BBW),ABS(A.AVG_D_BBW),ABS(A.TICKETDELS),ABS(A.TICKETRATIO),ABS(A.WKLODEQ),ABS(A.CREDIT),ABS(A.ACNTNUM),ABS(A.CUSTNO),ABS(A.MOVEAC),ABS(A.ACNTTIME),ABS(A.LENDERS),ABS(A.VOLB),ABS(A.TRANSNUM),ABS(A.APPROVAL),ABS(A.TRANS_COUNT_SCF_S),ABS(A.DIFFICULTY),ABS(A.TRANS_COUNT_MJ_S),ABS(A.INVEBAPR),ABS(A.BAL_SXZC_LY),ABS(A.RMB_TOTAL_AMT),ABS(A.FOR_TOTAL_AMT),ABS(A.IS_NEW),A.ZGUEST_GROUP,0 FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST B ON A.CUSTMNO = B.CUSTMNO left JOIN E ON A.COBASEDPRO = E.PRDLEAF  WHERE B.CUSTMNO IS NULL AND A.PERIO= '2019002'  and B.PERIO <= '2019002' AND E.PRDLEAF IS NOT NULL ;
INSERT INTO tempC(MANDT,DATYPE,perio,KEYVALUE,GENERALACNT,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,INTERESTIN,CSTCAPITAL,VALCAPITAL,INTERESTEX,FEECOMIN,FEECOMEX,REINVES,VALUEGAINS,EXCHANGE,REBZNSO,PFABLITY,JZZB_VAL,INC_TAX,OPTAX,BSGAP,OTHER_COST,INCOME_OPO,EXPENSE_OPO,BAL_AVG_M,MOBGNBA,MOENDBA,IOATCRBTTA,RISKWEASS,CAP_SUM,BAL_BW,VOL_AVG_D,EXPENSE_ZCJZSS,VAL_JZSS,CAPITAL_JG,CAPITAL_CRED,RWA_CR,AVG_D_JZSS,BAL_JRZC,AVG_D_JRZC,BAL_BBW,AVG_D_BBW,TICKETDELS,TICKETRATIO,WKLODEQ,CREDIT,ACNTNUM,CUSTNO,MOVEAC,ACNTTIME,LENDERS,VOLB,TRANSNUM,APPROVAL,TRANS_COUNT_SCF_S,DIFFICULTY,TRANS_COUNT_MJ_S,INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT) SELECT  '801', 'B0','2019002',A.KEYVALUE,A.GENERALACNT,A.ACNTAGE,A.OPTNAGE,A.BMD_CODE,A.COBASEDPRO,A.GRPID_LOB,A.GRPID_CUSCAT,A.GRPID_PRDSA,A.LOBID_MAPRD,A.LOBID_MACUS,A.CUSCAT_MAIN,A.CUSTMNO,case A.STAFFNO when '' then '9999999999' else A.STAFFNO end AS STAFFNO,A.BEASID,A.SELIID,ABS(A.INTERESTIN),ABS(A.CSTCAPITAL),ABS(A.VALCAPITAL),ABS(A.INTERESTEX),ABS(A.FEECOMIN),ABS(A.FEECOMEX),ABS(A.REINVES),ABS(A.VALUEGAINS),ABS(A.EXCHANGE),ABS(A.REBZNSO),ABS(A.PFABLITY),ABS(A.JZZB_VAL),ABS(A.INC_TAX),ABS(A.OPTAX),ABS(A.BSGAP),ABS(A.OTHER_COST),ABS(A.INCOME_OPO),ABS(A.EXPENSE_OPO),ABS(A.BAL_AVG_M),ABS(A.MOBGNBA),ABS(A.MOENDBA),ABS(A.IOATCRBTTA),ABS(A.RISKWEASS),ABS(A.CAP_SUM),ABS(A.BAL_BW),ABS(A.VOL_AVG_D),ABS(A.EXPENSE_ZCJZSS),ABS(A.VAL_JZSS),ABS(A.CAPITAL_JG),ABS(A.CAPITAL_CRED),ABS(A.RWA_CR),ABS(A.AVG_D_JZSS),ABS(A.BAL_JRZC),ABS(A.AVG_D_JRZC),ABS(A.BAL_BBW),ABS(A.AVG_D_BBW),ABS(A.TICKETDELS),ABS(A.TICKETRATIO),ABS(A.WKLODEQ),ABS(A.CREDIT),ABS(A.ACNTNUM),ABS(A.CUSTNO),ABS(A.MOVEAC),ABS(A.ACNTTIME),ABS(A.LENDERS),ABS(A.VOLB),ABS(A.TRANSNUM),ABS(A.APPROVAL),ABS(A.TRANS_COUNT_SCF_S),ABS(A.DIFFICULTY),ABS(A.TRANS_COUNT_MJ_S),ABS(A.INVEBAPR),ABS(A.BAL_SXZC_LY),ABS(A.RMB_TOTAL_AMT),ABS(A.FOR_TOTAL_AMT),ABS(A.IS_NEW),A.ZGUEST_GROUP,0FROM ZNMAT004TEMP A left JOIN ZNMAT004NOPKLIST B ON A.CUSTMNO = B.CUSTMNO left JOIN F ON A.COBASEDPRO = F.PRDLEAF WHERE  B.CUSTMNO IS NOT NULL	AND A.PERIO= '2019002'  and B.PERIO <= '2019002' AND F.PRDLEAF IS NOT NULL ;
INSERT INTO ZNMAT004(MANDT,DATYPE,PERIO,KEYVALUE,GENERALACNT,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,INTERESTIN,CSTCAPITAL,VALCAPITAL,INTERESTEX,FEECOMIN,FEECOMEX,REINVES,VALUEGAINS,EXCHANGE,REBZNSO,PFABLITY,JZZB_VAL,INC_TAX,OPTAX,	BSGAP,OTHER_COST,INCOME_OPO,EXPENSE_OPO,BAL_AVG_M,MOBGNBA,MOENDBA,IOATCRBTTA,RISKWEASS,CAP_SUM,BAL_BW,VOL_AVG_D,EXPENSE_ZCJZSS,VAL_JZSS,CAPITAL_JG,CAPITAL_CRED,RWA_CR,AVG_D_JZSS,BAL_JRZC,AVG_D_JRZC,BAL_BBW,AVG_D_BBW,TICKETDELS,TICKETRATIO,WKLODEQ,CREDIT,ACNTNUM,CUSTNO,MOVEAC,ACNTTIME,LENDERS,VOLB,TRANSNUM,APPROVAL,TRANS_COUNT_SCF_S,DIFFICULTY,TRANS_COUNT_MJ_S,INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT) select DISTINCT MANDT,DATYPE,PERIO,KEYVALUE,GENERALACNT,ACNTAGE,OPTNAGE,BMD_CODE,COBASEDPRO,GRPID_LOB,GRPID_CUSCAT,GRPID_PRDSA,LOBID_MAPRD,LOBID_MACUS,CUSCAT_MAIN,CUSTMNO,STAFFNO,BEASID,SELIID,INTERESTIN,CSTCAPITAL,VALCAPITAL,INTERESTEX,FEECOMIN,FEECOMEX,REINVES,VALUEGAINS,EXCHANGE,REBZNSO,PFABLITY,JZZB_VAL,INC_TAX,OPTAX,	BSGAP,OTHER_COST,INCOME_OPO,EXPENSE_OPO,BAL_AVG_M,MOBGNBA,MOENDBA,IOATCRBTTA,RISKWEASS,CAP_SUM,BAL_BW,VOL_AVG_D,EXPENSE_ZCJZSS,VAL_JZSS,CAPITAL_JG,CAPITAL_CRED,RWA_CR,AVG_D_JZSS,BAL_JRZC,AVG_D_JRZC,BAL_BBW,AVG_D_BBW,TICKETDELS,TICKETRATIO,WKLODEQ,CREDIT,ACNTNUM,CUSTNO,MOVEAC,ACNTTIME,LENDERS,VOLB,TRANSNUM,APPROVAL,TRANS_COUNT_SCF_S,DIFFICULTY,TRANS_COUNT_MJ_S,INVEBAPR,BAL_SXZC_LY,RMB_TOTAL_AMT,FOR_TOTAL_AMT,IS_NEW,ZGUEST_GROUP,PACKCOUNT from tempC;
drop table tempC;
create table T4(GENERALACNT VARCHAR(50),GRPID_LOB VARCHAR(35),PERIO VARCHAR(7));
insert into T4 SELECT GENERALACNT,GRPID_LOB,PERIO FROM ZNMAT004 WHERE PERIO = '2019002' GROUP BY GENERALACNT,GRPID_LOB,PERIO ;
insert into ZNMAT021 (MANDT,LOB_PERIO,LOB_WD_ID,LOB_COKEY,LOB_WD_VAL) SELECT '801', '2019002', '101',T4.GENERALACNT, T2.GROUP_VAL FROM T4 join ZNMAT133 T2 on T4.GRPID_LOB = T2.GROUP_ID where 	T2.GROUP_TYPE ='G01' AND T4.PERIO = '2019002' GROUP BY T4.PERIO,T4.GENERALACNT, T2.GROUP_VAL ;
drop table T4;
insert into ZNMAT021(MANDT,LOB_PERIO,LOB_WD_ID,LOB_COKEY,LOB_WD_VAL) SELECT '801','2019002', '102',GENERALACNT,LOBID_MAPRD FROM ZNMAT004 WHERE PERIO = '2019002' AND LOBID_MAPRD <> '' GROUP BY GENERALACNT,LOBID_MAPRD ;
insert into ZNMAT021 SELECT '801', '2019002', '103',GENERALACNT,LOBID_MACUS FROM ZNMAT004 WHERE LOBID_MACUS <>'' AND	PERIO = '2019002' GROUP BY PERIO,GENERALACNT,LOBID_MACUS ;
create table tempD(PERIO VARCHAR(7),CUSTMNO VARCHAR(50),GRPID_CUSCAT VARCHAR(35));
INSERT INTO tempD SELECT PERIO,CUSTMNO,GRPID_CUSCAT FROM ZNMAT004  ;
insert into ZNMAT019(CUS_PERIO,CUS_WD_ID,CUS_WD_VAL,CUS_COKEY) SELECT tempD.PERIO,tempD.CUSTMNO ,B.GROUP_VAL,substr(B.GROUP_VAL,1,3) FROM tempD join ZNMAT133 B on tempD.GRPID_CUSCAT = B.GROUP_ID where B.GROUP_TYPE ='G02' and tempD.PERIO = '2019002' GROUP BY tempD.PERIO,tempD.CUSTMNO,ZNMAT133.GROUP_VAL ;
drop table tempD;
insert into ZNMAT020 (mandt, PRD_PERIO, PRD_COKEY, PRD_WD_VAL, PRD_WD_ID) SELECT '801', '2019002','501', GENERALACNT, COBASEDPRO FROM ZNMAT004 WHERE PERIO = '2019002' GROUP BY GENERALACNT,COBASEDPRO ;
drop table c;
drop table e;
drop table tempa;
drop table tempc;
drop table t1;
drop table t3;
drop table t4;
drop table tempd;